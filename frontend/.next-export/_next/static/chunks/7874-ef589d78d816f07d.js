"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7874],{11924:(e,t,s)=>{s.d(t,{Cd:()=>g,Lh:()=>o,bB:()=>r,bk:()=>d,cK:()=>l,iq:()=>c,iv:()=>i,kM:()=>h,lm:()=>n,qd:()=>p,rg:()=>x,rr:()=>u,uK:()=>m});var a=s(81242);async function r(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:r}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:s}});return(0,a.I)(r)}async function l(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(s){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function i(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function c(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let o=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),x=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function m(e,t){let s={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:r}=await a.A.post("/usage-requests/".concat(e,"/assign"),s);return(0,a.I)(r)}async function h(e,t){let s={};"number"==typeof t.exitOdometer&&(s.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==s.exitOdometer&&(s.exitOdometer=t.odometerStartKm);let r=[];t.remarks&&r.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&r.push(...t.exitManifest),r.length&&(s.exitManifest=r);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),s);return(0,a.I)(n)}async function g(e,t){let s={};"number"==typeof t.entryOdometer&&(s.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==s.entryOdometer&&(s.entryOdometer=t.odometerEndKm);let r=[];t.remarks&&r.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&r.push(...t.entryManifest),r.length&&(s.entryManifest=r);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),s);return(0,a.I)(n)}async function p(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},47874:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var a=s(95155),r=s(12115),n=s(12008),l=s(78827),i=s(7640),c=s(11924),o=s(6257);let d=e=>e?new Date(e).toLocaleString():"—",u=e=>null==e||""===e?"—":String(e);function x(){let[e,t]=(0,r.useState)([]),[s,x]=(0,r.useState)(""),[h,g]=(0,r.useState)(null),[p,j]=(0,r.useState)(!0),y=async()=>{j(!0);try{let e=await (0,c.cK)();t(e||[])}catch(e){n.oR.error(e instanceof Error?e.message:"Failed to load requests"),t([])}finally{j(!1)}};(0,r.useEffect)(()=>{y()},[]);let v=(0,r.useMemo)(()=>{let t=s.trim().toLowerCase();return t?e.filter(e=>[e.requestCode,e.applicantName,e.employeeId,e.department,e.fromLocation,e.toLocation,e.assignedVehicleNumber,e.assignedDriverName,e.status].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(t)):e},[e,s]);return(0,a.jsxs)("div",{className:"min-h-screen bg-orange-50 p-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-orange-200 p-4 space-y-3 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"All Requests"}),(0,a.jsx)("p",{className:"text-sm text-orange-700",children:"Track every applicant request with full details."})]}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-orange-600 text-white text-sm font-semibold",onClick:y,children:p?"Loading…":"Refresh"})]}),(0,a.jsx)(l.A,{value:s,onChange:x,placeholder:"Search code, applicant, route, vehicle, driver, status…"}),(0,a.jsx)("div",{className:"mt-3 overflow-x-auto rounded-lg border border-orange-100",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-orange-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)(i.Th,{children:"Request"}),(0,a.jsx)(i.Th,{children:"Applicant"}),(0,a.jsx)(i.Th,{children:"Route / Travel"}),(0,a.jsx)(i.Th,{children:"Status"}),(0,a.jsx)(i.Th,{children:"Assignment"}),(0,a.jsx)(i.Th,{children:"Schedule"}),(0,a.jsx)(i.Th,{children:"Gate"}),(0,a.jsx)(i.Th,{className:"text-center",children:"Actions"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[v.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-orange-50",children:[(0,a.jsxs)(i.Td,{children:[(0,a.jsx)("div",{className:"font-semibold text-orange-900",children:u(e.requestCode)}),(0,a.jsxs)("div",{className:"text-[11px] text-gray-600",children:["Applied: ",d(e.createdAt)]})]}),(0,a.jsxs)(i.Td,{children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:u(e.applicantName)}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Emp ID: ",u(e.employeeId)]}),(0,a.jsx)("div",{className:"text-[11px] text-gray-500",children:u(e.department)})]}),(0,a.jsxs)(i.Td,{children:[(0,a.jsxs)("div",{className:"font-medium",children:[u(e.fromLocation)," → ",u(e.toLocation)]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[u(e.dateOfTravel)," • ",u(e.timeFrom)," - ",u(e.timeTo)]})]}),(0,a.jsx)(i.Td,{children:(e=>{let t=(e||"—").toUpperCase(),s=t.replaceAll("_"," ");return("PENDING_MANAGEMENT"===t||"PENDING MANAGMENT"===t)&&(s="PENDING MGMT"),"SENT_TO_MANAGEMENT"===t&&(s="SENT TO MGMT"),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-[3px] rounded text-[11px] bg-orange-100 text-orange-800",children:s})})(e.status)}),(0,a.jsxs)(i.Td,{children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:u(e.assignedVehicleNumber)}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:u(e.assignedDriverName)}),e.assignedDriverPhone&&(0,a.jsx)("div",{className:"text-[11px] text-gray-500",children:e.assignedDriverPhone})]}),(0,a.jsxs)(i.Td,{children:[(0,a.jsxs)("div",{children:["Pickup: ",d(e.scheduledPickupAt)]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Return: ",d(e.scheduledReturnAt)]})]}),(0,a.jsxs)(i.Td,{children:[(0,a.jsxs)("div",{children:["Exit: ",d(e.gateExitAt)," ",(0,a.jsxs)("span",{className:"text-[11px] text-gray-600",children:["• O ",u(e.exitOdometer)]})]}),(0,a.jsxs)("div",{children:["Entry: ",d(e.gateEntryAt)," ",(0,a.jsxs)("span",{className:"text-[11px] text-gray-600",children:["• O ",u(e.entryOdometer)]})]})]}),(0,a.jsx)(i.Td,{className:"text-center",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1 items-center",children:[(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-orange-600 text-white text-sm font-semibold",onClick:()=>g(e),children:"View"}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-green-600 text-white text-sm font-semibold",onClick:()=>(0,o.du)(e),children:"Print Slip"})]})})]},e.id)),!v.length&&(0,a.jsx)("tr",{children:(0,a.jsx)(i.Td,{colSpan:8,className:"text-center text-gray-500 py-6",children:p?"Loading…":"No requests match your filters."})})]})]})})]}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto p-5 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-orange-900",children:["Request ",u(h.requestCode)]}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-orange-100 text-orange-800 text-sm",onClick:()=>g(null),children:"Close"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[(0,a.jsx)(m,{label:"Applicant",value:"".concat(u(h.applicantName)," (").concat(u(h.employeeId),")")}),(0,a.jsx)(m,{label:"Department",value:u(h.department)}),(0,a.jsx)(m,{label:"Travel Date",value:u(h.dateOfTravel)}),(0,a.jsx)(m,{label:"Time",value:"".concat(u(h.timeFrom)," - ").concat(u(h.timeTo))}),(0,a.jsx)(m,{label:"Route",value:"".concat(u(h.fromLocation)," → ").concat(u(h.toLocation))}),(0,a.jsx)(m,{label:"Purpose",value:u(h.officialDescription)}),(0,a.jsx)(m,{label:"Goods",value:u(h.goods)}),(0,a.jsx)(m,{label:"Status",value:u(h.status)}),(0,a.jsx)(m,{label:"Assigned Vehicle",value:u(h.assignedVehicleNumber)}),(0,a.jsx)(m,{label:"Assigned Driver",value:"".concat(u(h.assignedDriverName)," ").concat(h.assignedDriverPhone?"(".concat(h.assignedDriverPhone,")"):"")}),(0,a.jsx)(m,{label:"Scheduled Pickup",value:d(h.scheduledPickupAt)}),(0,a.jsx)(m,{label:"Scheduled Return",value:d(h.scheduledReturnAt)}),(0,a.jsx)(m,{label:"Gate Exit",value:"".concat(d(h.gateExitAt)," • O ").concat(u(h.exitOdometer))}),(0,a.jsx)(m,{label:"Gate Entry",value:"".concat(d(h.gateEntryAt)," • O ").concat(u(h.entryOdometer))}),(0,a.jsx)(m,{label:"Created At",value:d(h.createdAt)}),(0,a.jsx)(m,{label:"Updated At",value:d(h.updatedAt)})]})]})})]})}function m(e){let{label:t,value:s}=e;return(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-100 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-[11px] uppercase tracking-wide text-orange-700",children:t}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:s})]})}},78827:(e,t,s)=>{s.d(t,{A:()=>l});var a=s(95155);s(12115);var r=s(86651),n=s(65229);function l(e){let{value:t,onChange:s,placeholder:l="Search…",className:i=""}=e;return(0,a.jsxs)("div",{className:"relative ".concat(i),children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(r.A,{size:18,className:"text-orange-500"})}),(0,a.jsx)("input",{value:t,onChange:e=>s(e.target.value),placeholder:l,autoComplete:"off",className:"w-full border border-orange-200 rounded-xl px-10 py-3 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 text-sm bg-white placeholder-orange-400/70 text-orange-900 font-medium transition-all duration-200 shadow-sm hover:shadow-md"}),t&&(0,a.jsx)("button",{onClick:()=>s(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:bg-orange-100 rounded-r-xl transition-colors","aria-label":"Clear search",children:(0,a.jsx)(n.A,{size:18,className:"text-orange-500 hover:text-orange-700"})})]})}}}]);