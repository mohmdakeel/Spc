(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{36710:(e,s,r)=>{"use strict";r.d(s,{A:()=>N});var a=r(95155),t=r(52619),l=r.n(t),n=r(15239),o=r(20063),i=r(65993),d=r(91169),c=r(20508),x=r(17910),m=r(15870),h=r(54485),g=r(80534),p=r(50069),u=r(84926),f=r(68209),j=r(12115);let b=[{text:"Dashboard",icon:i.A,path:"/dashboard",roles:["ADMIN","AUTH_ADMIN","HRD","HOD","GM","CHAIRMAN","TRANSPORT_ADMIN","TRANSPORT","VEHICLE_INCHARGE"],perm:"READ"},{text:"Employees",icon:d.A,path:"/employees",roles:["ADMIN","HRD","HOD","GM","TRANSPORT_ADMIN"],perm:"READ"},{text:"Users",icon:c.A,path:"/users",roles:["ADMIN","AUTH_ADMIN","HRD"],perm:"READ"},{text:"Roles",icon:x.A,path:"/roles",roles:["ADMIN"],perm:"READ"},{text:"Permissions",icon:m.A,path:"/permissions",roles:["ADMIN"],perm:"READ"},{text:"History",icon:h.A,path:"/history",roles:["ADMIN","AUTH_ADMIN","HRD","HOD","GM","TRANSPORT_ADMIN"],perm:"READ"},{text:"Reports",icon:g.A,path:"/reports",roles:["ADMIN","HRD","HOD","GM","CHAIRMAN"],perm:"READ"}];function N(e){let{user:s,isOpen:r,onClose:t}=e,i=(0,o.usePathname)()||"";(0,o.useRouter)();let[d,c]=(0,j.useState)(!1),x=b.filter(e=>{var r,a,t;return(!(r=e.roles)||0===r.length||r.some(e=>{var r;return null==(r=s.roles)?void 0:r.includes(e)}))&&(!(a=e.perm)||(null==(t=s.permissions)?void 0:t.includes(a)))}),h=async()=>{try{await (0,f.ri)()}finally{window.location.href="/login"}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("aside",{className:"hod-sidebar w-64 min-w-64 shrink-0 h-screen sticky top-0 bg-orange-100 p-4 border-r border-orange-200 flex flex-col transition-transform duration-300 ".concat(r?"translate-x-0":"-translate-x-full"," md:translate-x-0"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-2xl border border-orange-200 bg-white/80 flex items-center justify-center shadow-sm",children:(0,a.jsx)(n.default,{src:"/spclogopic.png",alt:"State Printing Corporation logo",width:36,height:36,className:"object-contain",priority:!0})}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h1",{className:"font-bold text-sm text-orange-900 leading-tight truncate",children:"State Printing Corporation"}),(0,a.jsx)("p",{className:"text-xs text-orange-700/70 truncate",children:"Auth Service Control"})]})]}),(0,a.jsx)("nav",{className:"space-y-1 flex-1",children:x.map(e=>{let s,r=e.icon,n=i===(s=e.path)||i.startsWith("".concat(s,"/"));return(0,a.jsxs)(l(),{href:e.path,onClick:t,className:"hod-sidebar__item ".concat(n?"is-active":""),"aria-current":n?"page":void 0,children:[(0,a.jsx)(r,{size:18}),(0,a.jsx)("span",{className:"truncate",children:e.text})]},e.text)})}),(0,a.jsxs)("div",{className:"pt-4 mt-6 border-t border-orange-200 space-y-2",children:[(0,a.jsxs)(l(),{href:"/profile",onClick:t,className:"hod-sidebar__link",children:[(0,a.jsx)(p.A,{size:18}),(0,a.jsx)("span",{children:"Profile"})]}),(0,a.jsxs)(l(),{href:"/settings",onClick:t,className:"hod-sidebar__link",children:[(0,a.jsx)(m.A,{size:18}),(0,a.jsx)("span",{children:"Settings"})]}),(0,a.jsxs)("button",{onClick:()=>c(!0),className:"hod-sidebar__danger",children:[(0,a.jsx)(u.A,{size:18}),(0,a.jsx)("span",{children:"Logout"})]})]})]}),d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 z-50 grid place-items-center p-4",onClick:()=>c(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-sm overflow-hidden border border-orange-200",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 border-b bg-orange-50",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg border border-orange-200 bg-white/80 flex items-center justify-center overflow-hidden",children:(0,a.jsx)(n.default,{src:"/spclogopic.png",alt:"SPC",width:32,height:32,className:"object-contain"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-orange-900",children:"Logout"}),(0,a.jsx)("p",{className:"text-xs text-orange-700/80",children:"Are you sure you want to logout?"})]})]}),(0,a.jsxs)("div",{className:"px-4 py-3 flex justify-end gap-2 bg-white",children:[(0,a.jsx)("button",{className:"px-4 py-2 rounded border border-orange-200 text-orange-700 hover:bg-orange-50",onClick:()=>c(!1),children:"Cancel"}),(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-orange-600 text-white hover:bg-orange-700",onClick:()=>{c(!1),h()},children:"Yes, logout"})]})]})})]})}},44345:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>N});var a=r(95155),t=r(12115),l=r(43566),n=r(36710),o=r(37621),i=r(4259),d=r(20508),c=r(23664),x=r(71871),m=r(17910),h=r(5370),g=r(95664),p=r(42529),u=r(78874),f=r(70532),j=r(57828),b=r(46046);function N(){var e,s,r,N;let{user:w,setUser:v}=(0,i.A)(),[y,A]=(0,t.useState)(""),[C,P]=(0,t.useState)(""),[D,R]=(0,t.useState)(""),[k,S]=(0,t.useState)(!1),[_,M]=(0,t.useState)(!1),[I,E]=(0,t.useState)(!1),[H,U]=(0,t.useState)(""),[z,T]=(0,t.useState)(""),[O,F]=(0,t.useState)(!1),[G,L]=(0,t.useState)(!1),q=null!=(N=null!=(r=null==w?void 0:w.username)?r:null==w?void 0:w.email)?N:"",[V,W]=(0,t.useState)(!1),Y=e=>{var s;return!!(null==w||null==(s=w.permissions)?void 0:s.includes(e))},B=Y("READ")||Y("PERM_READ")||(null==w||null==(e=w.roles)?void 0:e.includes("ADMIN")),J=async e=>{if(e.preventDefault(),T(""),U(""),C!==D)return void T("New passwords do not match");if(C.length<6)return void T("New password must be at least 6 characters long");F(!0);try{await o.A.post("/auth/change-password",{oldPassword:y,newPassword:C}),U("Password changed successfully!"),A(""),P(""),R("")}catch(e){var s,r;T((null==e||null==(r=e.response)||null==(s=r.data)?void 0:s.message)||"Failed to change password")}finally{F(!1)}},K=async e=>{if(!e.target.files||!e.target.files[0])return;let s=e.target.files[0];T(""),U("");try{W(!0);let e=new FormData;e.append("file",s);let{data:r}=await o.A.post("/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),a=r.url;await o.A.post("/auth/me/image",{imageUrl:a}),v&&w&&v({...w,imageUrl:a}),U("Profile photo updated!")}catch(e){var r,a;console.error(e),T((null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||"Failed to upload new photo")}finally{W(!1),e.target.value=""}},Q=()=>L(!G);return w?(0,a.jsxs)("div",{className:"auth-shell",children:[(0,a.jsx)(n.A,{user:w,isOpen:G,onClose:Q}),(0,a.jsxs)("div",{className:"auth-shell__main overflow-hidden",children:[(0,a.jsx)(l.A,{user:w}),(0,a.jsxs)("main",{className:"auth-shell__content",children:[(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Profile Settings"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your account information and security"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Profile Information"}),(0,a.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(d.A,{className:"w-5 h-5 text-orange-600"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-orange-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Username"}),(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:w.username})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)(c.A,{className:"w-5 h-5 text-orange-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:w.email||"Not provided"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-orange-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Full Name"}),(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:w.fullName||"Not provided"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)(x.A,{className:"w-5 h-5 text-orange-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Department"}),(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:w.department||"Not assigned"})]})]}),B&&(0,a.jsxs)("div",{className:"flex items-start gap-4 p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 text-orange-600 mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Roles"}),(0,a.jsx)("div",{className:"flex gap-1 flex-wrap mt-1",children:(null==(s=w.roles)?void 0:s.length)?w.roles.map(e=>(0,a.jsx)("span",{className:"bg-orange-100 text-orange-700 px-2 py-1 rounded-full text-xs font-medium",children:e},e)):(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"None"})})]})]}),B&&w.permissions&&w.permissions.length>0&&(0,a.jsxs)("div",{className:"flex items-start gap-4 p-3 bg-orange-50 rounded-lg",children:[(0,a.jsx)(h.A,{className:"w-5 h-5 text-orange-600 mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Permissions"}),(0,a.jsx)("div",{className:"flex gap-1 flex-wrap mt-1",children:w.permissions.map(e=>(0,a.jsx)("span",{className:"bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs font-medium",children:e},e))})]})]})]})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Profile Picture"}),(0,a.jsx)(g.A,{className:"w-5 h-5 text-orange-600"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)("div",{className:"w-32 h-32 bg-orange-100 rounded-full flex items-center justify-center overflow-hidden border-4 border-orange-200",children:w.imageUrl?(0,a.jsx)("img",{src:w.imageUrl,alt:"Profile",className:"w-full h-full object-cover"}):(0,a.jsx)(d.A,{className:"w-12 h-12 text-orange-600"})}),(0,a.jsxs)("label",{className:"text-orange-600 hover:text-orange-700 text-sm font-medium transition-colors cursor-pointer",children:[V?"Uploading...":"Change Photo",(0,a.jsx)("input",{id:"profilePhotoUpload",name:"profilePhotoUpload",type:"file",accept:"image/*",className:"hidden",disabled:V,onChange:K})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Change Password"}),(0,a.jsx)(h.A,{className:"w-5 h-5 text-orange-600"})]}),(0,a.jsxs)("form",{onSubmit:J,className:"space-y-4",children:[(0,a.jsx)("input",{type:"text",name:"username",autoComplete:"username",value:q,onChange:()=>{},className:"sr-only",inputMode:"text"}),H&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 flex-shrink-0"}),(0,a.jsx)("span",{children:H})]}),z&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2",children:[(0,a.jsx)(u.A,{className:"w-4 h-4 flex-shrink-0"}),(0,a.jsx)("span",{children:z})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"profileCurrentPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:"profileCurrentPassword",name:"profileCurrentPassword",type:k?"text":"password",value:y,onChange:e=>A(e.target.value),placeholder:"Enter current password",autoComplete:"current-password",className:"w-full border border-gray-300 rounded-lg px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all",required:!0,disabled:O}),(0,a.jsx)("button",{type:"button",onClick:()=>S(!k),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",tabIndex:-1,"aria-label":k?"Hide current password":"Show current password",children:k?(0,a.jsx)(f.A,{size:20}):(0,a.jsx)(j.A,{size:20})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"profileNewPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:"profileNewPassword",name:"profileNewPassword",type:_?"text":"password",value:C,onChange:e=>P(e.target.value),placeholder:"Enter new password",autoComplete:"new-password",className:"w-full border border-gray-300 rounded-lg px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all",required:!0,disabled:O}),(0,a.jsx)("button",{type:"button",onClick:()=>M(!_),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",tabIndex:-1,"aria-label":_?"Hide new password":"Show new password",children:_?(0,a.jsx)(f.A,{size:20}):(0,a.jsx)(j.A,{size:20})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"profileConfirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:"profileConfirmPassword",name:"profileConfirmPassword",type:I?"text":"password",value:D,onChange:e=>R(e.target.value),placeholder:"Confirm new password",autoComplete:"new-password",className:"w-full border border-gray-300 rounded-lg px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all",required:!0,disabled:O}),(0,a.jsx)("button",{type:"button",onClick:()=>E(!I),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",tabIndex:-1,"aria-label":I?"Hide confirmation password":"Show confirmation password",children:I?(0,a.jsx)(f.A,{size:20}):(0,a.jsx)(j.A,{size:20})})]})]}),(0,a.jsx)("button",{type:"submit",disabled:O,className:"w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 disabled:bg-orange-400 disabled:cursor-not-allowed transition-all duration-200 font-semibold shadow-md hover:shadow-lg flex items-center justify-center gap-2",children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.A,{className:"w-4 h-4"}),"Update Password"]})})]})]})]})]})]}),(0,a.jsx)("button",{className:"md:hidden fixed bottom-6 right-6 w-14 h-14 bg-orange-600 text-white rounded-full shadow-lg hover:bg-orange-700 transition-all flex items-center justify-center z-40",onClick:Q,children:(0,a.jsx)("span",{className:"text-lg font-bold",children:"â˜°"})})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading profile..."})]})})}},90423:(e,s,r)=>{Promise.resolve().then(r.bind(r,44345))}},e=>{e.O(0,[5125,6394,2619,2587,3566,8441,1255,7358],()=>e(e.s=90423)),_N_E=e.O()}]);