(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4316],{15461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var s=r(95155),a=r(12115),l=r(52619),n=r.n(l),o=r(12008),i=r(35626),d=r(6191),c=r(309),x=r(54485),h=r(11010),m=r(71360),u=r(90368),g=r(27937),b=r(20063),p=r(5601),v=r(95704);function j(e){let{str:t,q:r}=e,a=(null!=t?t:"").toString(),l=r.trim();if(!l)return(0,s.jsx)(s.Fragment,{children:a||"-"});let n=a.toLowerCase(),o=l.toLowerCase(),i=[],d=0;for(;;){let e=n.indexOf(o,d);if(-1===e){i.push(a.slice(d));break}e>d&&i.push(a.slice(d,e)),i.push((0,s.jsx)("span",{className:"bg-orange-100 text-orange-700 rounded px-1",children:a.slice(e,e+l.length)},e)),d=e+l.length}return(0,s.jsx)(s.Fragment,{children:i.length?i:"-"})}function y(){let e=(0,b.useRouter)(),t=(v.env.NEXT_PUBLIC_TRANSPORT_BASE||"https://YOUR-BACKEND.fly.dev").replace(/\/+$/,""),r=t?"".concat(t,"/api"):"/tapi",[l,y]=(0,a.useState)(!0),[N,f]=(0,a.useState)([]),[w,q]=(0,a.useState)("vehicleNumber"),[C,k]=(0,a.useState)(""),[A,D]=(0,a.useState)(null),[S,R]=(0,a.useState)(1),[E,F]=(0,a.useState)(null),L=(0,a.useCallback)(async()=>{var e,t,s;y(!0);try{let s=await fetch("".concat(r,"/driver-service-requests"),{cache:"no-store"});if(!s.ok)throw Error("Failed to fetch driver service requests");let a=await s.json(),l=null!=(t=null==a||null==(e=a.data)?void 0:e.content)?t:[];f(Array.isArray(l)?l:[])}catch(e){o.oR.error(null!=(s=null==e?void 0:e.message)?s:"Failed to load requests"),f([])}finally{y(!1)}},[r]);(0,a.useEffect)(()=>{L()},[L]);let z=(0,a.useMemo)(()=>{if(!A)return N;let e=A.query.toLowerCase();switch(A.mode){case"vehicleNumber":return N.filter(t=>{var r;return(null!=(r=t.vehicleNumber)?r:"").toLowerCase().includes(e)});case"driverName":return N.filter(t=>{var r;return(null!=(r=t.driverName)?r:"").toLowerCase().includes(e)});case"requestDate":return N.filter(e=>{var t;let r=(null!=(t=e.requestDate)?t:"").trim();return r===A.query||r.startsWith(A.query)});default:return N}},[N,A]);(0,a.useEffect)(()=>{R(1)},[w]);let P=Math.max(1,Math.ceil(z.length/10)),_=(S-1)*10,M=z.slice(_,_+10),O=e=>R(Math.min(P,Math.max(1,e))),T=async()=>{var e,t,s;if(E)try{let s=await fetch("".concat(r,"/driver-service-requests/").concat(E.id),{method:"DELETE"});if(!s.ok)throw Error(null!=(t=null==(e=await s.json())?void 0:e.message)?t:"Failed to delete");o.oR.success("Request deleted"),F(null),await L()}catch(e){o.oR.error(null!=(s=null==e?void 0:e.message)?s:"Failed to delete")}},B=e=>null==e||""===e?"-":String(e);return(0,s.jsx)(p.A,{children:(0,s.jsxs)("div",{className:"w-full min-h-screen p-3 sm:p-4 bg-gray-50",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-3 sm:p-4",children:[(0,s.jsx)("div",{className:"flex items-center mb-3 sm:mb-4",children:(0,s.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center gap-2 text-orange-600 hover:text-orange-800 p-2 rounded-lg hover:bg-orange-50 mr-3 sm:mr-4",children:[(0,s.jsx)(i.A,{size:20}),"Back"]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h1",{className:"text-lg sm:text-xl font-bold text-gray-800",children:"Driver Service Requests"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(n(),{href:"/Dewmini/Transport/Admin/DriverServiceRequestForm",className:"flex items-center gap-2 bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 shadow-sm transition-colors text-xs sm:text-sm",children:[(0,s.jsx)(d.A,{size:16}),"Add"]}),(0,s.jsxs)("button",{className:"flex items-center gap-2 bg-orange-100 text-orange-700 border border-orange-200 px-3 py-2 rounded-lg hover:bg-orange-200 shadow-sm transition-colors text-xs sm:text-sm",onClick:()=>window.print(),children:[(0,s.jsx)(c.A,{size:16}),"Print"]})]})]}),(0,s.jsx)("div",{className:"border border-orange-100 rounded-lg p-3 bg-orange-50/40 mb-4",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("div",{className:"inline-flex rounded-lg overflow-hidden border border-orange-200",children:[{k:"vehicleNumber",label:"Vehicle No"},{k:"driverName",label:"Driver"},{k:"requestDate",label:"Request Date"}].map(e=>{let{k:t,label:r}=e,a=w===t;return(0,s.jsx)("button",{type:"button",onClick:()=>q(t),className:"px-3 py-1.5 text-sm ".concat(a?"bg-orange-600 text-white":"bg-white text-orange-700 hover:bg-orange-100"),children:r},t)})}),"requestDate"===w?(0,s.jsx)("input",{type:"date",value:C,onChange:e=>k(e.target.value),className:"border border-orange-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-200"}):(0,s.jsx)("input",{type:"text",value:C,onChange:e=>k(e.target.value),placeholder:"vehicleNumber"===w?"Search vehicle e.g., SPC-2025":"Search driver name",className:"border border-orange-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-200 flex-1 min-w-[12rem]"}),(0,s.jsx)("button",{type:"button",onClick:()=>{let e=C.trim();if(!e)return void D(null);D({mode:w,query:e}),R(1)},className:"px-3 py-2 text-sm rounded-lg bg-orange-600 text-white hover:bg-orange-700",children:"Search"}),(0,s.jsx)("button",{type:"button",onClick:()=>{k(""),D(null),R(1)},className:"px-3 py-2 text-sm rounded-lg bg-white text-orange-700 border border-orange-200 hover:bg-orange-100",children:"Clear"}),A&&(0,s.jsxs)("span",{className:"text-xs text-orange-700 ml-1",children:["Filtering by ",(0,s.jsx)("b",{children:A.mode}),": “",A.query,"”"]})]})}),l?(0,s.jsxs)("div",{className:"text-center py-16 text-gray-900",children:[(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mb-3"}),"Loading requests…"]}):(0,s.jsx)("div",{className:"overflow-x-auto rounded-lg border border-orange-100 shadow-sm",children:(0,s.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,s.jsx)("thead",{className:"bg-orange-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border px-2 py-1 text-center text-xs font-semibold text-orange-800",children:"#"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Vehicle"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Driver"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"EPF"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Request Date"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Services"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"KM (Last/Next/Current)"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Officer Advice"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Mechanic Advice"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"HR Approval"}),(0,s.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:M.length>0?M.map((e,t)=>{var r;let a;return(0,s.jsxs)("tr",{className:"bg-gray-50 text-gray-900 hover:bg-orange-100 transition-colors ".concat(""),children:[(0,s.jsx)("td",{className:"border px-2 py-1 text-center text-xs",children:_+t+1}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs font-medium",children:(null==A?void 0:A.mode)==="vehicleNumber"?(0,s.jsx)(j,{str:e.vehicleNumber,q:A.query}):B(e.vehicleNumber)}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:(null==A?void 0:A.mode)==="driverName"?(0,s.jsx)(j,{str:e.driverName,q:A.query}):B(e.driverName)}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:B(e.epf)}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:(null==A?void 0:A.mode)==="requestDate"?(0,s.jsx)(j,{str:e.requestDate,q:A.query}):(a=e.requestDate)?new Date(a).toLocaleDateString():"-"}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:(null==(r=e.servicesNeeded)?void 0:r.length)?e.servicesNeeded.join(", "):"-"}),(0,s.jsxs)("td",{className:"border px-2 py-1 text-xs",children:[B(e.lastServiceReadingKm)," / ",B(e.nextServiceReadingKm)," / ",B(e.currentReadingKm)]}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:B(e.adviceByVehicleOfficer)}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:B(e.adviceByMechanic)}),(0,s.jsx)("td",{className:"border px-2 py-1 text-xs",children:(0,s.jsx)("span",{className:"px-2 py-0.5 rounded text-[11px] ".concat("APPROVED"===e.hrApproval?"bg-green-100 text-green-700":"REJECTED"===e.hrApproval?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:e.hrApproval})}),(0,s.jsxs)("td",{className:"border px-2 py-1 text-xs text-center",children:[(0,s.jsx)("button",{onClick:()=>o.oR.info("Hook to history"),className:"px-1 text-orange-600 hover:text-orange-800",title:"History",children:(0,s.jsx)(x.A,{size:14})}),(0,s.jsx)(n(),{href:"".concat("/Dewmini/Transport/Admin/DriverServiceRequestEditForm","?id=").concat(e.id),className:"px-1 text-green-600 hover:text-green-800 inline-flex",title:"Edit",children:(0,s.jsx)(h.A,{size:14})}),(0,s.jsx)("button",{onClick:()=>F(e),className:"px-1 text-red-600 hover:text-red-800",title:"Delete",children:(0,s.jsx)(m.A,{size:14})})]})]},e.id)}):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:11,className:"text-center py-6 text-gray-700 text-xs bg-gray-50",children:"No driver service requests found."})})})]})}),(0,s.jsxs)("div",{className:"flex justify-center items-center gap-2 mt-3",children:[(0,s.jsx)("button",{onClick:()=>O(S-1),disabled:1===S,className:"px-2 py-1 rounded ".concat(1===S?"text-gray-500 cursor-not-allowed bg-gray-100":"bg-orange-100 text-orange-600 hover:bg-orange-200"),children:(0,s.jsx)(u.A,{size:16})}),(0,s.jsxs)("span",{className:"px-2 py-1 text-xs text-gray-800",children:["Page ",S," of ",P]}),(0,s.jsx)("button",{onClick:()=>O(S+1),disabled:S===P,className:"px-2 py-1 rounded ".concat(S===P?"text-gray-500 cursor-not-allowed bg-gray-100":"bg-orange-100 text-orange-600 hover:bg-orange-200"),children:(0,s.jsx)(g.A,{size:16})})]})]}),E&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white p-4 rounded shadow-md w-80 text-gray-900",children:[(0,s.jsx)("h2",{className:"font-bold mb-2",children:"Delete Request"}),(0,s.jsxs)("p",{className:"mb-4",children:["Are you sure you want to delete request #",E.id,"?"]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{onClick:()=>F(null),className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 text-gray-800",children:"Cancel"}),(0,s.jsx)("button",{onClick:T,className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]})})]})})}},36536:(e,t,r)=>{Promise.resolve().then(r.bind(r,15461))}},e=>{e.O(0,[970,6394,2619,5634,5601,8441,1255,7358],()=>e(e.s=36536)),_N_E=e.O()}]);