(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5082],{33974:(e,t,r)=>{Promise.resolve().then(r.bind(r,94993))},52669:(e,t,r)=>{"use strict";r.d(t,{ae:()=>n});var a=r(78447);let s=e=>{var t,r,a;return{id:e.id,entityType:"Vehicle"===e.entityType||"Driver"===e.entityType?e.entityType:"Vehicle",entityId:e.entityId,action:"Created"===e.action||"Updated"===e.action||"Deleted"===e.action?e.action:"Updated",previousData:null!=(t=e.previousJson)?t:null,newData:null!=(r=e.newJson)?r:null,performedBy:null!=(a=e.performedBy)?a:null,timestamp:e.timestamp}};async function n(e,t){let{data:r}=await a.A.get("/api/history/".concat(e,"/").concat(t));return(0,a.I)(r).map(s)}},78447:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,I:()=>i});var a=r(95125),s=r(95704);let n="https://c7585f1b998c.ngrok-free.app".replace(/\/$/,""),l=Math.min(Number(s.env.NEXT_PUBLIC_API_TIMEOUT)||1e4,15e3),o=a.A.create({baseURL:n?"".concat(n,"/api"):"/api",headers:{"Content-Type":"application/json"},timeout:l});function i(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}},94993:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var a=r(95155),s=r(12115),n=r(12008),l=r(35626),o=r(309),i=r(54485),d=r(90368),c=r(27937),x=r(20063),g=r(5601),m=r(71360),b=r(89559),h=r(6191),u=r(35619),p=r(65229),y=r(26983),f=r(23327);function j(e){let{prevData:t,currentData:r,onClose:s,title:n,action:l,timestamp:o}=e,i=Array.from(new Set([...Object.keys(t||{}),...Object.keys(r||{})]));return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-orange-50 rounded-xl shadow-xl w-full max-w-5xl overflow-hidden border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-orange-200 bg-orange-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u.A,{size:22,className:"text-orange-700"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-orange-900",children:n||"Data Comparison"})]}),(0,a.jsx)("button",{onClick:s,className:"p-2 rounded-lg hover:bg-orange-200 text-orange-700 transition-all","aria-label":"Close",children:(0,a.jsx)(p.A,{size:22})})]}),(l||o)&&(0,a.jsx)("div",{className:"px-6 py-4 bg-orange-75 border-b border-orange-200",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 text-sm text-orange-700",children:[l&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-100 rounded-lg",children:[(0,a.jsx)(b.A,{size:16,className:"text-orange-600"}),(0,a.jsx)("span",{className:"font-medium",children:"Action:"}),(0,a.jsx)("span",{className:"font-semibold text-orange-800",children:l})]}),o&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-100 rounded-lg",children:[(0,a.jsx)(y.A,{size:16,className:"text-orange-600"}),(0,a.jsx)("span",{className:"font-medium",children:"When:"}),(0,a.jsx)("span",{className:"font-semibold text-orange-800",children:new Date(o).toLocaleString()})]})]})}),(0,a.jsx)("div",{className:"p-6 bg-white overflow-auto max-h-[65vh]",children:(0,a.jsx)("div",{className:"border border-orange-200 rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-orange-100 text-orange-800",children:[(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Field"}),(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Previous Value"}),(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Current Value"})]})}),(0,a.jsx)("tbody",{children:i.map((e,s)=>{var n,l;let o=null!=(n=null==t?void 0:t[e])?n:"-",i=null!=(l=null==r?void 0:r[e])?l:"-",d=o!==i;return(0,a.jsxs)("tr",{className:"".concat(s%2==0?"bg-orange-50":"bg-orange-100/30"," ").concat(d?"!bg-yellow-50":""),children:[(0,a.jsx)("td",{className:"px-5 py-3 font-semibold text-orange-700 border-b border-orange-200/50",children:e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace(/_/g," ").trim()}),(0,a.jsx)("td",{className:"px-5 py-3 border-b border-orange-200/50 ".concat(d?"text-red-600 line-through font-medium":"text-orange-900"),children:String(o)}),(0,a.jsx)("td",{className:"px-5 py-3 border-b border-orange-200/50 ".concat(d?"text-green-600 font-semibold":"text-orange-900"),children:String(i)})]},e)})})]})})}),(0,a.jsx)("div",{className:"px-6 py-4 flex justify-end border-t border-orange-200 bg-orange-100",children:(0,a.jsx)("button",{onClick:s,className:"px-5 py-2.5 rounded-lg bg-orange-600 text-white hover:bg-orange-700 transition-all font-semibold shadow-md hover:shadow-lg",children:"Close"})})]})})}var N=r(78447),v=r(52669);async function w(e){try{let{data:t}=await N.A.get("".concat("/drivers","/").concat(e));return(0,N.I)(t)}catch(e){var t,r;throw Error((null==e||null==(r=e.response)||null==(t=r.data)?void 0:t.message)||(null==e?void 0:e.message)||"Driver not found")}}async function C(e){try{let{data:t}=await N.A.get("".concat("/vehicles","/").concat(e));return(0,N.I)(t)}catch(e){var t,r;throw Error((null==e||null==(r=e.response)||null==(t=r.data)?void 0:t.message)||(null==e?void 0:e.message)||"Vehicle not found")}}function S(e){let{item:t,onClose:r}=e,[l,o]=(0,s.useState)(!1),[i,d]=(0,s.useState)(null),[x,g]=(0,s.useState)(!1),N=(0,s.useMemo)(()=>(e=>{if(!e)return{};if("object"==typeof e)return e;try{return JSON.parse(e)}catch(e){return{}}})(t.previousData),[t.previousData]),v="Deleted"===t.action?"bg-red-100 text-red-800 border-red-200":"Updated"===t.action?"bg-yellow-100 text-yellow-800 border-yellow-200":"Created"===t.action?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-800 border-gray-200",S="Deleted"===t.action?(0,a.jsx)(m.A,{size:18}):"Updated"===t.action?(0,a.jsx)(b.A,{size:18}):"Created"===t.action?(0,a.jsx)(h.A,{size:18}):(0,a.jsx)(u.A,{size:18}),A="Updated"===t.action&&Object.keys(N).length>0;(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]);let k=async()=>{if(A)try{g(!0);let e="Driver"===t.entityType?await w(String(t.entityId)):await C(String(t.entityId));d(e),o(!0)}catch(e){n.oR.error(e instanceof Error?e.message:"Failed to fetch current entity data")}finally{g(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&r()},role:"dialog","aria-modal":"true","aria-labelledby":"history-modal-title",children:(0,a.jsxs)("div",{className:"bg-orange-50 rounded-xl shadow-xl w-full max-w-4xl overflow-hidden border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-orange-200 bg-orange-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(u.A,{size:22,className:"text-orange-700"}),(0,a.jsxs)("h2",{id:"history-modal-title",className:"text-xl font-bold text-orange-900",children:["Change History • ",t.entityType," #",String(t.entityId)]})]}),(0,a.jsx)("button",{type:"button",onClick:r,className:"p-2 rounded-lg hover:bg-orange-200 text-orange-700 transition-all","aria-label":"Close",title:"Close",children:(0,a.jsx)(p.A,{size:22})})]}),(0,a.jsxs)("div",{className:"p-6 bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg border ".concat(v),children:[S,(0,a.jsxs)("span",{className:"font-semibold",children:[t.action," by ",t.performedBy||"Unknown"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-orange-700",children:[(0,a.jsx)(y.A,{size:18}),(0,a.jsx)("span",{className:"font-medium",children:new Date(t.timestamp).toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"font-semibold text-orange-800 mb-3 flex items-center gap-2 text-lg",children:[(0,a.jsx)(c.A,{size:20,className:"text-orange-600"})," Previous Version Snapshot"]}),(0,a.jsx)("div",{className:"border border-orange-200 rounded-lg overflow-hidden bg-orange-50",children:(0,a.jsx)("div",{className:"overflow-auto max-h-80",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"sticky top-0 z-10",children:(0,a.jsxs)("tr",{className:"bg-orange-100 text-orange-800",children:[(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold w-1/3 min-w-[180px] border-b border-orange-200",children:"Field"}),(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Value"})]})}),(0,a.jsx)("tbody",{children:0===Object.keys(N).length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:2,className:"text-center p-6 text-orange-600",children:"No previous data available"})}):Object.entries(N).map((e,t)=>{let[r,s]=e;return(0,a.jsxs)("tr",{className:"align-top ".concat(t%2==0?"bg-orange-50":"bg-orange-100/30"),children:[(0,a.jsx)("td",{className:"px-5 py-3 font-semibold text-orange-700 whitespace-nowrap border-b border-orange-200/50",children:r}),(0,a.jsx)("td",{className:"px-5 py-3 text-orange-900 border-b border-orange-200/50",children:(0,a.jsx)("pre",{className:"max-h-24 overflow-auto whitespace-pre-wrap break-words text-sm leading-6 font-medium",children:(e=>{if(null==e)return"—";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}})(s)})})]},r)})})]})})})]}),A?(0,a.jsx)("button",{type:"button",onClick:k,disabled:x,className:"w-full flex items-center justify-center gap-3 bg-orange-600 hover:bg-orange-700 disabled:opacity-60 disabled:cursor-not-allowed text-white px-5 py-3 rounded-lg font-semibold transition-all shadow-md hover:shadow-lg",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.A,{size:18,className:"animate-spin"})," Loading current version…"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{size:18})," Compare With Current Version"]})}):"Deleted"===t.action?(0,a.jsxs)("div",{className:"w-full flex items-center justify-center gap-2 px-5 py-3 rounded-lg bg-orange-100 text-orange-700 border border-orange-200",children:[(0,a.jsx)(f.A,{size:18})," Deleted — compare unavailable"]}):null]})]})}),l&&i&&(0,a.jsx)(j,{prevData:N,currentData:i,onClose:()=>o(!1),title:"Full Field Comparison",action:t.action,timestamp:t.timestamp})]})}let A=(r(95704).env.NEXT_PUBLIC_TRANSPORT_BASE||"https://YOUR-BACKEND.fly.dev").replace(/\/+$/,""),k=A?"".concat(A,"/api"):"/tapi";function D(e){let{str:t,q:r}=e,s=(null!=t?t:"").toString(),n=r.trim();if(!n)return(0,a.jsx)(a.Fragment,{children:s||"-"});let l=s.toLowerCase(),o=n.toLowerCase(),i=[],d=0;for(;;){let e=l.indexOf(o,d);if(-1===e){i.push(s.slice(d));break}e>d&&i.push(s.slice(d,e)),i.push((0,a.jsx)("span",{className:"bg-orange-100 text-orange-700 rounded px-1",children:s.slice(e,e+n.length)},e)),d=e+n.length}return(0,a.jsx)(a.Fragment,{children:i.length?i:"-"})}function E(){let e=(0,x.useRouter)(),[t,r]=(0,s.useState)(!0),[m,b]=(0,s.useState)([]),[h,u]=(0,s.useState)("vehicleNumber"),[p,y]=(0,s.useState)(""),[f,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(1),[C,A]=(0,s.useState)(!1),[E,z]=(0,s.useState)([]),L=async()=>{var e,t,a;r(!0);try{let r=await fetch("".concat(k,"/service-candidates"),{cache:"no-store"});if(!r.ok)throw Error("Failed to fetch service candidates");let a=await r.json(),s=null!=(t=null==a||null==(e=a.data)?void 0:e.content)?t:[];b(Array.isArray(s)?s:[])}catch(e){n.oR.error(null!=(a=null==e?void 0:e.message)?a:"Failed to load service candidates"),b([])}finally{r(!1)}};(0,s.useEffect)(()=>{L()},[]);let T=async e=>{try{let t=await (0,v.ae)("ServiceCandidate",e);if(0===t.length)return void n.oR.info("No history found for this candidate.");z(t),A(!0)}catch(e){var t;n.oR.error(null!=(t=null==e?void 0:e.message)?t:"Failed to load candidate history")}},I=(0,s.useMemo)(()=>{if(!f)return m;let e=f.query.toLowerCase();switch(f.mode){case"vehicleNumber":return m.filter(t=>{var r;return(null!=(r=t.vehicleNumber)?r:"").toLowerCase().includes(e)});case"source":return m.filter(t=>{var r;return(null!=(r=t.source)?r:"").toLowerCase().includes(e)});case"createdDate":{let e=f.query;return m.filter(t=>{var r;let a=(null!=(r=t.createdAt)?r:"").slice(0,10);return a===e||a.startsWith(e)})}default:return m}},[m,f]);(0,s.useEffect)(()=>{w(1)},[h]);let R=Math.max(1,Math.ceil(I.length/10)),F=(N-1)*10,O=I.slice(F,F+10),V=e=>w(Math.min(R,Math.max(1,e))),_=e=>null==e||""===e?"-":String(e);return(0,a.jsx)(g.A,{children:(0,a.jsxs)("div",{className:"w-full min-h-screen p-3 sm:p-4 bg-gray-50",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-3 sm:p-4",children:[(0,a.jsx)("div",{className:"flex items-center mb-3 sm:mb-4",children:(0,a.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center gap-2 text-orange-600 hover:text-orange-800 p-2 rounded-lg hover:bg-orange-50 mr-3 sm:mr-4",children:[(0,a.jsx)(l.A,{size:20}),"Back"]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h1",{className:"text-lg sm:text-xl font-bold text-gray-800",children:"Service Candidates"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("button",{className:"flex items-center gap-2 bg-orange-100 text-orange-700 border border-orange-200 px-3 py-2 rounded-lg hover:bg-orange-200 shadow-sm transition-colors text-xs sm:text-sm",onClick:()=>window.print(),children:[(0,a.jsx)(o.A,{size:16}),"Print"]})})]}),(0,a.jsx)("div",{className:"border border-orange-100 rounded-lg p-3 bg-orange-50/40 mb-4",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("div",{className:"inline-flex rounded-lg overflow-hidden border border-orange-200",children:[{k:"vehicleNumber",label:"Vehicle No"},{k:"source",label:"Source"},{k:"createdDate",label:"Created Date"}].map(e=>{let{k:t,label:r}=e,s=h===t;return(0,a.jsx)("button",{type:"button",onClick:()=>u(t),className:"px-3 py-1.5 text-sm ".concat(s?"bg-orange-600 text-white":"bg-white text-orange-700 hover:bg-orange-100"),children:r},t)})}),"createdDate"===h?(0,a.jsx)("input",{type:"date",value:p,onChange:e=>y(e.target.value),className:"border border-orange-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-200"}):(0,a.jsx)("input",{type:"text",value:p,onChange:e=>y(e.target.value),placeholder:"vehicleNumber"===h?"Search vehicle e.g., SPC-2025":"Search source e.g., DRIVER_REQUEST",className:"border border-orange-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-200 flex-1 min-w-[12rem]"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=p.trim();if(!e)return void j(null);j({mode:h,query:e}),w(1)},className:"px-3 py-2 text-sm rounded-lg bg-orange-600 text-white hover:bg-orange-700",children:"Search"}),(0,a.jsx)("button",{type:"button",onClick:()=>{y(""),j(null),w(1)},className:"px-3 py-2 text-sm rounded-lg bg-white text-orange-700 border border-orange-200 hover:bg-orange-100",children:"Clear"}),f&&(0,a.jsxs)("span",{className:"text-xs text-orange-700 ml-1",children:["Filtering by ",(0,a.jsx)("b",{children:f.mode}),": “",f.query,"”"]})]})}),t?(0,a.jsxs)("div",{className:"text-center py-16 text-gray-900",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mb-3"}),"Loading service candidates…"]}):(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-orange-100 shadow-sm",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,a.jsx)("thead",{className:"bg-orange-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border px-2 py-1 text-center text-xs font-semibold text-orange-800",children:"#"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Vehicle"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Source"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Status"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Reason"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Notes"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Created By"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Created At"}),(0,a.jsx)("th",{className:"border px-2 py-1 text-xs font-semibold text-orange-800",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:O.length>0?O.map((e,t)=>(0,a.jsxs)("tr",{className:"text-gray-900 transition-colors ".concat(f?"bg-orange-50 hover:bg-orange-100":"bg-gray-50 hover:bg-orange-100"),children:[(0,a.jsx)("td",{className:"border px-2 py-1 text-center text-xs",children:F+t+1}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs font-medium",children:(null==f?void 0:f.mode)==="vehicleNumber"?(0,a.jsx)(D,{str:e.vehicleNumber,q:f.query}):_(e.vehicleNumber)}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs",children:(null==f?void 0:f.mode)==="source"?(0,a.jsx)(D,{str:e.source,q:f.query}):_(e.source)}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs",children:(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-[11px] ".concat("ACTIVE"===e.status?"bg-green-100 text-green-700":"RESOLVED"===e.status?"bg-emerald-100 text-emerald-700":"ARCHIVED"===e.status?"bg-gray-200 text-gray-700":"bg-yellow-100 text-yellow-700"),children:e.status})}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs",children:_(e.reason)}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs",children:_(e.notes)}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs",children:_(e.createdBy)}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs",children:(e=>{if(!e)return"-";try{let t=new Date(e);return"".concat(t.toLocaleDateString()," ").concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}catch(t){return e}})(e.createdAt)}),(0,a.jsx)("td",{className:"border px-2 py-1 text-xs text-center",children:(0,a.jsx)("button",{type:"button",onClick:()=>T(e.id),className:"px-1 text-orange-600 hover:text-orange-800",title:"History",children:(0,a.jsx)(i.A,{size:14})})})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"text-center py-6 text-gray-700 text-xs bg-gray-50",children:"No service candidates found."})})})]})}),(0,a.jsxs)("div",{className:"flex justify-center items-center gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:()=>V(N-1),disabled:1===N,className:"px-2 py-1 rounded ".concat(1===N?"text-gray-500 cursor-not-allowed bg-gray-100":"bg-orange-100 text-orange-600 hover:bg-orange-200"),children:(0,a.jsx)(d.A,{size:16})}),(0,a.jsxs)("span",{className:"px-2 py-1 text-xs text-gray-800",children:["Page ",N," of ",R]}),(0,a.jsx)("button",{onClick:()=>V(N+1),disabled:N===R,className:"px-2 py-1 rounded ".concat(N===R?"text-gray-500 cursor-not-allowed bg-gray-100":"bg-orange-100 text-orange-600 hover:bg-orange-200"),children:(0,a.jsx)(c.A,{size:16})})]})]}),C&&E.length>0&&(0,a.jsx)(S,{item:E[0],onClose:()=>A(!1)})]})})}}},e=>{e.O(0,[5125,970,6394,1963,5601,8441,1255,7358],()=>e(e.s=33974)),_N_E=e.O()}]);