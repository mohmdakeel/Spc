(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7169],{41067:(e,r,s)=>{Promise.resolve().then(s.bind(s,54438))},54438:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>d});var t=s(95155),l=s(12115),a=s(22544),i=s(65229),n=s(12008);let o=(s(95704).env.NEXT_PUBLIC_TRANSPORT_BASE||"https://YOUR-BACKEND.fly.dev").replace(/\/+$/,""),c=o?"".concat(o,"/api"):"/tapi";function d(){let e=()=>{},{register:r,handleSubmit:s,reset:o,formState:{errors:d,isSubmitting:m}}=(0,a.mN)(),[u,x]=(0,l.useState)([]),[g,h]=(0,l.useState)(!1),[b,p]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=new AbortController,r=!0;return(async()=>{if(r){h(!0),p(null);try{let s=await fetch("".concat(c,"/vehicles"),{signal:e.signal});if(!s.ok){let e=await s.text().catch(()=>"");throw Error("Failed to fetch vehicles (".concat(s.status,") ").concat(e||"").trim())}let t=await s.json(),l=t;if(!Array.isArray(l)){let e=null==t?void 0:t.data;Array.isArray(null==e?void 0:e.content)?l=e.content:Array.isArray(e)?l=e:Array.isArray(null==t?void 0:t.vehicles)?l=t.vehicles:Array.isArray(null==t?void 0:t.items)?l=t.items:Array.isArray(null==t?void 0:t.results)?l=t.results:Array.isArray(null==t?void 0:t.data)&&(l=t.data)}if(!Array.isArray(l))throw Error("Vehicles response was not an array.");let a=l.filter(e=>e&&"string"==typeof e.vehicleNumber&&""!==e.vehicleNumber.trim());if(!r)return;x(a)}catch(s){if((null==s?void 0:s.name)==="AbortError"||/aborted/i.test((null==s?void 0:s.message)||""))return;let e=(null==s?void 0:s.message)||"Unknown error loading vehicles";if(!r)return;p(e),n.oR.error("❌ ".concat(e))}finally{if(!r)return;h(!1)}}})(),()=>{r=!1,e.abort()}},[]);let f=(0,l.useMemo)(()=>!g&&0===u.length,[g,u]),v=async r=>{try{var s,t;if(!u.some(e=>e.vehicleNumber===r.vehicleNumber))return void n.oR.error("❌ Selected vehicle is not in the database.");let l=null!=(t=null==(s=r.servicesNeeded)?void 0:s.split(",").map(e=>e.trim()).filter(Boolean))?t:[],a={...r,servicesNeeded:l},i=await fetch("".concat(c,"/driver-service-requests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let e="";try{let r=await i.json();e=(null==r?void 0:r.message)||JSON.stringify(r)}catch(r){e=await i.text()}throw Error(e||"Server returned ".concat(i.status))}n.oR.success("✅ Driver Service Request saved successfully!"),o(),e()}catch(e){console.error("Error saving request:",e),n.oR.error("❌ Failed to save: ".concat((null==e?void 0:e.message)||"Unknown error"))}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50 p-2 sm:p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-none sm:rounded-xl shadow-xl w-full h-full sm:h-auto sm:max-h-[90vh] sm:w-[min(100%,48rem)] overflow-hidden flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 sm:px-6 py-3 border-b bg-orange-50",children:[(0,t.jsx)("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-orange-900",children:"Add Driver Service Request"}),(0,t.jsx)("button",{onClick:e,className:"p-2 rounded-lg hover:bg-orange-100 text-orange-600 transition-colors","aria-label":"Close",type:"button",children:(0,t.jsx)(i.A,{size:20})})]}),(0,t.jsxs)("form",{onSubmit:s(v),className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-5",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:["Vehicle Number ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{...r("vehicleNumber",{required:"Vehicle number is required"}),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200 disabled:opacity-60",disabled:g||f,defaultValue:"",children:[(0,t.jsx)("option",{value:"",disabled:!0,children:g?"Loading vehicles...":f?"No vehicles available":"Select a Vehicle"}),u.map((e,r)=>{var s,l;return(0,t.jsx)("option",{value:e.vehicleNumber,children:e.vehicleNumber},null!=(l=null!=(s=e.id)?s:e.vehicleNumber)?l:r)})]}),b&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:b}),d.vehicleNumber&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.vehicleNumber.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:["EPF ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{...r("epf",{required:"EPF is required"}),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"e.g., EMP123"}),d.epf&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.epf.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Driver Name"}),(0,t.jsx)("input",{...r("driverName"),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"e.g., John Silva"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:["Request Date ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{type:"date",...r("requestDate",{required:"Request date is required"}),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200"}),d.requestDate&&(0,t.jsx)("p",{className:"text-red-500 text-xs mt-1",children:d.requestDate.message})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Services Needed"}),(0,t.jsx)("input",{...r("servicesNeeded"),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"Comma separated e.g., Oil filter, Tyre check"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Last Service Reading (Km)"}),(0,t.jsx)("input",{type:"number",inputMode:"numeric",...r("lastServiceReadingKm",{valueAsNumber:!0}),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"e.g., 15000"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Next Service Reading (Km)"}),(0,t.jsx)("input",{type:"number",inputMode:"numeric",...r("nextServiceReadingKm",{valueAsNumber:!0}),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"e.g., 20000"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Current Reading (Km)"}),(0,t.jsx)("input",{type:"number",inputMode:"numeric",...r("currentReadingKm",{valueAsNumber:!0}),className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"e.g., 19850"})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Advice by Vehicle Officer"}),(0,t.jsx)("textarea",{...r("adviceByVehicleOfficer"),rows:2,className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"Enter advice"})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Advice by Mechanic"}),(0,t.jsx)("textarea",{...r("adviceByMechanic"),rows:2,className:"w-full border border-orange-200 rounded-lg px-3 py-2.5 text-sm focus:ring-2 focus:ring-orange-200",placeholder:"Enter mechanic advice"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t border-orange-100",children:[(0,t.jsx)("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm rounded-lg bg-gray-100 hover:bg-gray-200",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm rounded-lg bg-orange-600 text-white hover:bg-orange-700 disabled:opacity-60",children:m?"Saving...":"Save"})]})]})]})})}},65229:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])}},e=>{e.O(0,[970,2544,8441,1255,7358],()=>e(e.s=41067)),_N_E=e.O()}]);