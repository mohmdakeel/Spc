(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7e3],{4259:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(12115),s=r(68209),l=r(20063);let n=["/login","/_error","/403"],o="auth:user-cache",i=()=>{try{let e=window.sessionStorage.getItem(o);if(!e)return null;let t=JSON.parse(e);if(!(null==t?void 0:t.user)||!(null==t?void 0:t.ts)||Date.now()-t.ts>3e5)return null;return t.user}catch(e){return null}},u=e=>{try{e?window.sessionStorage.setItem(o,JSON.stringify({user:e,ts:Date.now()})):window.sessionStorage.removeItem(o)}catch(e){}},c=()=>{let e=i(),[t,r]=(0,a.useState)(e),[o,c]=(0,a.useState)(!e),[d,m]=(0,a.useState)(null),p=(0,l.useRouter)(),h=(0,l.usePathname)(),x=(0,a.useRef)(!1),f=e=>{x.current&&(r(e),u(e))};(0,a.useEffect)(()=>{x.current=!0;let e=!1,t=n.some(e=>null==h?void 0:h.startsWith(e)),r=()=>{null!=h&&h.startsWith("/login")||p.replace("/login")};return t?(c(!1),m(null),()=>{x.current=!1,e=!0}):((async()=>{m(null);let t=i();t&&f(t);let a=!t;a&&c(!0);try{let t=await (0,s.me)();if(e||!x.current)return;if(!t){f(null),m(null),u(null),(0,s.bC)(),r();return}f(t),m(null),(0,s.bC)()}catch(t){var l,n;if(console.error("Auth check failed:",t),e||!x.current)return;m((null==t||null==(n=t.response)||null==(l=n.data)?void 0:l.message)||(null==t?void 0:t.message)||"Authentication failed"),f(null),u(null),(0,s.bC)(),r()}finally{!e&&x.current&&a&&c(!1)}})(),()=>{e=!0,x.current=!1})},[h,p]);let g=async()=>{if(!x.current)return null;c(!0),m(null);try{let e=await (0,s.me)();if(!x.current)return null;if(!e)return f(null),m("Session expired. Please sign in again."),(0,s.bC)(),(null==h?void 0:h.startsWith("/login"))||p.replace("/login"),null;return(0,s.bC)(),f(e),m(null),e}catch(r){var e,t;throw m((null==(t=r.response)||null==(e=t.data)?void 0:e.message)||"Failed to refresh user data"),r}finally{c(!1)}};return(0,a.useEffect)(()=>{(null==t?void 0:t.username)?window.localStorage.setItem("username",t.username):window.localStorage.removeItem("username")},[null==t?void 0:t.username]),{user:t,setUser:f,loading:o,error:d,refresh:g,hasRole:e=>{if(!(null==t?void 0:t.roles))return!1;let r=Array.isArray(e)?e:[e],a=t.roles.map(e=>e.toUpperCase());return r.some(e=>a.includes(e.toUpperCase()))},can:e=>{if(!(null==t?void 0:t.permissions))return!1;let r=Array.isArray(e)?e:[e];return t.permissions.some(e=>r.includes(e))},hasAnyRole:()=>!!((null==t?void 0:t.roles)&&t.roles.length>0)}}},11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>x,Lh:()=>u,bB:()=>s,bk:()=>c,cK:()=>n,iq:()=>i,iv:()=>o,kM:()=>h,lm:()=>l,qd:()=>f,rg:()=>m,rr:()=>d,uK:()=>p});var a=r(81242);async function s(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:s}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,a.I)(s)}async function n(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(r){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function o(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function i(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let u=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),c=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function p(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:s}=await a.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,a.I)(s)}async function h(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&s.push(...t.exitManifest),s.length&&(r.exitManifest=s);let{data:l}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,a.I)(l)}async function x(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&s.push(...t.entryManifest),s.length&&(r.entryManifest=s);let{data:l}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,a.I)(l)}async function f(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},12667:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var a=r(95155),s=r(12115),l=r(20063),n=r(47650),o=r(22544),i=r(76907),u=r(70532),c=r(57828),d=r(4259),m=r(68209),p=r(37621),h=r(99947),x=r(11924);function f(){let e=new Date,t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),a=String(e.getUTCDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(a)}let g="/Akeel/Applicant/MyRequests",y=e=>(null!=e?e:"").replace(/[^\d+()\-\s./]/g,"").replace(/\s{2,}/g," ").trim();function v(){let e=(0,l.useRouter)(),{user:t}=(0,d.A)(),[r,v]=s.useState(null),[N,b]=s.useState(!1),[w,j]=s.useState(""),[A,S]=s.useState(!1),[I,C]=s.useState(null),[k,q]=s.useState(!1),T=(0,h.x)("cache:auth:employees")||[],[P,R]=s.useState(T),[D,E]=s.useState(!T.length),[O,L]=s.useState(null),[M,U]=s.useState(null),[F,W]=s.useState(null),[_,B]=s.useState(!1),[z,V]=s.useState(!1),$=s.useRef(null),K=s.useRef(null),{register:X,handleSubmit:H,reset:J,setValue:Y,watch:G,formState:{errors:Z,isSubmitting:Q}}=(0,o.mN)({defaultValues:{applicantName:"",employeeId:"",department:"",dateOfTravel:f(),returnDate:"",timeFrom:"",timeTo:"",fromLocation:"",toLocation:"",officialDescription:"",goods:"",travelWithOfficer:!1,officerName:"",officerId:"",officerPhone:""}}),ee=G("travelWithOfficer"),[et,er]=s.useState(null),ea=X("applicantName",{required:"Required",maxLength:100}),es=X("officerName",{required:ee?"Required when travelling with officer":void 0,maxLength:100}),el=G("applicantName")||"",en=G("officerName")||"",eo=G("dateOfTravel"),ei=G("returnDate"),[eu,ec]=s.useState(null),ed=s.useRef(null);s.useEffect(()=>{let e=!1;return(async()=>{E(!0),L(null);try{let{data:t}=await p.A.get("/registrations");if(e)return;let r=Array.isArray(t)?t:[];R(r),(0,h.a)("cache:auth:employees",r)}catch(a){var t,r;if(e)return;L((null==a||null==(r=a.response)||null==(t=r.data)?void 0:t.message)||(null==a?void 0:a.message)||"Unable to load employees")}finally{e||E(!1)}})(),()=>{e=!0}},[]),s.useEffect(()=>()=>{$.current&&clearTimeout($.current),K.current&&clearTimeout(K.current)},[]);let em=s.useCallback(e=>{let t=(e||"").trim().toLowerCase(),r=P||[];return t?r.filter(e=>[e.fullName,e.nameWithInitials,e.epfNo,e.department,e.nicNo,e.mobileNo].some(e=>null==e?void 0:e.toLowerCase().includes(t))).slice(0,8):r.slice(0,8)},[P]),ep=s.useMemo(()=>_?em(el):[],[_,em,el]),eh=s.useMemo(()=>z?em(en):[],[z,em,en]),ex=s.useCallback(e=>{let t=(e.fullName||e.nameWithInitials||e.epfNo||"").trim()||"Unnamed employee";U(e),Y("applicantName",t,{shouldDirty:!0,shouldValidate:!0}),Y("employeeId",e.epfNo||"",{shouldDirty:!0,shouldValidate:!0}),Y("department",e.department||"",{shouldDirty:!0,shouldValidate:!0}),B(!1)},[Y]),ef=s.useCallback(e=>{let t=(e.fullName||e.nameWithInitials||e.epfNo||"").trim()||"Unnamed employee";W(e),Y("officerName",t,{shouldDirty:!0,shouldValidate:!0}),Y("officerId",e.epfNo||"",{shouldDirty:!0,shouldValidate:!0}),Y("officerPhone",y(e.mobileNo)||"",{shouldDirty:!0,shouldValidate:!0}),V(!1)},[Y]),eg=s.useCallback(()=>{b(!1),j(""),C(null),v(null)},[]),ey=s.useCallback(()=>{J(void 0),er(null),eg(),U(null),W(null),B(!1),V(!1)},[eg,J]);s.useEffect(()=>{let e=localStorage.getItem("employeeId")||localStorage.getItem("actor")||"";e&&Y("employeeId",e)},[Y]),s.useEffect(()=>{eo&&ei&&ei<eo&&Y("returnDate",eo,{shouldDirty:!0,shouldValidate:!0})},[eo,ei,Y]),s.useEffect(()=>{ee||(W(null),V(!1))},[ee]);let ev=s.useCallback(async t=>{if(er(null),t.timeFrom===t.timeTo){let e="timeFrom must differ from timeTo";throw er(e),Error(e)}let{travelWithOfficer:r,officerName:a,officerId:s,officerPhone:l,returnDate:n,...o}=t;if(n&&n<t.dateOfTravel){let e="Return date must be the same day or after the start date";throw er(e),Error(e)}let i=y(l),u=(o.officialDescription||"").trim();if(r){let e="Travelling Officer: ".concat(a||"-").concat(s?" (Employee ID: ".concat(s,")"):"").concat(i?", Phone: ".concat(i):"");u=u?"".concat(u,"\n").concat(e):e}let c={...o,officialDescription:u,travelWithOfficer:r,officerName:a,officerId:s,officerPhone:i||void 0,returnDate:n||void 0},d=await (0,x.bB)(c).catch(e=>{var t,r;throw er((null==e||null==(r=e.response)||null==(t=r.data)?void 0:t.message)||(null==e?void 0:e.message)||"Failed to save"),e});o.employeeId&&(localStorage.setItem("employeeId",o.employeeId),localStorage.setItem("actor",o.employeeId),localStorage.setItem("role","APPLICANT")),J({...t,timeFrom:"",timeTo:"",fromLocation:"",toLocation:"",officialDescription:"",goods:"",returnDate:"",travelWithOfficer:!1,officerName:"",officerId:"",officerPhone:""}),ec({code:(null==d?void 0:d.requestCode)||"—",when:new Date().toLocaleString()}),ed.current=setTimeout(()=>{e.push(g)},2e3)},[J,e]),eN=s.useCallback(e=>{v(e),b(!0),j(""),C(null)},[]),eb=s.useCallback(async()=>{if(r){if(!(null==t?void 0:t.username))return void C("Unable to read your account. Please re-login.");if(!w)return void C("Enter your account password to confirm.");C(null),q(!0);try{await (0,m.iD)({username:t.username,password:w}),await ev(r),eg()}catch(t){var e,a;C((null==t||null==(a=t.response)||null==(e=a.data)?void 0:e.message)||(null==t?void 0:t.message)||"Password verification failed.")}finally{q(!1)}}},[w,eg,r,ev,t]),ew=e=>(0,a.jsx)("label",{className:"block text-[12px] font-medium text-orange-800 mb-1",children:e}),ej=e=>"w-full border rounded px-3 py-2 text-[13px] ".concat(e?"border-red-500":"border-orange-200"),eA=()=>{ed.current&&(clearTimeout(ed.current),ed.current=null),ec(null)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("header",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-orange-700",children:"Create request"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-orange-900",children:"New vehicle request"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Provide the journey details so the transport team can schedule a driver."})]}),et&&(0,a.jsx)("div",{className:"text-xs md:text-sm rounded-lg bg-red-50 border border-red-200 text-red-800 px-3 py-2",children:et}),(0,a.jsxs)("form",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4 md:p-5 space-y-4",onSubmit:H(eN),children:[(0,a.jsx)("input",{type:"hidden",...X("employeeId",{required:!0})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[ew("Applicant Name *"),D?(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"Loading directory…"}):null]}),(0,a.jsx)("input",{...ea,autoComplete:"off",className:ej(!!Z.applicantName),onFocus:()=>{$.current&&(clearTimeout($.current),$.current=null),B(!0)},onChange:e=>{ea.onChange(e),$.current&&(clearTimeout($.current),$.current=null),B(!0),M&&(U(null),Y("employeeId","",{shouldDirty:!0,shouldValidate:!0}),Y("department","",{shouldDirty:!0,shouldValidate:!0}))},onBlur:e=>{ea.onBlur(e),$.current=setTimeout(()=>B(!1),150)}}),_?(0,a.jsx)("div",{className:"absolute z-20 w-full bg-white border border-orange-100 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto",children:D?(0,a.jsx)("div",{className:"px-3 py-2 text-[12px] text-gray-500",children:"Loading employees…"}):ep.length?ep.map((e,t)=>(0,a.jsxs)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-orange-50",onMouseDown:t=>{t.preventDefault(),ex(e)},children:[(0,a.jsx)("div",{className:"text-[13px] font-medium text-orange-900",children:e.fullName||e.nameWithInitials||e.epfNo||"Unnamed"}),(0,a.jsxs)("div",{className:"text-[11px] text-gray-600",children:[e.epfNo?"EPF ".concat(e.epfNo):"No EPF",e.department?" • ".concat(e.department):""]})]},e.epfNo||e.id||t)):(0,a.jsx)("div",{className:"px-3 py-2 text-[12px] text-gray-500",children:"No employees match your search."})}):null,M?(0,a.jsxs)("p",{className:"mt-1 text-[11px] text-gray-600",children:["Selected: ",M.fullName||M.nameWithInitials||"Employee"," (",M.epfNo||"No EPF",")"]}):null,M?null:(0,a.jsx)("p",{className:"mt-1 text-[11px] text-orange-700",children:"Pick an employee from the list so their EPF number and department are captured."}),O&&!D?(0,a.jsx)("p",{className:"mt-1 text-[11px] text-red-600",children:O}):null]}),(0,a.jsxs)("div",{children:[ew("Department *"),(0,a.jsx)("input",{className:ej(!!Z.department),...X("department",{required:"Required",maxLength:100})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{children:[ew("Date From *"),(0,a.jsx)("input",{type:"date",min:f(),className:ej(!!Z.dateOfTravel),...X("dateOfTravel",{required:"Required"})})]}),(0,a.jsxs)("div",{children:[ew("Return Date"),(0,a.jsx)("input",{type:"date",min:eo||f(),className:ej(!!Z.returnDate),...X("returnDate",{validate:e=>!e||(eo?!(e<eo)||"Return date must be same day or later":"Select the start date first")})}),(0,a.jsx)("p",{className:"mt-1 text-[11px] text-gray-500",children:"Leave blank if the trip ends the same day."}),Z.returnDate&&(0,a.jsx)("div",{className:"mt-1 text-[11px] text-red-600",children:String(Z.returnDate.message)})]}),(0,a.jsxs)("div",{children:[ew("Time From *"),(0,a.jsx)("input",{type:"time",className:ej(!!Z.timeFrom),...X("timeFrom",{required:"Required",pattern:{value:/^\d{2}:\d{2}$/,message:"HH:mm"}})})]}),(0,a.jsxs)("div",{children:[ew("Time To *"),(0,a.jsx)("input",{type:"time",className:ej(!!Z.timeTo),...X("timeTo",{required:"Required",pattern:{value:/^\d{2}:\d{2}$/,message:"HH:mm"}})}),(0,a.jsx)("p",{className:"mt-1 text-[11px] text-orange-700",children:"Example: 05:00 — 18:00"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{children:[ew("From Location *"),(0,a.jsx)("input",{className:ej(!!Z.fromLocation),...X("fromLocation",{required:"Required",maxLength:200})})]}),(0,a.jsxs)("div",{children:[ew("To Location *"),(0,a.jsx)("input",{className:ej(!!Z.toLocation),...X("toLocation",{required:"Required",maxLength:200})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[(0,a.jsxs)("div",{children:[ew("Official Trip Description"),(0,a.jsx)("textarea",{rows:3,className:"w-full border border-orange-200 rounded px-3 py-2 text-[13px]",...X("officialDescription",{maxLength:1e3})})]}),(0,a.jsxs)("div",{children:[ew("Goods being transported (if any)"),(0,a.jsx)("textarea",{rows:3,className:"w-full border border-orange-200 rounded px-3 py-2 text-[13px]",...X("goods",{maxLength:500})})]})]}),(0,a.jsxs)("div",{className:"border border-orange-200 rounded-lg p-3 md:p-4 bg-orange-50/40",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-orange-900 font-medium",children:[(0,a.jsx)("input",{type:"checkbox",...X("travelWithOfficer")}),"Travelling with Officer"]}),ee&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 mt-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[ew("Name of Travelling Officer *"),D&&(0,a.jsx)("span",{className:"text-[11px] text-gray-500",children:"Loading directory…"})]}),(0,a.jsx)("input",{...es,autoComplete:"off",className:ej(!!Z.officerName),onFocus:()=>{ee&&(K.current&&(clearTimeout(K.current),K.current=null),V(!0))},onChange:e=>{es.onChange(e),K.current&&(clearTimeout(K.current),K.current=null),ee&&V(!0),F&&(W(null),Y("officerId","",{shouldDirty:!0,shouldValidate:!0}),Y("officerPhone","",{shouldDirty:!0,shouldValidate:!0}))},onBlur:e=>{es.onBlur(e),K.current=setTimeout(()=>V(!1),150)}}),z&&ee?(0,a.jsx)("div",{className:"absolute z-20 w-full bg-white border border-orange-100 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto",children:D?(0,a.jsx)("div",{className:"px-3 py-2 text-[12px] text-gray-500",children:"Loading employees…"}):eh.length?eh.map((e,t)=>(0,a.jsxs)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-orange-50",onMouseDown:t=>{t.preventDefault(),ef(e)},children:[(0,a.jsx)("div",{className:"text-[13px] font-medium text-orange-900",children:e.fullName||e.nameWithInitials||e.epfNo||"Unnamed"}),(0,a.jsxs)("div",{className:"text-[11px] text-gray-600",children:[e.epfNo?"EPF ".concat(e.epfNo):"No EPF",e.mobileNo?" • ".concat(y(e.mobileNo)):""]})]},e.epfNo||e.id||t)):(0,a.jsx)("div",{className:"px-3 py-2 text-[12px] text-gray-500",children:"No employees match your search."})}):null,F?(0,a.jsxs)("p",{className:"mt-1 text-[11px] text-gray-600",children:["Selected: ",F.fullName||F.nameWithInitials||"Officer"," (",F.epfNo||"No EPF",")"]}):null]}),(0,a.jsxs)("div",{children:[ew("Travelling Officer Employee ID"),(0,a.jsx)("input",{className:ej(!1),placeholder:"e.g., E12345",...X("officerId",{maxLength:50})})]}),(0,a.jsxs)("div",{children:[ew("Travelling Officer Phone"),(0,a.jsx)("input",{inputMode:"tel",placeholder:"e.g., +974 5555 1234",className:ej(!!Z.officerPhone),...X("officerPhone",{maxLength:{value:25,message:"Too long"},pattern:{value:/^[0-9+()\-\s/.]{7,25}$/,message:"Use digits, + ( ) - / . and spaces only"}})}),Z.officerPhone&&(0,a.jsx)("div",{className:"mt-1 text-[11px] text-red-600",children:String(Z.officerPhone.message)})]})]})]}),(0,a.jsxs)("div",{className:"border border-dashed border-orange-300 rounded-xl p-4 bg-orange-50/60 flex items-start gap-3",children:[(0,a.jsx)(i.A,{size:18,className:"text-orange-500 mt-0.5"}),(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,a.jsx)("p",{className:"font-semibold text-orange-900",children:"Account verification"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["After you press ",(0,a.jsx)("strong",{children:"Submit request"}),", we will ask for your account password to confirm the submission and store your account as the requester, even if you filled the applicant details for someone else."]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:ey,className:"px-3 md:px-4 py-2 rounded border text-[13px]",children:"Clear"}),(0,a.jsx)("button",{type:"submit",disabled:Q,className:"px-3 md:px-4 py-2 rounded bg-orange-600 text-white disabled:opacity-60 text-[13px]",children:Q?"Saving…":"Submit Request"})]})]}),N&&r?(0,n.createPortal)((0,a.jsx)("div",{className:"fixed inset-0 z-40 grid place-items-center bg-black/40 p-3",role:"dialog","aria-modal":!0,onClick:eg,children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white shadow-xl border border-orange-200",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b bg-orange-50 flex items-center gap-2",children:[(0,a.jsx)(i.A,{size:16,className:"text-orange-500"}),(0,a.jsx)("h3",{className:"text-[14px] font-bold text-orange-900",children:"Confirm submission"})]}),(0,a.jsxs)("div",{className:"p-4 text-sm space-y-3",children:[(0,a.jsxs)("p",{className:"text-gray-700",children:["You’re about to submit this request as"," ",(0,a.jsx)("span",{className:"font-semibold text-orange-900",children:(null==t?void 0:t.fullName)||(null==t?void 0:t.username)||"your account"}),"."]}),(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-100 rounded-lg p-3 text-[12px] text-gray-600 space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold text-orange-900",children:"Applicant field:"})," ",r.applicantName," (",r.employeeId||"N/A",")"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold text-orange-900",children:"Account:"})," ",(null==t?void 0:t.username)||"—"," (",(null==t?void 0:t.department)||r.department||"Department",")"]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-[13px]",children:[(0,a.jsx)("label",{className:"font-medium text-orange-900",children:"Account password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:A?"text":"password",value:w,onChange:e=>j(e.target.value),className:"w-full border border-orange-200 rounded px-3 py-2 pr-10 text-[13px]",placeholder:"Enter your password"}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-2 text-orange-500 hover:text-orange-700",onClick:()=>S(e=>!e),children:A?(0,a.jsx)(u.A,{size:16}):(0,a.jsx)(c.A,{size:16})})]}),(0,a.jsx)("p",{className:"text-[11px] text-gray-500",children:"We re-verify your identity before saving the request."})]}),I?(0,a.jsx)("div",{className:"text-[11px] text-red-600",children:I}):null]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded border text-[12px]",onClick:eg,children:"Review details"}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded bg-orange-600 text-white text-[12px] disabled:opacity-60",onClick:eb,disabled:k,children:k?"Submitting…":"Confirm & submit"})]})]})}),document.body):null,eu?(0,n.createPortal)((0,a.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-3",role:"dialog","aria-modal":!0,onClick:eA,children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white shadow-xl border border-orange-200",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"px-4 py-3 border-b bg-orange-50",children:(0,a.jsx)("h3",{className:"text-[14px] font-bold text-orange-900",children:"Request Submitted"})}),(0,a.jsxs)("div",{className:"p-4 text-[13px] space-y-2",children:[(0,a.jsx)("div",{children:"Your request has been submitted successfully."}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Request Code:"})," ",(0,a.jsx)("span",{className:"font-semibold text-orange-900",children:eu.code})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Submitted at ",eu.when]}),(0,a.jsx)("div",{className:"pt-2 text-xs text-gray-500",children:"You’ll be taken to your Requests list shortly."})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded border text-[12px]",onClick:eA,title:"Stay on this page",children:"Stay here"}),(0,a.jsx)("button",{type:"button",className:"px-3 py-1.5 rounded bg-orange-600 text-white text-[12px] hover:bg-orange-700",onClick:()=>{ed.current&&(clearTimeout(ed.current),ed.current=null),e.push(g)},title:"Go to Requests now",children:"Go to My Requests"})]})]})}),document.body):null]})}},20063:(e,t,r)=>{"use strict";var a=r(47260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},37621:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(95125),s=r(95704);let l=(s.env.NEXT_PUBLIC_AUTH_BASE||"").replace(/\/$/,""),n=Math.min(Number(s.env.NEXT_PUBLIC_API_TIMEOUT)||1e4,15e3),o=a.A.create({baseURL:l?"".concat(l,"/api"):"/aapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:n});o.interceptors.request.use(e=>e,e=>Promise.reject(e)),o.interceptors.response.use(e=>{let t=e.data;if((e=>!!(e&&"object"==typeof e&&"ok"in e))(t)){if(t.ok){var r;return e.data=Object.prototype.hasOwnProperty.call(t,"data")&&null!=(r=t.data)?r:null,e}let a=Error(t.message||"Request failed");return a.response={status:e.status,data:t},Promise.reject(a)}return e},e=>{var t,r,a,s,l;let n=null==(t=e.response)?void 0:t.status,o=e.code,i=((null==e?void 0:e.message)||"").toLowerCase();return 401===n?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.resolve({status:null!=n?n:0,statusText:"Unauthorized",data:null,headers:null!=(a=null==(r=e.response)?void 0:r.headers)?a:{},config:e.config,request:e.request})):403===n?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(e)):"ECONNABORTED"===o||i.includes("timeout")?(console.warn("API timeout – returning empty response to keep UI responsive"),Promise.resolve({status:null!=n?n:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(s=e.response)?void 0:s.headers)?l:{},config:e.config,request:e.request})):Promise.reject(e)});let i=o},57828:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},68209:(e,t,r)=>{"use strict";r.d(t,{bC:()=>n,iD:()=>o,me:()=>u,mt:()=>i,ri:()=>c});var a=r(37621),s=r(99947);let l=["auth:user-cache","cache:auth:roles","cache:auth:perms","cache:auth:users"];function n(){try{l.forEach(e=>window.sessionStorage.removeItem(e))}catch(e){}}async function o(e){n(),await a.A.post("/auth/login",e)}async function i(){let e=[a.A.get("/registrations",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,s.a)("cache:auth:employees",t),(0,s.a)("cache:auth:employees:list",t),(0,s.a)("cache:auth:reports:employees",t)}).catch(()=>{}),a.A.get("/users",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,s.a)("cache:auth:users",t.map(e=>({id:e.id,username:e.username,fullName:e.fullName,roles:Array.isArray(e.roles)?e.roles:[],permissions:Array.isArray(e.permissions)?e.permissions:[]}))),(0,s.a)("cache:auth:users:list",t)}).catch(()=>{}),a.A.get("/roles",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,s.a)("cache:auth:roles",t),(0,s.a)("cache:auth:roles:list",t)}).catch(()=>{}),a.A.get("/roles/permissions",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,s.a)("cache:auth:perms",t)}).catch(()=>{})];await Promise.allSettled(e)}async function u(){try{let{data:e}=await a.A.get("/auth/me");return e}catch(s){var e;let t=null==s?void 0:s.code,r=((null==s?void 0:s.message)||"").toLowerCase(),a=null==s||null==(e=s.response)?void 0:e.status;if("ECONNABORTED"===t||r.includes("timeout")||r.includes("network error")||401===a||403===a)return null;throw s}}async function c(){try{await a.A.post("/auth/logout")}catch(r){var e;let t=null==r||null==(e=r.response)?void 0:e.status;if(401===t||403===t)return;throw r}finally{n()}}},70532:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(12115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:u="",children:c,iconNode:d,...m}=e;return(0,a.createElement)("svg",{ref:t,...n,width:s,height:s,stroke:r,strokeWidth:i?24*Number(o)/Number(s):o,className:l("lucide",u),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...d.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:i,...u}=r;return(0,a.createElement)(o,{ref:n,iconNode:t,className:l("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),i),...u})});return r.displayName=s(e),r}},76907:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},77863:(e,t,r)=>{Promise.resolve().then(r.bind(r,12667))},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,I:()=>u});var a=r(95125),s=r(95704);let l=(s.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),n=Math.min(Number(s.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),o=a.A.create({baseURL:l?"".concat(l,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:n}),i=o;function u(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}o.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let s=localStorage.getItem("role")||void 0;s&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=s)}return e}),o.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,s,l,n;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(l=null==(a=e.response)?void 0:a.status)?l:0,statusText:"Request Timeout",data:null,headers:null!=(n=null==(s=e.response)?void 0:s.headers)?n:{},config:e.config,request:e.request})}return Promise.reject(e)})},99947:(e,t,r)=>{"use strict";function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5;try{let r=window.sessionStorage.getItem(e);if(!r)return null;let a=JSON.parse(r);if(!(null==a?void 0:a.data)||!(null==a?void 0:a.ts))return null;if(Date.now()-a.ts>t)return window.sessionStorage.removeItem(e),null;return a.data}catch(e){return null}}function s(e,t){try{if(null===t)return void window.sessionStorage.removeItem(e);let r={data:t,ts:Date.now()};window.sessionStorage.setItem(e,JSON.stringify(r))}catch(e){}}r.d(t,{a:()=>s,x:()=>a})}},e=>{e.O(0,[5125,2544,8441,1255,7358],()=>e(e.s=77863)),_N_E=e.O()}]);