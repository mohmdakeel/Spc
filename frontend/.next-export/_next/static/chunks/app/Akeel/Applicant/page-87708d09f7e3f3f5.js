(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1690],{7640:(e,t,a)=>{"use strict";a.d(t,{Td:()=>l,Th:()=>r});var s=a(95155);function r(e){let{children:t,className:a="",sortable:r,sortDirection:l,onClick:n,...i}=e;return(0,s.jsx)("th",{...i,"aria-sort":"asc"===l?"ascending":"desc"===l?"descending":"none",onClick:r?n:void 0,onKeyDown:r?e=>{r&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==n||n())}:void 0,tabIndex:r?0:void 0,className:["px-2 py-2 md:px-3 md:py-2.5 text-left font-semibold text-orange-900 whitespace-normal align-middle leading-snug bg-orange-100 border-b-2 border-orange-200",r?"cursor-pointer hover:bg-orange-200 transition-colors":"",l?"bg-orange-200":"",a].join(" "),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[t,r&&(0,s.jsx)("span",{"aria-hidden":"true",className:"text-orange-600",children:"asc"===l?"↑":"desc"===l?"↓":"↕"})]})})}function l(e){let{children:t,className:a="",highlight:r,...l}=e;return(0,s.jsx)("td",{...l,className:["px-2 py-2 md:px-3 md:py-2.5 align-top border-b border-orange-100 transition-colors duration-150 whitespace-normal break-words leading-snug text-orange-800",r?"bg-orange-50 font-medium":"",a].join(" "),children:t})}a(12115)},11924:(e,t,a)=>{"use strict";a.d(t,{Cd:()=>h,Lh:()=>d,bB:()=>r,bk:()=>c,cK:()=>n,iq:()=>o,iv:()=>i,kM:()=>p,lm:()=>l,qd:()=>g,rg:()=>m,rr:()=>u,uK:()=>x});var s=a(81242);async function r(e){let{data:t}=await s.A.post("/usage-requests",e);return(0,s.I)(t)}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:r}=await s.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:a}});return(0,s.I)(r)}async function n(){try{let{data:e}=await s.A.get("/usage-requests/all");return(0,s.I)(e)}catch(a){let{data:e}=await s.A.get("/usage-requests"),t=(0,s.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function i(e){try{let{data:t}=await s.A.get("/usage-requests/status/".concat(e));return(0,s.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function o(e){let{data:t}=await s.A.get("/usage-requests/".concat(e));return(0,s.I)(t)}let d=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),c=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function x(e,t){let a={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:r}=await s.A.post("/usage-requests/".concat(e,"/assign"),a);return(0,s.I)(r)}async function p(e,t){let a={};"number"==typeof t.exitOdometer&&(a.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==a.exitOdometer&&(a.exitOdometer=t.odometerStartKm);let r=[];t.remarks&&r.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&r.push(...t.exitManifest),r.length&&(a.exitManifest=r);let{data:l}=await s.A.post("/usage-requests/".concat(e,"/gate/exit"),a);return(0,s.I)(l)}async function h(e,t){let a={};"number"==typeof t.entryOdometer&&(a.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==a.entryOdometer&&(a.entryOdometer=t.odometerEndKm);let r=[];t.remarks&&r.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&r.push(...t.entryManifest),r.length&&(a.entryManifest=r);let{data:l}=await s.A.post("/usage-requests/".concat(e,"/gate/entry"),a);return(0,s.I)(l)}async function g(){let{data:e}=await s.A.get("/usage-requests/metrics");return(0,s.I)(e)}},29502:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]])},37621:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var s=a(95125),r=a(95704);let l=(r.env.NEXT_PUBLIC_AUTH_BASE||"").replace(/\/$/,""),n=Math.min(Number(r.env.NEXT_PUBLIC_API_TIMEOUT)||1e4,15e3),i=s.A.create({baseURL:l?"".concat(l,"/api"):"/aapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:n});i.interceptors.request.use(e=>e,e=>Promise.reject(e)),i.interceptors.response.use(e=>{let t=e.data;if((e=>!!(e&&"object"==typeof e&&"ok"in e))(t)){if(t.ok){var a;return e.data=Object.prototype.hasOwnProperty.call(t,"data")&&null!=(a=t.data)?a:null,e}let s=Error(t.message||"Request failed");return s.response={status:e.status,data:t},Promise.reject(s)}return e},e=>{var t,a,s,r,l;let n=null==(t=e.response)?void 0:t.status,i=e.code,o=((null==e?void 0:e.message)||"").toLowerCase();return 401===n?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.resolve({status:null!=n?n:0,statusText:"Unauthorized",data:null,headers:null!=(s=null==(a=e.response)?void 0:a.headers)?s:{},config:e.config,request:e.request})):403===n?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(e)):"ECONNABORTED"===i||o.includes("timeout")?(console.warn("API timeout – returning empty response to keep UI responsive"),Promise.resolve({status:null!=n?n:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(r=e.response)?void 0:r.headers)?l:{},config:e.config,request:e.request})):Promise.reject(e)});let o=i},46826:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},50898:(e,t,a)=>{"use strict";a.d(t,{default:()=>T});var s=a(95155),r=a(12115),l=a(52619),n=a.n(l),i=a(11924),o=a(68209),d=a(7640),c=a(87066),u=a(29502),m=a(71847);let x=(0,m.A)("navigation-2",[["polygon",{points:"12 2 19 21 12 17 5 21 12 2",key:"x8c0qg"}]]);var p=a(86651),h=a(46826),g=a(89715),v=a(61362);let f=(0,m.A)("bell-ring",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]]);var y=a(65229);let j=e=>e?new Date(e).toLocaleString():"-",b=e=>{let t=(null==e?void 0:e.appliedDate)||(null==e?void 0:e.applied_on)||(null==e?void 0:e.appliedOn),a=(null==e?void 0:e.appliedTime)||(null==e?void 0:e.applied_time);if(t&&a)return"".concat(t," ").concat(a);if(t&&(null==e?void 0:e.createdAt)){let a=new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return"".concat(t," ").concat(a)}return(null==e?void 0:e.createdAt)?j(e.createdAt):"-"};function N(e){var t,a,s,r,l;if(!e)return{withOfficer:!1};if(e.travelWithOfficer||e.officerName||e.officerId||e.officerPhone)return{withOfficer:!!(e.travelWithOfficer||e.officerName||e.officerId||e.officerPhone),name:e.officerName||void 0,id:e.officerId||void 0,phone:e.officerPhone||void 0};let n="".concat(null!=(r=null==e?void 0:e.officialDescription)?r:"","\n").concat(null!=(l=null==e?void 0:e.remarks)?l:""),i=/Travelling Officer:\s*([^\(\n,]+)?(?:\s*\(Employee ID:\s*([^)]+)\))?(?:,\s*Phone:\s*([^\s,]+))?/i.exec(n);return i?{withOfficer:!0,name:null==(t=i[1])?void 0:t.trim(),id:null==(a=i[2])?void 0:a.trim(),phone:null==(s=i[3])?void 0:s.trim()}:{withOfficer:!1}}let w=(e,t)=>{var a,s,r,l,n;return String(null!=(n=null!=(a=null==e?void 0:e.id)?a:null==e?void 0:e.requestCode)?n:"".concat(null!=(s=null==e?void 0:e.employeeId)?s:"row","|").concat(null!=(r=null==e?void 0:e.dateOfTravel)?r:"","|").concat(null!=(l=null==e?void 0:e.createdAt)?l:"","|").concat(t))},A=e=>{if(!e)return;let t=new Date(e);if(!Number.isNaN(t.getTime()))return t},k=e=>{if(!e)return;let t=A(null==e?void 0:e.createdAt);if(t)return t;let a=(null==e?void 0:e.appliedDate)||(null==e?void 0:e.applied_on)||(null==e?void 0:e.appliedOn);if(!a)return;let s=(null==e?void 0:e.appliedTime)||(null==e?void 0:e.applied_time)||"00:00";return A("".concat(a,"T").concat(s))};function T(){var e,t,a,l,o,m,y,j,A;let[T,I]=r.useState([]),[C,E]=r.useState(""),[M,D]=r.useState(!0),[S,P]=r.useState(""),[q,R]=r.useState(null),L=r.useCallback(async()=>{let e=localStorage.getItem("employeeId")||localStorage.getItem("actor")||"";if(E(e),!e){I([]),D(!1);return}D(!0);let t=[],a=0,s=1;try{for(;a<s;){var r,l;let n=await (0,i.lm)(e,a,100);t=t.concat((null==n?void 0:n.content)||[]),s=null!=(r=null==n?void 0:n.totalPages)?r:1,a=(null!=(l=null==n?void 0:n.number)?l:a)+1}t.sort((e,t)=>{let a=(null==e?void 0:e.createdAt)?Date.parse(e.createdAt):0;return((null==t?void 0:t.createdAt)?Date.parse(t.createdAt):0)-a})}finally{I(t),D(!1)}},[]);r.useEffect(()=>{L()},[L]);let _=r.useMemo(()=>T.reduce((e,t)=>{let a=null==t?void 0:t.status;return a&&(e[a]=(e[a]||0)+1),e},{}),[T]),U=r.useCallback(e=>{var t;return null!=(t=_[e])?t:0},[_]),z=r.useMemo(()=>{let e=S.trim().toLowerCase();return e?T.filter(t=>[null==t?void 0:t.requestCode,null==t?void 0:t.employeeId,null==t?void 0:t.applicantName,null==t?void 0:t.fromLocation,null==t?void 0:t.toLocation,null==t?void 0:t.assignedVehicleNumber,null==t?void 0:t.status].filter(Boolean).map(e=>e.toString().toLowerCase()).join(" ").includes(e)):T},[T,S]).slice(0,15),H=T.length,B=null!=(a=_.SCHEDULED)?a:0,G=null!=(l=_.DISPATCHED)?l:0,F=B+G,V=null!=(o=_.APPROVED)?o:0,W=(null!=(m=_.PENDING_HOD)?m:0)+(null!=(y=_.PENDING_MANAGEMENT)?y:0),K=["RETURNED","COMPLETED"].reduce((e,t)=>{var a;return e+(null!=(a=_[t])?a:0)},0),X=H?Math.round(K/H*100):0,Y=H?Math.round(V/H*100):0,$=r.useMemo(()=>{let e=new Date;e.setDate(1);let t=[];for(let a=5;a>=0;a-=1){let s=new Date(e.getFullYear(),e.getMonth()-a,1);t.push({key:"".concat(s.getFullYear(),"-").concat(s.getMonth()),label:s.toLocaleString(void 0,{month:"short"})})}let a=T.reduce((e,t)=>{let a=k(t);if(!a)return e;let s="".concat(a.getFullYear(),"-").concat(a.getMonth());return e.set(s,(e.get(s)||0)+1),e},new Map);return t.map(e=>{var t;return{label:e.label,key:e.key,value:null!=(t=a.get(e.key))?t:0}})},[T]),Z=$.reduce((e,t)=>Math.max(e,t.value),0)||1,J=$.length>0&&null!=(j=null==(e=$[$.length-1])?void 0:e.value)?j:0,Q=J-($.length>1&&null!=(A=null==(t=$[$.length-2])?void 0:t.value)?A:0),ee=0===Q?"Even vs last month":"".concat(Q>0?"+":"").concat(Q," vs last month"),et=Q>0?"text-emerald-600":Q<0?"text-rose-600":"text-gray-600",ea=[{label:"Total Requests",value:H,helper:"".concat(Y||0,"% approved overall"),icon:c.A},{label:"This Month",value:J,helper:ee,icon:u.A},{label:"Active Trips",value:F,helper:"".concat(B," scheduled \xb7 ").concat(G," dispatched"),icon:x}],es=r.useMemo(()=>{let e=T.filter(e=>"APPROVED"===e.status);if(!e.length)return[];let t=Date.now()-12096e5,a=e.filter(e=>{let a=k(e);return!!a&&a.getTime()>=t});return(a.length?a:e).slice(0,4)},[T]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4",children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,s.jsxs)("div",{className:"w-full lg:max-w-xl",children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-orange-800 uppercase tracking-wide mb-1",children:"Search Requests"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-orange-50 border border-orange-200 rounded-xl px-3 py-2",children:[(0,s.jsx)(p.A,{size:16,className:"text-orange-500"}),(0,s.jsx)("input",{value:S,onChange:e=>P(e.target.value),placeholder:"Search by code, location, vehicle or status...",className:"flex-1 bg-transparent outline-none text-sm text-orange-900 placeholder:text-orange-400"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 justify-end",children:[(0,s.jsxs)(n(),{href:"/Akeel/Applicant/NewRequest",className:"inline-flex items-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-700 transition-all",children:[(0,s.jsx)(h.A,{size:16}),"New Request"]}),(0,s.jsxs)(n(),{href:"/Akeel/Applicant/MyRequests",className:"inline-flex items-center gap-2 border border-orange-300 text-orange-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-50 transition-all",children:[(0,s.jsx)(g.A,{size:16}),"My Requests"]})]})]})}),C?M?(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Loading…"}):null:(0,s.jsx)("div",{className:"text-[12px] text-yellow-800 bg-yellow-50 border border-yellow-200 rounded px-3 py-2",children:"Submit a request first — your Employee ID will be remembered and your dashboard will populate."}),C?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:ea.map(e=>{let{label:t,value:a,helper:r,icon:l}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4 flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs font-semibold text-orange-700 uppercase",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)(l,{size:16,className:"text-orange-500"})]}),(0,s.jsx)("div",{className:"text-3xl font-semibold text-orange-900",children:a}),(0,s.jsx)("div",{className:"text-[11px] text-gray-600",children:r})]},t)})}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4 md:col-span-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-orange-900",children:"Monthly activity"}),(0,s.jsx)("span",{className:"text-[11px] font-medium ".concat(et),children:ee})]}),(0,s.jsx)("div",{className:"mt-4 space-y-2",children:$.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-3 text-[11px]",children:[(0,s.jsx)("span",{className:"w-10 font-medium text-orange-700",children:e.label}),(0,s.jsx)("div",{className:"flex-1 h-2 rounded-full bg-orange-100 overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-orange-500 rounded-full transition-[width]",style:{width:"".concat(e.value/Z*100||0,"%")}})}),(0,s.jsx)("span",{className:"w-6 text-right font-semibold text-orange-900",children:e.value})]},e.key))})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-900",children:[(0,s.jsx)(v.A,{size:16,className:"text-emerald-500"}),"Completion stats"]}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsxs)("div",{className:"text-3xl font-semibold text-orange-900",children:[X,(0,s.jsx)("span",{className:"text-base font-medium text-gray-500",children:"%"})]}),(0,s.jsx)("p",{className:"text-[11px] text-gray-600",children:"Trips fully returned this cycle"}),(0,s.jsx)("div",{className:"mt-2 h-2 w-full bg-orange-100 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-emerald-500 rounded-full transition-[width]",style:{width:"".concat(X,"%")}})}),(0,s.jsxs)("dl",{className:"mt-3 grid grid-cols-3 gap-2 text-xs text-orange-900",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"text-[10px] text-gray-600 uppercase",children:"Completed"}),(0,s.jsx)("dd",{className:"font-semibold",children:K})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"text-[10px] text-gray-600 uppercase",children:"Pending"}),(0,s.jsx)("dd",{className:"font-semibold",children:W})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"text-[10px] text-gray-600 uppercase",children:"Active"}),(0,s.jsx)("dd",{className:"font-semibold",children:F})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-semibold text-orange-900",children:[(0,s.jsx)(f,{size:16,className:"text-orange-500"}),"Recent approvals"]}),(0,s.jsx)("span",{className:"text-[10px] uppercase text-gray-500",children:"Last 2 weeks"})]}),(0,s.jsx)("div",{className:"mt-3 space-y-2",children:es.length?es.map((e,t)=>(0,s.jsxs)("div",{className:"border border-orange-100 rounded-xl px-3 py-2 flex items-center justify-between gap-2 text-[11px]",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-orange-900",children:(null==e?void 0:e.requestCode)||"—"}),(0,s.jsx)("div",{className:"text-gray-600",children:(null==e?void 0:e.applicantName)||"Applicant"})]}),(0,s.jsxs)("div",{className:"text-right text-[10px] text-gray-500",children:[(0,s.jsx)("div",{children:b(e)}),(0,s.jsxs)("div",{className:"text-emerald-600 font-semibold flex items-center gap-1 justify-end",children:[(0,s.jsx)(v.A,{size:12}),"Approved"]})]})]},w(e,t))):(0,s.jsx)("p",{className:"text-[11px] text-gray-500",children:"No approvals in the last two weeks."})})]})]})]})]}):null,(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-2 md:gap-3",children:[["Pending HOD","PENDING_HOD"],["Pending Mgmt","PENDING_MANAGEMENT"],["Approved","APPROVED"],["Scheduled","SCHEDULED"],["Dispatched","DISPATCHED"],["Returned","RETURNED"]].map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg px-3 py-2",children:[(0,s.jsx)("div",{className:"text-[11px] text-orange-700 truncate",children:t}),(0,s.jsx)("div",{className:"text-2xl md:text-3xl font-bold text-orange-900",children:U(a)})]},a)})}),(0,s.jsx)("div",{className:"bg-white rounded-lg border border-orange-200 overflow-auto",children:(0,s.jsxs)("table",{className:"w-full table-fixed text-[10px] leading-[1.15]",children:[(0,s.jsxs)("colgroup",{children:[(0,s.jsx)("col",{className:"w-28"}),(0,s.jsx)("col",{className:"w-52"}),(0,s.jsx)("col",{className:"w-40"}),(0,s.jsx)("col",{className:"w-36"}),(0,s.jsx)("col",{className:"w-24"})]}),(0,s.jsx)("thead",{className:"bg-orange-50",children:(0,s.jsxs)("tr",{className:"text-[9.5px]",children:[(0,s.jsx)(d.Th,{className:"px-2 py-1 text-left",children:"Code"}),(0,s.jsx)(d.Th,{className:"px-2 py-1 text-left",children:"APPLICANT / OFFICER"}),(0,s.jsx)(d.Th,{className:"px-2 py-1 text-left",children:"Route"}),(0,s.jsx)(d.Th,{className:"px-2 py-1 text-left",children:"Travel"}),(0,s.jsx)(d.Th,{className:"px-2 py-1 text-center",children:"Status"})]})}),(0,s.jsxs)("tbody",{className:"divide-y",children:[M&&(0,s.jsx)("tr",{children:(0,s.jsx)(d.Td,{colSpan:5,className:"px-2 py-6 text-center text-gray-500",children:"Loading…"})}),!M&&z.map((e,t)=>{let a,r=N(e);return(0,s.jsxs)("tr",{className:"align-top hover:bg-orange-50/40 cursor-pointer",onClick:()=>R(e),children:[(0,s.jsxs)(d.Td,{className:"px-2 py-1",children:[(0,s.jsx)("div",{className:"font-semibold text-orange-900 truncate",title:(null==e?void 0:e.requestCode)||"",children:(null==e?void 0:e.requestCode)||"—"}),(0,s.jsx)("div",{className:"text-[9px] text-gray-600 truncate",title:b(e),children:b(e)})]}),(0,s.jsxs)(d.Td,{className:"px-2 py-1",children:[(0,s.jsxs)("div",{className:"truncate",title:"".concat((null==e?void 0:e.applicantName)||""," (").concat((null==e?void 0:e.employeeId)||"",")"),children:[(0,s.jsx)("span",{className:"font-medium text-orange-900",children:"Applicant:"})," ",(null==e?void 0:e.applicantName)||"—",(0,s.jsxs)("span",{className:"text-gray-600 text-[9px]",children:[" (",(null==e?void 0:e.employeeId)||"—",")"]})]}),(0,s.jsxs)("div",{className:"text-[9.5px] text-gray-700 truncate",title:r.withOfficer?"".concat(r.name||"-"," (").concat(r.id||"-",")").concat(r.phone?", ".concat(r.phone):""):"—",children:[(0,s.jsx)("span",{className:"font-medium",children:"Officer:"})," ",r.withOfficer?(0,s.jsxs)(s.Fragment,{children:[r.name||"-",(0,s.jsxs)("span",{className:"text-gray-600 text-[9px]",children:[" (",r.id||"-",")"]}),r.phone?(0,s.jsxs)("span",{className:"text-gray-600 text-[9px]",children:[", ",r.phone]}):null]}):"—"]})]}),(0,s.jsxs)(d.Td,{className:"px-2 py-1",children:[(0,s.jsxs)("div",{className:"truncate",title:"".concat((null==e?void 0:e.fromLocation)||""," → ").concat((null==e?void 0:e.toLocation)||""),children:[(null==e?void 0:e.fromLocation)||"—"," → ",(null==e?void 0:e.toLocation)||"—"]}),(0,s.jsx)("div",{className:"text-[9px] text-gray-600 truncate",title:(null==e?void 0:e.assignedVehicleNumber)||"—",children:(null==e?void 0:e.assignedVehicleNumber)||"—"})]}),(0,s.jsxs)(d.Td,{className:"px-2 py-1",children:[(0,s.jsx)("div",{className:"truncate",children:(null==e?void 0:e.dateOfTravel)||"—"}),(0,s.jsxs)("div",{className:"text-[9px] text-gray-600",children:[(0,s.jsx)("span",{className:"font-mono",children:(null==e?void 0:e.timeFrom)||"—"}),"–",(0,s.jsx)("span",{className:"font-mono",children:(null==e?void 0:e.timeTo)||"—"})," ",(null==e?void 0:e.overnight)?"(overnight)":""]})]}),(0,s.jsx)(d.Td,{className:"px-2 py-1 text-center",children:(a=(null==e?void 0:e.status)||"—",(0,s.jsx)("span",{className:"inline-block whitespace-nowrap text-[10px] px-1.5 py-[2px] rounded bg-orange-100 text-orange-800 leading-none",children:a}))})]},w(e,t))}),!M&&!z.length&&(0,s.jsx)("tr",{children:(0,s.jsx)(d.Td,{colSpan:5,className:"px-2 py-6 text-center text-gray-500",children:"No recent requests"})})]})]})}),q?(0,s.jsx)(O,{request:q,onClose:()=>R(null),onRefresh:L}):null]})}function O(e){var t,a;let{request:l,onClose:n,onRefresh:d}=e,c=N(l),u=[null==l?void 0:l.createdBy,null==l?void 0:l.created_by,null==l?void 0:l.actor].map(e=>null==e?"":String(e).trim()).find(e=>e&&!["system","null","undefined","-"].includes(e.toLowerCase()))||"—",m=((e,t)=>{var a;let s=null!=(a=null==e?void 0:e.updatedBy)?a:null==e?void 0:e.updated_by,r=null==s?"":String(s).trim();return r&&!["system","null","undefined","-"].includes(r.toLowerCase())?r:t||"—"})(l,u),[x,p]=r.useState(""),[h,g]=r.useState(""),[f,w]=r.useState(null),[A,k]=r.useState(!1),T=["PENDING_HOD","PENDING_MANAGEMENT"].includes((null==l?void 0:l.status)||""),O=async e=>{w(null);let t=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||"";if(!t)return void w("No username/actor found. Please log in again.");if(!h.trim())return void w("Enter your account password to continue.");k(!0);try{await (0,o.iD)({username:t,password:h}),"approve"===e?await (0,i.Lh)(l.id,x||"Approved via dashboard"):await (0,i.bk)(l.id,x||"Rejected via dashboard"),await d(),n()}catch(e){w((null==e?void 0:e.message)||"Action failed. Check your password and try again.")}finally{k(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 grid place-items-center z-50 p-3",onClick:n,"aria-modal":!0,role:"dialog",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b bg-orange-50",children:[(0,s.jsxs)("h3",{className:"font-bold text-orange-900 text-[13px]",children:["Request • ",l.requestCode]}),(0,s.jsx)("button",{className:"p-1 rounded hover:bg-orange-100",onClick:n,"aria-label":"Close",children:(0,s.jsx)(y.A,{size:16})})]}),(0,s.jsx)("div",{className:"p-4 text-[12px] leading-tight space-y-3",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("section",{children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-1",children:"Applicant & Department"}),(0,s.jsxs)("div",{className:"truncate",children:[(0,s.jsx)("span",{className:"font-medium text-orange-900",children:"Applicant:"})," ",l.applicantName||"—",(0,s.jsxs)("span",{className:"text-gray-600 text-[11px]",children:[" (",l.employeeId||"—",")"]})]}),(0,s.jsxs)("div",{className:"truncate",children:[(0,s.jsx)("span",{className:"font-medium",children:"Department:"})," ",l.department||"—"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Status:"})," ",l.status||"—"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Applied:"})," ",b(l)]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-1",children:"Travel Plan"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Date of Travel:"})," ",l.dateOfTravel||"—"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Time:"})," ",l.timeFrom||"—"," – ",l.timeTo||"—"," ",l.overnight?"(overnight)":""]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Route:"})," ",l.fromLocation||"—"," → ",l.toLocation||"—"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Assigned Vehicle:"})," ",l.assignedVehicleNumber||"—"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Driver:"})," ",l.assignedDriverName||"—",l.assignedDriverPhone?" (".concat(l.assignedDriverPhone,")"):""]})]}),(0,s.jsxs)("section",{className:"md:col-span-2 border border-orange-100 rounded-lg p-3",children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-2",children:"Official Description / Goods"}),(0,s.jsx)("div",{className:"text-orange-900 break-words break-all mb-1",children:l.officialDescription||"—"}),(0,s.jsxs)("div",{className:"text-[11px] text-gray-700",children:["Goods: ",l.goods||"—"]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-1",children:"Officer"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Travelling with Officer:"})," ",l.travelWithOfficer||c.withOfficer?"Yes":"No"]}),(0,s.jsxs)("div",{className:"break-words break-all",children:[(0,s.jsx)("b",{children:"Officer:"})," ",c.withOfficer?(0,s.jsxs)(s.Fragment,{children:[c.name||"—"," ",c.id?(0,s.jsxs)("span",{className:"text-[11px] text-gray-600",children:["(",c.id,")"]}):null,c.phone?", ".concat(c.phone):""]}):"—"]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-1",children:"Schedule & Gate"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Pickup:"})," ",j(l.scheduledPickupAt)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Return:"})," ",j(l.scheduledReturnAt)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Exit:"})," ",j(l.gateExitAt)," • ",(0,s.jsxs)("span",{className:"text-[11px] text-gray-600",children:["O ",null!=(t=l.exitOdometer)?t:"—"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Entry:"})," ",j(l.gateEntryAt)," • ",(0,s.jsxs)("span",{className:"text-[11px] text-gray-600",children:["O ",null!=(a=l.entryOdometer)?a:"—"]})]})]}),(0,s.jsxs)("section",{className:"md:col-span-2 border border-orange-100 rounded-lg p-3",children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-1",children:"Account Trail"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Submitted by account:"})," ",u]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Created at:"})," ",j(l.createdAt)]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Last updated by:"})," ",m]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("b",{children:"Updated at:"})," ",l.updatedAt?j(l.updatedAt):"—"]})]}),T&&(0,s.jsxs)("section",{className:"md:col-span-2 border border-orange-100 rounded-lg p-3 space-y-3",children:[(0,s.jsx)("div",{className:"text-orange-800 font-semibold mb-1",children:"Approval"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("label",{className:"text-sm text-gray-700",children:["Remarks (optional)",(0,s.jsx)("textarea",{className:"w-full mt-1 border border-orange-200 rounded px-2 py-1 text-[12px]",rows:2,value:x,onChange:e=>p(e.target.value)})]}),(0,s.jsxs)("label",{className:"text-sm text-gray-700",children:["Account password",(0,s.jsx)("input",{type:"password",className:"w-full mt-1 border border-orange-200 rounded px-2 py-1 text-[12px]",value:h,onChange:e=>g(e.target.value),placeholder:"Re-enter password"})]})]}),f?(0,s.jsx)("div",{className:"text-[11px] text-red-600",children:f}):null,(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 rounded bg-emerald-600 text-white px-3 py-2 text-[12px] font-semibold hover:bg-emerald-700 disabled:opacity-60",onClick:()=>O("approve"),disabled:A,title:"Approve & send forward",children:[(0,s.jsx)(v.A,{size:14}),A?"Working…":"Approve"]}),(0,s.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 rounded bg-rose-600 text-white px-3 py-2 text-[12px] font-semibold hover:bg-rose-700 disabled:opacity-60",onClick:()=>O("reject"),disabled:A,title:"Reject",children:[(0,s.jsx)(y.A,{size:14}),A?"Working…":"Reject"]})]})]})]})})]})})}},61362:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},65229:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},68209:(e,t,a)=>{"use strict";a.d(t,{bC:()=>n,iD:()=>i,me:()=>d,mt:()=>o,ri:()=>c});var s=a(37621),r=a(99947);let l=["auth:user-cache","cache:auth:roles","cache:auth:perms","cache:auth:users"];function n(){try{l.forEach(e=>window.sessionStorage.removeItem(e))}catch(e){}}async function i(e){n(),await s.A.post("/auth/login",e)}async function o(){let e=[s.A.get("/registrations",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,r.a)("cache:auth:employees",t),(0,r.a)("cache:auth:employees:list",t),(0,r.a)("cache:auth:reports:employees",t)}).catch(()=>{}),s.A.get("/users",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,r.a)("cache:auth:users",t.map(e=>({id:e.id,username:e.username,fullName:e.fullName,roles:Array.isArray(e.roles)?e.roles:[],permissions:Array.isArray(e.permissions)?e.permissions:[]}))),(0,r.a)("cache:auth:users:list",t)}).catch(()=>{}),s.A.get("/roles",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,r.a)("cache:auth:roles",t),(0,r.a)("cache:auth:roles:list",t)}).catch(()=>{}),s.A.get("/roles/permissions",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,r.a)("cache:auth:perms",t)}).catch(()=>{})];await Promise.allSettled(e)}async function d(){try{let{data:e}=await s.A.get("/auth/me");return e}catch(r){var e;let t=null==r?void 0:r.code,a=((null==r?void 0:r.message)||"").toLowerCase(),s=null==r||null==(e=r.response)?void 0:e.status;if("ECONNABORTED"===t||a.includes("timeout")||a.includes("network error")||401===s||403===s)return null;throw r}}async function c(){try{await s.A.post("/auth/logout")}catch(a){var e;let t=null==a||null==(e=a.response)?void 0:e.status;if(401===t||403===t)return;throw a}finally{n()}}},71847:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var s=a(12115);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,s.forwardRef)((e,t)=>{let{color:a="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:t,...n,width:r,height:r,stroke:a,strokeWidth:o?24*Number(i)/Number(r):i,className:l("lucide",d),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,a]=e;return(0,s.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let a=(0,s.forwardRef)((a,n)=>{let{className:o,...d}=a;return(0,s.createElement)(i,{ref:n,iconNode:t,className:l("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...d})});return a.displayName=r(e),a}},81242:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,I:()=>d});var s=a(95125),r=a(95704);let l=(r.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),n=Math.min(Number(r.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),i=s.A.create({baseURL:l?"".concat(l,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:n}),o=i;function d(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}i.interceptors.request.use(e=>{{var t,a;let s=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;s&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=s);let r=localStorage.getItem("role")||void 0;r&&(e.headers=null!=(a=e.headers)?a:{},e.headers["X-Role"]=r)}return e}),i.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,a=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||a.includes("timeout")){var s,r,l,n;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(l=null==(s=e.response)?void 0:s.status)?l:0,statusText:"Request Timeout",data:null,headers:null!=(n=null==(r=e.response)?void 0:r.headers)?n:{},config:e.config,request:e.request})}return Promise.reject(e)})},83011:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return r}});let s=a(12115);function r(e,t){let a=(0,s.useRef)(null),r=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let e=a.current;e&&(a.current=null,e());let t=r.current;t&&(r.current=null,t())}else e&&(a.current=l(e,s)),t&&(r.current=l(t,s))},[e,t])}function l(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let a=e(t);return"function"==typeof a?a:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},86651:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},87066:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]])},88089:(e,t,a)=>{Promise.resolve().then(a.bind(a,50898))},89715:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},99947:(e,t,a)=>{"use strict";function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5;try{let a=window.sessionStorage.getItem(e);if(!a)return null;let s=JSON.parse(a);if(!(null==s?void 0:s.data)||!(null==s?void 0:s.ts))return null;if(Date.now()-s.ts>t)return window.sessionStorage.removeItem(e),null;return s.data}catch(e){return null}}function r(e,t){try{if(null===t)return void window.sessionStorage.removeItem(e);let a={data:t,ts:Date.now()};window.sessionStorage.setItem(e,JSON.stringify(a))}catch(e){}}a.d(t,{a:()=>r,x:()=>s})}},e=>{e.O(0,[5125,2619,8441,1255,7358],()=>e(e.s=88089)),_N_E=e.O()}]);