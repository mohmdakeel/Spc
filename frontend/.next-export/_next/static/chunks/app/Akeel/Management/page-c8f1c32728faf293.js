(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[919],{11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>p,Lh:()=>c,bB:()=>s,bk:()=>u,cK:()=>o,iq:()=>i,iv:()=>l,kM:()=>h,lm:()=>n,qd:()=>x,rg:()=>m,rr:()=>d,uK:()=>g});var a=r(81242);async function s(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:s}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,a.I)(s)}async function o(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(r){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function l(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function i(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let c=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),u=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function g(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:s}=await a.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,a.I)(s)}async function h(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&s.push(...t.exitManifest),s.length&&(r.exitManifest=s);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,a.I)(n)}async function p(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&s.push(...t.entryManifest),s.length&&(r.entryManifest=s);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,a.I)(n)}async function x(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},12085:(e,t,r)=>{Promise.resolve().then(r.bind(r,97200))},20063:(e,t,r)=>{"use strict";var a=r(47260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(12115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:c="",children:u,iconNode:d,...m}=e;return(0,a.createElement)("svg",{ref:t,...o,width:s,height:s,stroke:r,strokeWidth:i?24*Number(l)/Number(s):l,className:n("lucide",c),...!u&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...d.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,o)=>{let{className:i,...c}=r;return(0,a.createElement)(l,{ref:o,iconNode:t,className:n("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),i),...c})});return r.displayName=s(e),r}},74794:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(95155),s=r(86651),n=r(65229);function o(e){let{value:t,onChange:r,placeholder:o="Search…",className:l=""}=e;return(0,a.jsx)("div",{className:"w-full ".concat(l).trim(),children:(0,a.jsxs)("div",{className:"relative flex items-center",children:[(0,a.jsx)(s.A,{size:16,className:"absolute left-3 text-orange-500 pointer-events-none","aria-hidden":"true"}),(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:o,className:"hod-search-input w-full rounded-xl border border-orange-200 bg-white py-2.5 pl-9 pr-8 text-sm text-orange-900 placeholder:text-orange-400/70 focus:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-300"}),t?(0,a.jsx)("button",{type:"button",onClick:()=>r(""),className:"absolute right-2 flex h-6 w-6 items-center justify-center rounded-full text-orange-500 hover:bg-orange-100","aria-label":"Clear search",children:(0,a.jsx)(n.A,{size:14})}):null]})})}},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,I:()=>c});var a=r(95125),s=r(95704);let n=(s.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),o=Math.min(Number(s.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),l=a.A.create({baseURL:n?"".concat(n,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:o}),i=l;function c(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}l.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let s=localStorage.getItem("role")||void 0;s&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=s)}return e}),l.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,s,n,o;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(n=null==(a=e.response)?void 0:a.status)?n:0,statusText:"Request Timeout",data:null,headers:null!=(o=null==(s=e.response)?void 0:s.headers)?o:{},config:e.config,request:e.request})}return Promise.reject(e)})},86651:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},97200:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(95155),s=r(12115),n=r(11924),o=r(74794),l=r(20063);function i(){let[e,t]=(0,s.useState)([]),[r,i]=(0,s.useState)([]),[c,u]=(0,s.useState)([]),[d,m]=(0,s.useState)(!0),[g,h]=(0,s.useState)(""),p=(0,l.useSearchParams)();(0,s.useEffect)(()=>{let e=p.get("q")||p.get("search");e&&h(e)},[p]),(0,s.useEffect)(()=>{(async()=>{m(!0);try{let[e,r,a]=await Promise.all([(0,n.iv)("PENDING_MANAGEMENT"),(0,n.iv)("APPROVED"),(0,n.iv)("REJECTED")]);t(e||[]),i(r||[]),u(a||[])}finally{m(!1)}})()},[]);let x=(0,s.useMemo)(()=>[{label:"Pending (Management)",n:e.length,hint:"Awaiting your decision"},{label:"Approved",n:r.length,hint:"Approved by Management"},{label:"Rejected",n:c.length,hint:"Rejected at Management"}],[e,r,c]),f=(0,s.useCallback)(e=>{let t=g.trim().toLowerCase();return t?e.filter(e=>[e.requestCode,e.applicantName,e.employeeId,e.fromLocation,e.toLocation,e.assignedVehicleNumber,e.status].filter(Boolean).map(e=>e.toString().toLowerCase()).some(e=>e.includes(t))):e},[g]),y=(0,s.useMemo)(()=>f(e),[e,f]),v=(0,s.useMemo)(()=>f(r),[r,f]),A=(0,s.useMemo)(()=>f(c),[c,f]),b=(e,t)=>(0,a.jsxs)("section",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-base font-semibold text-orange-900",children:e}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[t.length," request(s)"]})]}),(0,a.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-50 text-orange-700 border border-orange-100",children:["showing ",Math.min(5,t.length)," of ",t.length]})]}),(0,a.jsxs)("div",{className:"divide-y",children:[t.slice(0,5).map(e=>{var t;let r;return(0,a.jsxs)("article",{className:"py-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-semibold text-orange-900",children:e.requestCode}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:(r=e.createdAt)?new Date(r).toLocaleString():"—"})]}),(0,a.jsxs)("p",{className:"text-gray-700",children:[e.applicantName," — ",e.department]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.fromLocation," → ",e.toLocation]})]},null!=(t=e.id)?t:e.requestCode)}),!t.length&&(0,a.jsx)("p",{className:"py-4 text-center text-xs text-gray-400",children:"No records"})]})]});return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-white rounded-2xl border border-orange-200 shadow-sm p-4",children:(0,a.jsx)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:(0,a.jsxs)("div",{className:"w-full lg:max-w-xl",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-orange-800 uppercase tracking-wide mb-1",children:"Search queue"}),(0,a.jsx)(o.A,{value:g,onChange:h,placeholder:"Search by code, applicant, department or route..."})]})})}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:x.map(e=>(0,a.jsxs)("div",{className:"rounded-lg border border-orange-200 bg-white p-5",children:[(0,a.jsx)("div",{className:"text-sm text-orange-700",children:e.label}),(0,a.jsx)("div",{className:"text-3xl font-bold text-orange-900",children:d?"—":e.n}),(0,a.jsx)("div",{className:"text-xs text-orange-600 mt-1",children:e.hint})]},e.label))}),(0,a.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[b("Pending",y),b("Recently Approved",v),b("Recently Rejected",A)]})]})}}},e=>{e.O(0,[5125,8441,1255,7358],()=>e(e.s=12085)),_N_E=e.O()}]);