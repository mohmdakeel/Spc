(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1563],{3768:(e,t,a)=>{Promise.resolve().then(a.bind(a,19776))},7640:(e,t,a)=>{"use strict";a.d(t,{Td:()=>l,Th:()=>s});var r=a(95155);function s(e){let{children:t,className:a="",sortable:s,sortDirection:l,onClick:n,...o}=e;return(0,r.jsx)("th",{...o,"aria-sort":"asc"===l?"ascending":"desc"===l?"descending":"none",onClick:s?n:void 0,onKeyDown:s?e=>{s&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==n||n())}:void 0,tabIndex:s?0:void 0,className:["px-2 py-2 md:px-3 md:py-2.5 text-left font-semibold text-orange-900 whitespace-normal align-middle leading-snug bg-orange-100 border-b-2 border-orange-200",s?"cursor-pointer hover:bg-orange-200 transition-colors":"",l?"bg-orange-200":"",a].join(" "),children:(0,r.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[t,s&&(0,r.jsx)("span",{"aria-hidden":"true",className:"text-orange-600",children:"asc"===l?"↑":"desc"===l?"↓":"↕"})]})})}function l(e){let{children:t,className:a="",highlight:s,...l}=e;return(0,r.jsx)("td",{...l,className:["px-2 py-2 md:px-3 md:py-2.5 align-top border-b border-orange-100 transition-colors duration-150 whitespace-normal break-words leading-snug text-orange-800",s?"bg-orange-50 font-medium":"",a].join(" "),children:t})}a(12115)},19776:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(95155),s=a(12115),l=a(55084),n=a(7640),o=a(46826),i=a(84926),c=a(12008),d=a(87637);let p=e=>e?new Date(e).toLocaleString():"—";function m(){let[e,t]=(0,s.useState)([]),[a,m]=(0,s.useState)(""),[u,h]=(0,s.useState)(!0),[g,v]=(0,s.useState)({vehicleNumber:"",driverName:"",department:"",purpose:""}),[N,b]=(0,s.useState)(!1),j=async()=>{h(!0);try{let e=await (0,d.xY)();t(e)}catch(e){c.oR.error((null==e?void 0:e.message)||"Failed to load company vehicles")}finally{h(!1)}};(0,s.useEffect)(()=>{j()},[]);let y=async()=>{let e=g.vehicleNumber.trim();if(e)try{await (0,d.sZ)({vehicleNumber:e,driverName:g.driverName.trim()||void 0,department:g.department.trim()||void 0,purpose:g.purpose.trim()||void 0}),v({vehicleNumber:"",driverName:"",department:"",purpose:""}),b(!1),c.oR.success("Company vehicle saved"),j()}catch(e){c.oR.error((null==e?void 0:e.message)||"Failed to add company vehicle")}},f=async e=>{try{await (0,d.o1)(e),c.oR.success("Exit recorded"),j()}catch(e){c.oR.error((null==e?void 0:e.message)||"Failed to mark exit")}},w=(0,s.useMemo)(()=>{let t=e.slice();return t.sort((e,t)=>{let a=!e.timeOut;return!t.timeOut!==a?a?-1:1:new Date(t.timeIn).getTime()-new Date(e.timeIn).getTime()}),t},[e]),C=(0,s.useMemo)(()=>{let e=a.trim().toLowerCase();return e?w.filter(t=>[t.vehicleNumber,t.driverName,t.department,t.purpose].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(e)):w},[w,a]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,r.jsx)("h1",{className:"text-[14px] md:text-lg font-bold text-orange-900",children:"Company Vehicles (Ad-hoc)"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(l.A,{value:a,onChange:m,placeholder:"Search vehicle, driver, department, purpose…"}),(0,r.jsxs)("button",{className:"inline-flex items-center gap-1 h-8 px-3 rounded bg-orange-600 text-white text-[12px] hover:bg-orange-700",onClick:()=>b(!0),children:[(0,r.jsx)(o.A,{size:14})," Add Vehicle"]})]})]}),(0,r.jsx)("p",{className:"text-[11px] text-orange-700",children:"Use for internal vehicles not tied to a usage request."}),(0,r.jsx)("div",{className:"bg-white rounded-xl border border-orange-200 overflow-auto",children:(0,r.jsxs)("table",{className:"min-w-[860px] w-full table-fixed text-[10px] leading-[1.15]",children:[(0,r.jsxs)("colgroup",{children:[(0,r.jsx)("col",{className:"w-28"}),(0,r.jsx)("col",{className:"w-32"}),(0,r.jsx)("col",{className:"w-32"}),(0,r.jsx)("col",{className:"w-[16rem]"}),(0,r.jsx)("col",{className:"w-32"}),(0,r.jsx)("col",{className:"w-32"}),(0,r.jsx)("col",{className:"w-28"})]}),(0,r.jsx)("thead",{className:"bg-orange-50",children:(0,r.jsxs)("tr",{className:"text-[9.5px]",children:[(0,r.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Vehicle"}),(0,r.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Driver"}),(0,r.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Department"}),(0,r.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Purpose"}),(0,r.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Time In"}),(0,r.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Time Out"}),(0,r.jsx)(n.Th,{className:"px-2 py-1 text-center",children:"Action"})]})}),(0,r.jsxs)("tbody",{className:"divide-y",children:[u&&(0,r.jsx)("tr",{children:(0,r.jsx)(n.Td,{colSpan:7,className:"px-2 py-6 text-center text-gray-500",children:"Loading…"})}),!u&&C.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-orange-50/40",children:[(0,r.jsx)(n.Td,{className:"px-2 py-1 font-semibold text-orange-900",children:e.vehicleNumber}),(0,r.jsx)(n.Td,{className:"px-2 py-1",children:e.driverName||"-"}),(0,r.jsx)(n.Td,{className:"px-2 py-1",children:e.department||"-"}),(0,r.jsx)(n.Td,{className:"px-2 py-1 truncate",title:e.purpose||"-",children:e.purpose||"-"}),(0,r.jsx)(n.Td,{className:"px-2 py-1",children:p(e.timeIn)}),(0,r.jsx)(n.Td,{className:"px-2 py-1",children:p(e.timeOut)}),(0,r.jsx)(n.Td,{className:"px-2 py-1 text-center",children:!e.timeOut&&(0,r.jsxs)("button",{className:"px-2.5 py-[6px] rounded bg-green-600 text-white hover:bg-green-700 inline-flex items-center gap-1 text-[10px]",onClick:()=>f(e.id),title:"Mark vehicle exit",children:[(0,r.jsx)(i.A,{size:14})," Mark Exit"]})})]},e.id)),!u&&!C.length&&(0,r.jsx)("tr",{children:(0,r.jsx)(n.Td,{colSpan:7,className:"px-2 py-6 text-center text-gray-500",children:"No records"})})]})]})}),(0,r.jsx)(x,{open:N,onClose:()=>b(!1),form:g,setForm:v,onSubmit:y,loading:u})]})}function x(e){let{open:t,onClose:a,form:s,setForm:l,onSubmit:n,loading:o}=e;if(!t)return null;let i=!s.vehicleNumber.trim()||o;return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/40 grid place-items-center z-50 p-4",onClick:a,children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-orange-50",children:[(0,r.jsx)("h3",{className:"font-bold text-orange-900",children:"Add Company Vehicle"}),(0,r.jsx)("button",{className:"p-2 rounded hover:bg-orange-100",onClick:a,"aria-label":"Close",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-1 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-[12px] font-semibold text-orange-800",children:"Vehicle Number *"}),(0,r.jsx)("input",{className:"border border-orange-200 rounded px-3 py-2 text-[13px] uppercase",placeholder:"Vehicle Number",value:s.vehicleNumber,onChange:e=>l(t=>({...t,vehicleNumber:e.target.value})),autoFocus:!0})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-[12px] font-semibold text-orange-800",children:"Driver"}),(0,r.jsx)("input",{className:"border border-orange-200 rounded px-3 py-2 text-[13px]",placeholder:"Driver name",value:s.driverName,onChange:e=>l(t=>({...t,driverName:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-[12px] font-semibold text-orange-800",children:"Department"}),(0,r.jsx)("input",{className:"border border-orange-200 rounded px-3 py-2 text-[13px]",placeholder:"Department",value:s.department,onChange:e=>l(t=>({...t,department:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-[12px] font-semibold text-orange-800",children:"Purpose"}),(0,r.jsx)("input",{className:"border border-orange-200 rounded px-3 py-2 text-[13px]",placeholder:"Purpose",value:s.purpose,onChange:e=>l(t=>({...t,purpose:e.target.value}))})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 px-5 py-3 border-t bg-orange-50",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded border",onClick:a,children:"Cancel"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-orange-600 text-white disabled:opacity-60",disabled:i,onClick:n,children:"Save"})]})]})})}},46826:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},55084:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(95155);a(12115);var s=a(78827);function l(e){let{value:t,onChange:a,placeholder:l,className:n}=e;return(0,r.jsx)("div",{className:"w-full sm:w-72 ".concat(n||""),children:(0,r.jsx)(s.A,{value:t,onChange:a,placeholder:l,className:"w-full h-9"})})}},65229:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},78827:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(95155);a(12115);var s=a(86651),l=a(65229);function n(e){let{value:t,onChange:a,placeholder:n="Search…",className:o=""}=e;return(0,r.jsxs)("div",{className:"relative ".concat(o),children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(s.A,{size:18,className:"text-orange-500"})}),(0,r.jsx)("input",{value:t,onChange:e=>a(e.target.value),placeholder:n,autoComplete:"off",className:"w-full border border-orange-200 rounded-xl px-10 py-3 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 text-sm bg-white placeholder-orange-400/70 text-orange-900 font-medium transition-all duration-200 shadow-sm hover:shadow-md"}),t&&(0,r.jsx)("button",{onClick:()=>a(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:bg-orange-100 rounded-r-xl transition-colors","aria-label":"Clear search",children:(0,r.jsx)(l.A,{size:18,className:"text-orange-500 hover:text-orange-700"})})]})}},81242:(e,t,a)=>{"use strict";a.d(t,{A:()=>i,I:()=>c});var r=a(95125),s=a(95704);let l=(s.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),n=Math.min(Number(s.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),o=r.A.create({baseURL:l?"".concat(l,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:n}),i=o;function c(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}o.interceptors.request.use(e=>{{var t,a;let r=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;r&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=r);let s=localStorage.getItem("role")||void 0;s&&(e.headers=null!=(a=e.headers)?a:{},e.headers["X-Role"]=s)}return e}),o.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,a=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||a.includes("timeout")){var r,s,l,n;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(l=null==(r=e.response)?void 0:r.status)?l:0,statusText:"Request Timeout",data:null,headers:null!=(n=null==(s=e.response)?void 0:s.headers)?n:{},config:e.config,request:e.request})}return Promise.reject(e)})},84926:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},86651:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},87637:(e,t,a)=>{"use strict";a.d(t,{Vt:()=>l,_q:()=>s,lD:()=>n,o1:()=>c,sZ:()=>i,xY:()=>o});var r=a(81242);async function s(e){let{data:t}=await r.A.get("/gate/visitors",{params:{q:e}});return(0,r.I)(t)}async function l(e){let t={...e,plate:e.plate.trim().toUpperCase()},{data:a}=await r.A.post("/gate/visitors",t);return(0,r.I)(a)}async function n(e){let{data:t}=await r.A.post("/gate/visitors/".concat(e,"/exit"));return(0,r.I)(t)}async function o(e){let{data:t}=await r.A.get("/gate/company-vehicles",{params:{q:e}});return(0,r.I)(t)}async function i(e){let t={...e,vehicleNumber:e.vehicleNumber.trim().toUpperCase()},{data:a}=await r.A.post("/gate/company-vehicles",t);return(0,r.I)(a)}async function c(e){let{data:t}=await r.A.post("/gate/company-vehicles/".concat(e,"/exit"));return(0,r.I)(t)}}},e=>{e.O(0,[5125,970,8441,1255,7358],()=>e(e.s=3768)),_N_E=e.O()}]);