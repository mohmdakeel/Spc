(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5652],{1150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let n=r(95155),a=r(12115),l=r(24437);function s(e){return{default:e&&"default"in e?e.default:e}}r(36552);let u={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},o=function(e){let t={...u,...e},r=(0,a.lazy)(()=>t.loader().then(s)),o=t.loading;function i(e){let s=o?(0,n.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,u=!t.ssr||!!t.loading,i=u?a.Suspense:a.Fragment,c=t.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(r,{...e})]}):(0,n.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(r,{...e})});return(0,n.jsx)(i,{...u?{fallback:s}:{},children:c})}return i.displayName="LoadableComponent",i}},4259:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(12115),a=r(68209),l=r(20063);let s=["/login","/_error","/403"],u="auth:user-cache",o=()=>{try{let e=window.sessionStorage.getItem(u);if(!e)return null;let t=JSON.parse(e);if(!(null==t?void 0:t.user)||!(null==t?void 0:t.ts)||Date.now()-t.ts>3e5)return null;return t.user}catch(e){return null}},i=e=>{try{e?window.sessionStorage.setItem(u,JSON.stringify({user:e,ts:Date.now()})):window.sessionStorage.removeItem(u)}catch(e){}},c=()=>{let e=o(),[t,r]=(0,n.useState)(e),[u,c]=(0,n.useState)(!e),[d,f]=(0,n.useState)(null),h=(0,l.useRouter)(),m=(0,l.usePathname)(),p=(0,n.useRef)(!1),y=e=>{p.current&&(r(e),i(e))};(0,n.useEffect)(()=>{p.current=!0;let e=!1,t=s.some(e=>null==m?void 0:m.startsWith(e)),r=()=>{null!=m&&m.startsWith("/login")||h.replace("/login")};return t?(c(!1),f(null),()=>{p.current=!1,e=!0}):((async()=>{f(null);let t=o();t&&y(t);let n=!t;n&&c(!0);try{let t=await (0,a.me)();if(e||!p.current)return;if(!t){y(null),f(null),i(null),(0,a.bC)(),r();return}y(t),f(null),(0,a.bC)()}catch(t){var l,s;if(console.error("Auth check failed:",t),e||!p.current)return;f((null==t||null==(s=t.response)||null==(l=s.data)?void 0:l.message)||(null==t?void 0:t.message)||"Authentication failed"),y(null),i(null),(0,a.bC)(),r()}finally{!e&&p.current&&n&&c(!1)}})(),()=>{e=!0,p.current=!1})},[m,h]);let g=async()=>{if(!p.current)return null;c(!0),f(null);try{let e=await (0,a.me)();if(!p.current)return null;if(!e)return y(null),f("Session expired. Please sign in again."),(0,a.bC)(),(null==m?void 0:m.startsWith("/login"))||h.replace("/login"),null;return(0,a.bC)(),y(e),f(null),e}catch(r){var e,t;throw f((null==(t=r.response)||null==(e=t.data)?void 0:e.message)||"Failed to refresh user data"),r}finally{c(!1)}};return(0,n.useEffect)(()=>{(null==t?void 0:t.username)?window.localStorage.setItem("username",t.username):window.localStorage.removeItem("username")},[null==t?void 0:t.username]),{user:t,setUser:y,loading:u,error:d,refresh:g,hasRole:e=>{if(!(null==t?void 0:t.roles))return!1;let r=Array.isArray(e)?e:[e],n=t.roles.map(e=>e.toUpperCase());return r.some(e=>n.includes(e.toUpperCase()))},can:e=>{if(!(null==t?void 0:t.permissions))return!1;let r=Array.isArray(e)?e:[e];return t.permissions.some(e=>r.includes(e))},hasAnyRole:()=>!!((null==t?void 0:t.roles)&&t.roles.length>0)}}},8567:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return n.workAsyncStorageInstance}});let n=r(17828)},17828:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return n}});let n=(0,r(64054).createAsyncLocalStorage)()},20063:(e,t,r)=>{"use strict";var n=r(47260);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},24437:(e,t,r)=>{"use strict";function n(e){let{reason:t,children:r}=e;return r}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),r(24553)},33055:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(95155),a=r(67909),l=r(4259);let s=(0,a.default)(()=>Promise.all([r.e(970),r.e(2544),r.e(6737),r.e(1684),r.e(1008)]).then(r.bind(r,91008)),{loadableGenerated:{webpack:()=>[91008]},ssr:!1});function u(){var e,t;let{user:r}=(0,l.A)(),a=null==r||null==(e=r.roles)?void 0:e.includes("ADMIN"),u=null==r||null==(t=r.roles)?void 0:t.includes("VEHICLE_INCHARGE");return a||u?(0,n.jsx)(s,{}):(0,n.jsx)("div",{className:"p-6 bg-white border border-orange-200 rounded-xl text-sm text-red-700",children:"You do not have permission to manage vehicles. Please contact an administrator."})}},36552:(e,t,r)=>{"use strict";function n(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return n}}),r(95155),r(47650),r(8567),r(77278)},37621:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(95125),a=r(95704);let l=(a.env.NEXT_PUBLIC_AUTH_BASE||"").replace(/\/$/,""),s=Math.min(Number(a.env.NEXT_PUBLIC_API_TIMEOUT)||1e4,15e3),u=n.A.create({baseURL:l?"".concat(l,"/api"):"/aapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:s});u.interceptors.request.use(e=>e,e=>Promise.reject(e)),u.interceptors.response.use(e=>{let t=e.data;if((e=>!!(e&&"object"==typeof e&&"ok"in e))(t)){if(t.ok){var r;return e.data=Object.prototype.hasOwnProperty.call(t,"data")&&null!=(r=t.data)?r:null,e}let n=Error(t.message||"Request failed");return n.response={status:e.status,data:t},Promise.reject(n)}return e},e=>{var t,r,n,a,l;let s=null==(t=e.response)?void 0:t.status,u=e.code,o=((null==e?void 0:e.message)||"").toLowerCase();return 401===s?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.resolve({status:null!=s?s:0,statusText:"Unauthorized",data:null,headers:null!=(n=null==(r=e.response)?void 0:r.headers)?n:{},config:e.config,request:e.request})):403===s?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(e)):"ECONNABORTED"===u||o.includes("timeout")?(console.warn("API timeout â€“ returning empty response to keep UI responsive"),Promise.resolve({status:null!=s?s:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(a=e.response)?void 0:a.headers)?l:{},config:e.config,request:e.request})):Promise.reject(e)});let o=u},64054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return u}});let r=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw r}getStore(){}run(){throw r}exit(){throw r}enterWith(){throw r}static bind(e){return e}}let a="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return a?new a:new n}function s(e){return a?a.bind(e):n.bind(e)}function u(){return a?a.snapshot():function(e,...t){return e(...t)}}},67909:(e,t,r)=>{"use strict";r.d(t,{default:()=>a.a});var n=r(86278),a=r.n(n)},68209:(e,t,r)=>{"use strict";r.d(t,{bC:()=>s,iD:()=>u,me:()=>i,mt:()=>o,ri:()=>c});var n=r(37621),a=r(99947);let l=["auth:user-cache","cache:auth:roles","cache:auth:perms","cache:auth:users"];function s(){try{l.forEach(e=>window.sessionStorage.removeItem(e))}catch(e){}}async function u(e){s(),await n.A.post("/auth/login",e)}async function o(){let e=[n.A.get("/registrations",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,a.a)("cache:auth:employees",t),(0,a.a)("cache:auth:employees:list",t),(0,a.a)("cache:auth:reports:employees",t)}).catch(()=>{}),n.A.get("/users",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,a.a)("cache:auth:users",t.map(e=>({id:e.id,username:e.username,fullName:e.fullName,roles:Array.isArray(e.roles)?e.roles:[],permissions:Array.isArray(e.permissions)?e.permissions:[]}))),(0,a.a)("cache:auth:users:list",t)}).catch(()=>{}),n.A.get("/roles",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,a.a)("cache:auth:roles",t),(0,a.a)("cache:auth:roles:list",t)}).catch(()=>{}),n.A.get("/roles/permissions",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,a.a)("cache:auth:perms",t)}).catch(()=>{})];await Promise.allSettled(e)}async function i(){try{let{data:e}=await n.A.get("/auth/me");return e}catch(a){var e;let t=null==a?void 0:a.code,r=((null==a?void 0:a.message)||"").toLowerCase(),n=null==a||null==(e=a.response)?void 0:e.status;if("ECONNABORTED"===t||r.includes("timeout")||r.includes("network error")||401===n||403===n)return null;throw a}}async function c(){try{await n.A.post("/auth/logout")}catch(r){var e;let t=null==r||null==(e=r.response)?void 0:e.status;if(401===t||403===t)return;throw r}finally{s()}}},68667:(e,t,r)=>{Promise.resolve().then(r.bind(r,33055))},86278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let n=r(28140)._(r(1150));function a(e,t){var r;let a={};"function"==typeof e&&(a.loader=e);let l={...a,...t};return(0,n.default)({...l,modules:null==(r=l.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},99947:(e,t,r)=>{"use strict";function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5;try{let r=window.sessionStorage.getItem(e);if(!r)return null;let n=JSON.parse(r);if(!(null==n?void 0:n.data)||!(null==n?void 0:n.ts))return null;if(Date.now()-n.ts>t)return window.sessionStorage.removeItem(e),null;return n.data}catch(e){return null}}function a(e,t){try{if(null===t)return void window.sessionStorage.removeItem(e);let r={data:t,ts:Date.now()};window.sessionStorage.setItem(e,JSON.stringify(r))}catch(e){}}r.d(t,{a:()=>a,x:()=>n})}},e=>{e.O(0,[5125,8441,1255,7358],()=>e(e.s=68667)),_N_E=e.O()}]);