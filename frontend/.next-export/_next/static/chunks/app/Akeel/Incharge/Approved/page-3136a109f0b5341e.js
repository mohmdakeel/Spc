(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9307],{2989:(e,t,r)=>{"use strict";r.d(t,{Du:()=>g,Hv:()=>d,JY:()=>x,Q3:()=>p,Tz:()=>f,WR:()=>o,W_:()=>m,ih:()=>h,p0:()=>u,vs:()=>v});var a=r(81242);r(93402);let n="/vehicles",s=e=>""===e||null==e?void 0:Number(e)||void 0,i=(e,t)=>{var r,a;return(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||t};function l(e){let t=(0,a.I)(e);return Array.isArray(t)?t:t&&Array.isArray(t.content)?t.content:[]}function c(e,t){if(Array.isArray(t))t.forEach(t=>e.append("files",t));else for(let r=0;r<t.length;r++){let a=t.item(r);a&&e.append("files",a)}}async function o(e){try{let{data:t}=await a.A.get(n,{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return l(t)}catch(e){throw Error(i(e,"Failed to fetch vehicles"))}}async function d(e){try{let{data:t}=await a.A.get("/vehicles/deleted",{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return l(t)}catch(e){throw Error(i(e,"Failed to fetch deleted vehicles"))}}async function u(e){try{let{data:t}=await a.A.get("".concat(n,"/").concat(e));return(0,a.I)(t)}catch(e){throw Error(i(e,"Vehicle not found"))}}async function m(e){try{let t={...e};delete t.id,"registeredKm"in t&&(t.registeredKm=s(t.registeredKm)),"totalKmDriven"in t&&(t.totalKmDriven=s(t.totalKmDriven)),"fuelEfficiency"in t&&(t.fuelEfficiency=s(t.fuelEfficiency));let{data:r}=await a.A.post(n,t);return(0,a.I)(r)}catch(e){throw Error(i(e,"Failed to add vehicle"))}}async function p(e,t){try{let r={...t};"registeredKm"in r&&(r.registeredKm=s(r.registeredKm)),"totalKmDriven"in r&&(r.totalKmDriven=s(r.totalKmDriven)),"fuelEfficiency"in r&&(r.fuelEfficiency=s(r.fuelEfficiency));let{data:i}=await a.A.put("".concat(n,"/").concat(e),r);return(0,a.I)(i)}catch(e){throw Error(i(e,"Failed to update vehicle"))}}async function h(e){try{await a.A.delete("".concat(n,"/").concat(e))}catch(e){throw Error(i(e,"Failed to delete vehicle"))}}async function x(e,t){let r=new FormData,i={...e};delete i.id,"registeredKm"in i&&(i.registeredKm=s(i.registeredKm)),"totalKmDriven"in i&&(i.totalKmDriven=s(i.totalKmDriven)),"fuelEfficiency"in i&&(i.fuelEfficiency=s(i.fuelEfficiency)),r.append("vehicle",JSON.stringify(i)),c(r,t);let{data:l}=await a.A.post("".concat(n,"/with-images"),r,{headers:{"Content-Type":"multipart/form-data"}});return(0,a.I)(l)}async function f(e){let{data:t}=await a.A.get("".concat(n,"/").concat(e,"/images"));return(0,a.I)(t)}async function g(e,t){let r=new FormData;c(r,t);let{data:s}=await a.A.post("".concat(n,"/").concat(e,"/images"),r,{headers:{"Content-Type":"multipart/form-data"}});return(0,a.I)(s)}async function v(e,t){await a.A.delete("".concat(n,"/").concat(e,"/images/").concat(t))}},7640:(e,t,r)=>{"use strict";r.d(t,{Td:()=>s,Th:()=>n});var a=r(95155);function n(e){let{children:t,className:r="",sortable:n,sortDirection:s,onClick:i,...l}=e;return(0,a.jsx)("th",{...l,"aria-sort":"asc"===s?"ascending":"desc"===s?"descending":"none",onClick:n?i:void 0,onKeyDown:n?e=>{n&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==i||i())}:void 0,tabIndex:n?0:void 0,className:["px-2 py-2 md:px-3 md:py-2.5 text-left font-semibold text-orange-900 whitespace-normal align-middle leading-snug bg-orange-100 border-b-2 border-orange-200",n?"cursor-pointer hover:bg-orange-200 transition-colors":"",s?"bg-orange-200":"",r].join(" "),children:(0,a.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[t,n&&(0,a.jsx)("span",{"aria-hidden":"true",className:"text-orange-600",children:"asc"===s?"↑":"desc"===s?"↓":"↕"})]})})}function s(e){let{children:t,className:r="",highlight:n,...s}=e;return(0,a.jsx)("td",{...s,className:["px-2 py-2 md:px-3 md:py-2.5 align-top border-b border-orange-100 transition-colors duration-150 whitespace-normal break-words leading-snug text-orange-800",n?"bg-orange-50 font-medium":"",r].join(" "),children:t})}r(12115)},8503:(e,t,r)=>{"use strict";r.d(t,{H5:()=>o,IY:()=>d,UU:()=>l,cI:()=>u,gP:()=>m,z:()=>c});var a=r(81242);r(93402);let n="/drivers",s=(e,t)=>{var r,a;return(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||t};function i(e){let t=(0,a.I)(e);return Array.isArray(t)?t:t&&Array.isArray(t.content)?t.content:[]}async function l(e){try{let{data:t}=await a.A.get(n,{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return i(t)}catch(e){throw Error(s(e,"Failed to fetch drivers"))}}async function c(e){try{let{data:t}=await a.A.get("/drivers/deleted",{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return i(t)}catch(e){throw Error(s(e,"Failed to fetch deleted drivers"))}}async function o(e){try{let{data:t}=await a.A.get("".concat(n,"/").concat(e));return(0,a.I)(t)}catch(e){throw Error(s(e,"Driver not found"))}}async function d(e){try{let{data:t}=await a.A.post(n,e);return(0,a.I)(t)}catch(e){throw Error(s(e,"Failed to add driver"))}}async function u(e,t){try{let{data:r}=await a.A.put("".concat(n,"/").concat(e),t);return(0,a.I)(r)}catch(e){throw Error(s(e,"Failed to update driver"))}}async function m(e){try{await a.A.delete("".concat(n,"/").concat(e))}catch(e){throw Error(s(e,"Failed to delete driver"))}}},11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>x,Lh:()=>o,bB:()=>n,bk:()=>d,cK:()=>i,iq:()=>c,iv:()=>l,kM:()=>h,lm:()=>s,qd:()=>f,rg:()=>m,rr:()=>u,uK:()=>p});var a=r(81242);async function n(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:n}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,a.I)(n)}async function i(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(r){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function l(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function c(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let o=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function p(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:n}=await a.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,a.I)(n)}async function h(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let n=[];t.remarks&&n.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&n.push(...t.exitManifest),n.length&&(r.exitManifest=n);let{data:s}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,a.I)(s)}async function x(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let n=[];t.remarks&&n.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&n.push(...t.entryManifest),n.length&&(r.entryManifest=n);let{data:s}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,a.I)(s)}async function f(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},24033:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},24947:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},25695:(e,t,r)=>{"use strict";r.d(t,{C:()=>s,M:()=>n});var a=r(81242);async function n(e){let{data:t}=await a.A.get("/availability/drivers",{params:e});return(0,a.I)(t)}async function s(e){let{data:t}=await a.A.get("/availability/vehicles",{params:e});return(0,a.I)(t)}},35119:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(95155),n=r(12115),s=r(86651),i=r(65229);function l(e){let{value:t,onChange:r,placeholder:l="Search…",className:c="",name:o,disabled:d=!1}=e,u=(0,n.useId)(),m=o||"incharge-search-".concat(u),p="incharge-search-".concat(u);return(0,a.jsxs)("div",{className:"relative w-full ".concat(c),children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-2 flex items-center pointer-events-none text-orange-500",children:(0,a.jsx)(s.A,{size:16})}),(0,a.jsx)("input",{type:"search",value:t,onChange:e=>r(e.target.value),placeholder:l,"aria-label":"Search",name:m,id:p,autoComplete:"new-password","data-lpignore":"true","data-1p-ignore":"true","data-form-type":"other",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,disabled:d,className:"w-full h-9 rounded-lg border border-orange-200 bg-white/90 pl-8 pr-8 text-sm text-orange-900 placeholder-orange-400/70 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-shadow ".concat(d?"opacity-70 cursor-not-allowed":"")}),t&&!d&&(0,a.jsx)("button",{type:"button",onClick:()=>r(""),className:"absolute inset-y-0 right-2 flex items-center text-orange-500 hover:text-orange-700","aria-label":"Clear search",children:(0,a.jsx)(i.A,{size:16})})]})}},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},76849:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>T});var a=r(95155),n=r(12115),s=r(11924),i=r(7640),l=r(35119),c=r(65229),o=r(24947),d=r(24033),u=r(86651),m=r(99265),p=r(2989),h=r(8503),x=r(25695);let f=e=>{if(!e)return"";if(e instanceof Date)return e.toISOString().slice(0,16);let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toISOString().slice(0,16)},g=e=>(null!=e?e:"").replace(/[^\d+()\-\s./;]/g,"").replace(/^[;,\s-]+/,"").replace(/\s{2,}/g," ").trim();function v(e){var t;let{open:r,onClose:i,requestId:l,request:v,defaultValues:y,onAssigned:j}=e,[b,N]=(0,n.useState)([]),[w,A]=(0,n.useState)([]),[T,I]=(0,n.useState)(""),[k,C]=(0,n.useState)(""),[S,D]=(0,n.useState)((null==y?void 0:y.vehicleNumber)||""),[O,E]=(0,n.useState)((null==y?void 0:y.driverName)||""),[P,q]=(0,n.useState)((null==y?void 0:y.driverPhone)||""),[R,K]=(0,n.useState)(""),[z,F]=(0,n.useState)(""),[L,M]=(0,n.useState)(""),[_,V]=(0,n.useState)(null),[B,U]=(0,n.useState)(!1),[W,J]=(0,n.useState)(null),[X,G]=(0,n.useState)(null),[H,Y]=(0,n.useState)(!1),Q=(0,n.useMemo)(()=>(function(e){var t,r,a,n;if(!e)return{withOfficer:!1};if(e.travelWithOfficer||e.officerName||e.officerId||e.officerPhone)return{withOfficer:!0,name:e.officerName||void 0,id:e.officerId||void 0,phone:g(e.officerPhone)||void 0};let s="".concat(null!=(a=null==e?void 0:e.officialDescription)?a:"","\n").concat(null!=(n=null==e?void 0:e.remarks)?n:""),i=/Travelling Officer:\s*([^\(\n,]+)?(?:\s*\((?:Employee\s*ID|Emp\.?\s*ID|ID)\s*:\s*([^)]+)\))?(?:,\s*(?:Phone|Tel)\s*:\s*([^\n]+))?/i.exec(s);return i?{withOfficer:!0,name:null==(t=i[1])?void 0:t.trim(),id:null==(r=i[2])?void 0:r.trim(),phone:g(i[3])}:{withOfficer:!1}})(v),[v]),$=(e,t)=>{if(!e||!t)return"";let r=5===t.length?"".concat(t):t.slice(0,5);return"".concat(e,"T").concat(r)};(0,n.useEffect)(()=>{if(!r)return;(0,p.WR)().then(N).catch(()=>N([])),(0,h.UU)().then(A).catch(()=>A([])),D((null==y?void 0:y.vehicleNumber)||v.assignedVehicleNumber||""),E((null==y?void 0:y.driverName)||v.assignedDriverName||""),q((null==y?void 0:y.driverPhone)||v.assignedDriverPhone||"");let e=v.dateOfTravel,t=v.returnDate||v.dateOfTravel;K(f((null==y?void 0:y.pickupAt)||v.scheduledPickupAt||$(e,v.timeFrom))),F(f((null==y?void 0:y.expectedReturnAt)||v.scheduledReturnAt||$(t,v.timeTo))),M((null==y?void 0:y.instructions)||""),J(null),G(null)},[r,v,y]);let Z=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t},ee=(e,t,r)=>{let a=new Date(e.from),n=new Date(e.to);return!!(Number.isNaN(a.getTime())||Number.isNaN(n.getTime()))||t<n&&r>a};(0,n.useEffect)(()=>{var e,t;if(!r)return;let a=Z(R),n=Z(z);if(!a||!n||n<=a)return void G(null);let s=R.split("T")[0]||"",i=(null==(e=R.split("T")[1])?void 0:e.slice(0,5))||"",l=(null==(t=z.split("T")[1])?void 0:t.slice(0,5))||"";Y(!0),(0,x.C)({date:s,from:i,to:l}).then(e=>{if(!Array.isArray(e)||!e.length)return void G(null);let t=new Set;for(let r of e)!(r.busy||[]).some(e=>ee(e,a,n))&&r.vehicleNumber&&t.add(r.vehicleNumber);G(t)}).catch(()=>G(null)).finally(()=>Y(!1))},[r,R,z]);let et=(0,n.useMemo)(()=>{let e=T.trim().toLowerCase();return e?b.filter(t=>[t.vehicleNumber,t.vehicleType,t.brand,t.model].filter(Boolean).join(" ").toLowerCase().includes(e)):b},[b,T]),er=(0,n.useMemo)(()=>{let e=k.trim().toLowerCase();return e?w.filter(t=>[t.name,t.employeeId,t.phone].filter(Boolean).join(" ").toLowerCase().includes(e)):w},[w,k]),ea=(0,n.useMemo)(()=>{if(!R||!z||!S.trim()||!O.trim())return!1;let e=new Date(R);return new Date(z)>e},[R,z,S,O]),en=async()=>{U(!0),J(null);try{await (0,s.uK)(l,{vehicleNumber:S,driverName:O,driverPhone:P||void 0,pickupAt:R,expectedReturnAt:z,instructions:L||void 0}),null==j||j(),i()}catch(e){J((null==e?void 0:e.message)||"Failed to assign")}finally{U(!1)}};if(!r)return null;let es=e=>(0,a.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:e});return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 grid place-items-center z-50 p-4",onClick:i,children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-5xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-orange-50",children:[(0,a.jsxs)("h3",{className:"font-bold text-orange-900",children:["Assign Vehicle • ",v.requestCode]}),(0,a.jsx)("button",{className:"p-2 rounded hover:bg-orange-100",onClick:i,children:(0,a.jsx)(c.A,{size:18})})]}),(0,a.jsxs)("div",{className:"px-5 py-4 bg-orange-50/30 border-b text-sm grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"md:col-span-3 flex flex-wrap gap-3 text-xs",children:[(0,a.jsxs)("span",{className:"px-2 py-1 rounded bg-white border text-orange-800 font-semibold",children:["Code: ",v.requestCode]}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded bg-white border text-orange-800",children:["Applied: ",v.appliedDate||"—"]}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded bg-white border text-orange-800",children:["Status: ",v.status||"APPROVED"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Applicant:"})," ",v.applicantName," (",v.employeeId,")"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Department:"})," ",v.department||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Overnight:"})," ",v.overnight?"Yes":"No"]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("b",{children:"Travel Dates:"})," ",v.dateOfTravel," → ",v.returnDate||v.dateOfTravel]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Time Window:"})," ",v.timeFrom," – ",v.timeTo]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"From / To:"})," ",v.fromLocation," → ",v.toLocation]}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("b",{children:"Purpose:"})," ",String(null!=(t=null==v?void 0:v.officialDescription)?t:"").split(/\r?\n/).filter(e=>!/travell?ing\s+officer\s*:/i.test(e)).join("\n").replace(/\b(?:Phone|Tel)\s*:\s*[\+\d()\-\s./;]+/gi,"").trim()||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Goods:"})," ",v.goods||"—"]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("b",{children:"Officer:"})," ",Q.withOfficer?(0,a.jsxs)(a.Fragment,{children:[Q.name||"—",Q.id?" (".concat(Q.id,")"):"",Q.phone?" • ".concat(Q.phone):""]}):"—"]}),"remarks"in v&&(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("b",{children:"Remarks:"})," ",v.remarks||"—"]})]}),(0,a.jsxs)("div",{className:"p-5 space-y-5",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[es("Pickup At *"),(0,a.jsx)("input",{type:"datetime-local",className:"w-full border border-orange-200 rounded px-3 py-2",value:R,onChange:e=>K(e.target.value)})]}),(0,a.jsxs)("div",{children:[es("Expected Return *"),(0,a.jsx)("input",{type:"datetime-local",className:"w-full border border-orange-200 rounded px-3 py-2",value:z,onChange:e=>F(e.target.value)})]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:H?"Checking vehicle availability…":X?"Showing vehicles available for ".concat(R||"start"," → ").concat(z||"end","."):"Showing all vehicles (enter both date/time to filter availability)."}),(0,a.jsxs)("div",{className:"relative",children:[es("Vehicle *"),(0,a.jsxs)("div",{className:"flex items-center border border-orange-200 rounded px-3 py-2 cursor-pointer bg-white",onClick:()=>V("vehicle"===_?null:"vehicle"),children:[(0,a.jsx)(o.A,{size:16,className:"text-orange-600 mr-2"}),(0,a.jsx)("span",{className:"flex-1",children:S||"Select vehicle…"}),(0,a.jsx)(d.A,{size:16,className:"text-orange-600"})]}),"vehicle"===_&&(0,a.jsxs)("div",{className:"absolute z-50 mt-1 bg-white border rounded shadow max-h-60 w-full overflow-auto",children:[(0,a.jsxs)("div",{className:"flex items-center px-2 py-1 border-b",children:[(0,a.jsx)(u.A,{size:14,className:"text-orange-600 mr-2"}),(0,a.jsx)("input",{className:"flex-1 text-sm focus:outline-none",placeholder:"Search vehicles…",value:T,onChange:e=>I(e.target.value)})]}),et.filter(e=>!X||X.has(e.vehicleNumber)).map(e=>(0,a.jsxs)("div",{className:"px-3 py-2 hover:bg-orange-50 cursor-pointer text-sm",onClick:()=>{D(e.vehicleNumber),V(null)},children:[(0,a.jsx)("div",{className:"font-medium",children:e.vehicleNumber}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:[e.vehicleType,e.brand,e.model].filter(Boolean).join(" ")})]},e.id)),!et.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"No vehicles found"})]})]}),(0,a.jsxs)("div",{className:"relative",children:[es("Driver *"),(0,a.jsxs)("div",{className:"flex items-center border border-orange-200 rounded px-3 py-2 cursor-pointer bg-white",onClick:()=>V("driver"===_?null:"driver"),children:[(0,a.jsx)(m.A,{size:16,className:"text-orange-600 mr-2"}),(0,a.jsx)("span",{className:"flex-1",children:O||"Select driver…"}),(0,a.jsx)(d.A,{size:16,className:"text-orange-600"})]}),"driver"===_&&(0,a.jsxs)("div",{className:"absolute z-50 mt-1 bg-white border rounded shadow max-h-60 w-full overflow-auto",children:[(0,a.jsxs)("div",{className:"flex items-center px-2 py-1 border-b",children:[(0,a.jsx)(u.A,{size:14,className:"text-orange-600 mr-2"}),(0,a.jsx)("input",{className:"flex-1 text-sm focus:outline-none",placeholder:"Search drivers…",value:k,onChange:e=>C(e.target.value)})]}),er.map(e=>(0,a.jsxs)("div",{className:"px-3 py-2 hover:bg-orange-50 cursor-pointer text-sm",onClick:()=>{E(e.name),q(e.phone||""),V(null)},children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[e.employeeId," • ",e.phone||"-"]})]},e.employeeId)),!er.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"No drivers found"})]}),P&&(0,a.jsxs)("div",{className:"text-xs text-gray-700 mt-1",children:["Phone: ",P]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[es("Pickup At *"),(0,a.jsx)("input",{type:"datetime-local",className:"w-full border border-orange-200 rounded px-3 py-2",value:R,onChange:e=>K(e.target.value)})]}),(0,a.jsxs)("div",{children:[es("Expected Return *"),(0,a.jsx)("input",{type:"datetime-local",className:"w-full border border-orange-200 rounded px-3 py-2",value:z,onChange:e=>F(e.target.value)})]})]}),(0,a.jsxs)("div",{children:[es("Instructions (optional)"),(0,a.jsx)("textarea",{rows:3,className:"w-full border border-orange-200 rounded px-3 py-2",value:L,onChange:e=>M(e.target.value)})]}),W&&(0,a.jsx)("div",{className:"text-sm rounded border border-red-300 bg-red-50 text-red-800 px-3 py-2",children:W})]}),(0,a.jsxs)("div",{className:"px-5 py-3 border-t bg-orange-50 flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 rounded border",onClick:i,children:"Cancel"}),(0,a.jsx)("button",{disabled:!ea||B,onClick:en,className:"px-4 py-2 rounded bg-orange-600 text-white disabled:opacity-60",children:B?"Saving…":"Assign"})]})]})})}var y=r(12008);let j=e=>{var t,r,a;let n=null!=(r=null!=(t=e.appliedDate)?t:e.applied_at)?r:e.appliedOn,s=null!=(a=e.appliedTime)?a:e.applied_time;if(n&&s)return"".concat(n," ").concat(s);if(n&&e.createdAt){let t=new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return"".concat(n," ").concat(t)}return e.createdAt?(e=>e?new Date(e).toLocaleString():"—")(e.createdAt):"—"},b=e=>(null!=e?e:"").replace(/[^\d+()\-\s./;]/g,"").replace(/^[;,\s-]+/,"").replace(/\s{2,}/g," ").trim();function N(e){var t,r,a,n;if(!e)return{withOfficer:!1};if(e.travelWithOfficer||e.officerName||e.officerId||e.officerPhone)return{withOfficer:!0,name:e.officerName||void 0,id:e.officerId||void 0,phone:b(e.officerPhone)||void 0};let s="".concat(null!=(t=null==e?void 0:e.officialDescription)?t:"","\n").concat(null!=(r=null==e?void 0:e.remarks)?r:""),i=/Travelling\s+Officer:\s*([^\(\n,]+)?(?:\s*\((?:Employee\s*ID|Emp\.?\s*ID|ID)\s*:\s*([^)]+)\))?(?:,\s*(?:Phone|Tel)\s*:\s*([^\n]+))?/i.exec(s);return i?{withOfficer:!0,name:(null==(a=i[1])?void 0:a.trim())||void 0,id:(null==(n=i[2])?void 0:n.trim())||void 0,phone:b(i[3])||void 0}:{withOfficer:!1}}function w(e){var t,r;let a="".concat(String(null!=(t=null==e?void 0:e.officialDescription)?t:""),"\n").concat(String(null!=(r=null==e?void 0:e.remarks)?r:"")).trim();if(!a)return"—";let n=a.split(/\r?\n/).filter(e=>!/travell?ing\s+officer\s*:/i.test(e)).join("\n");return(n=n.replace(/\b(?:Phone|Tel)\s*:\s*[\+\d()\-\s./;]+/gi,"")).trim()||"—"}let A=["12%","17%","8%","12%","15%","13%","13%","10%"];function T(){let[e,t]=(0,n.useState)([]),[r,c]=(0,n.useState)(""),[o,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),[p,h]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null),g=(0,n.useCallback)(async()=>{h(!0);try{t(await (0,s.iv)("APPROVED")||[])}finally{h(!1)}},[]);(0,n.useEffect)(()=>{g()},[g]);let b=(0,n.useMemo)(()=>{let t=r.trim().toLowerCase();return t?e.filter(e=>{let r=N(e);return[e.requestCode,e.applicantName,e.employeeId,e.department,e.fromLocation,e.toLocation,e.dateOfTravel,e.timeFrom,e.timeTo,e.officialDescription,e.goods,r.name,r.id,r.phone,j(e)].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(t)}):e},[e,r]);return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h1",{className:"text-[14px] md:text-lg font-bold text-orange-900",children:"Approved (Awaiting Assignment)"}),(0,a.jsx)(l.A,{value:r,onChange:c,placeholder:"Search code, applicant, dept, route…",className:"w-full sm:w-72"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-orange-200 overflow-auto",children:(0,a.jsxs)("table",{className:"w-full table-fixed text-[10.5px] leading-[1.15]",children:[(0,a.jsx)("colgroup",{children:A.map((e,t)=>(0,a.jsx)("col",{style:{width:e}},t))}),(0,a.jsx)("thead",{className:"bg-orange-50",children:(0,a.jsxs)("tr",{className:"text-[9.5px]",children:[(0,a.jsx)(i.Th,{className:"px-2 py-1 text-left",children:"RQ ID / Applied"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-left",children:"Applicant / Dept"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-center",children:"Status"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-left",children:"Travel"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-left",children:"Route"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-left",children:"Officer"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-left",children:"Purpose / Goods"}),(0,a.jsx)(i.Th,{className:"px-2 py-1 text-center",children:"Actions"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[p&&(0,a.jsx)("tr",{children:(0,a.jsx)(i.Td,{colSpan:8,className:"px-2 py-6 text-center text-gray-500",children:"Loading…"})}),!p&&b.map(e=>{let t=N(e);return(0,a.jsxs)("tr",{className:"align-top hover:bg-orange-50/40 cursor-pointer",onClick:()=>f(e),children:[(0,a.jsxs)(i.Td,{className:"px-2 py-1",children:[(0,a.jsx)("div",{className:"font-semibold text-orange-900 truncate",children:e.requestCode}),(0,a.jsx)("div",{className:"text-[9px] text-gray-600 truncate",children:j(e)})]}),(0,a.jsxs)(i.Td,{className:"px-2 py-1",children:[(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("span",{className:"font-medium text-orange-900",children:e.applicantName}),(0,a.jsxs)("span",{className:"text-gray-600 text-[9px]",children:[" (",e.employeeId,")"]})]}),(0,a.jsx)("div",{className:"text-[9px] text-gray-700 truncate",children:e.department||"—"})]}),(0,a.jsx)(i.Td,{className:"px-2 py-1 text-center",children:(0,a.jsx)("span",{className:"inline-block text-[10px] px-1.5 py-[2px] rounded bg-green-100 text-green-800 leading-none",children:"APPROVED"})}),(0,a.jsxs)(i.Td,{className:"px-2 py-1",children:[(0,a.jsx)("div",{children:e.dateOfTravel}),(0,a.jsxs)("div",{className:"text-[9px] text-gray-600",children:[e.timeFrom," – ",e.timeTo]})]}),(0,a.jsxs)(i.Td,{className:"px-2 py-1",children:[e.fromLocation," → ",e.toLocation]}),(0,a.jsx)(i.Td,{className:"px-2 py-1",children:t.withOfficer?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[t.name||"—",t.id?(0,a.jsxs)("span",{className:"text-[9px] text-gray-600",children:[" (",t.id,")"]}):null]}),t.phone?(0,a.jsx)("div",{className:"text-[9px] text-gray-700",children:t.phone}):null]}):"—"}),(0,a.jsxs)(i.Td,{className:"px-2 py-1",children:[(0,a.jsx)("div",{className:"text-orange-900 whitespace-pre-wrap break-words",children:w(e)}),(0,a.jsx)("div",{className:"text-[9px] text-orange-700/80",children:e.goods||"—"})]}),(0,a.jsx)(i.Td,{className:"px-2 py-1 text-center",onClick:e=>e.stopPropagation(),children:(0,a.jsx)("button",{className:"px-2.5 py-[6px] rounded bg-orange-600 text-white text-[10px]",onClick:()=>{d(e),m(!0)},children:"Assign"})})]},e.id)}),!p&&!b.length&&(0,a.jsx)("tr",{children:(0,a.jsx)(i.Td,{colSpan:8,className:"px-2 py-6 text-center text-gray-500",children:"No approved requests"})})]})]})}),x&&(0,a.jsx)(I,{request:x,onClose:()=>f(null)}),o&&(0,a.jsx)(v,{open:u,onClose:()=>{m(!1),d(null)},requestId:o.id,request:o,defaultValues:{vehicleNumber:"",driverName:"",driverPhone:""},onAssigned:()=>{y.oR.success("Assignment saved"),d(null),m(!1),g()}})]})}function I(e){let{request:t,onClose:r}=e,n=N(t);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 grid place-items-center z-50 p-3",onClick:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b bg-orange-50",children:[(0,a.jsxs)("h3",{className:"font-bold text-orange-900 text-[13px]",children:["Request • ",t.requestCode]}),(0,a.jsx)("button",{className:"p-1 rounded hover:bg-orange-100",onClick:r,children:(0,a.jsx)(c.A,{size:16})})]}),(0,a.jsx)("div",{className:"p-4 text-[12px] leading-tight space-y-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("section",{children:[(0,a.jsx)("div",{className:"font-semibold text-orange-800 mb-1",children:"Applicant / Dept"}),(0,a.jsxs)("div",{children:[t.applicantName," (",t.employeeId,")"]}),(0,a.jsx)("div",{children:t.department||"—"})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("div",{className:"font-semibold text-orange-800 mb-1",children:"Status & Applied"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Status:"})," APPROVED"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("b",{children:"Applied:"})," ",j(t)]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("div",{className:"font-semibold text-orange-800 mb-1",children:"Travel / Route"}),(0,a.jsx)("div",{children:t.dateOfTravel}),(0,a.jsxs)("div",{children:[t.timeFrom," – ",t.timeTo]}),(0,a.jsxs)("div",{children:[t.fromLocation," → ",t.toLocation]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("div",{className:"font-semibold text-orange-800 mb-1",children:"Officer"}),n.withOfficer?(0,a.jsxs)("div",{children:[n.name||"—",n.id?" (".concat(n.id,")"):"",n.phone?", ".concat(n.phone):""]}):"—"]}),(0,a.jsxs)("section",{className:"md:col-span-2",children:[(0,a.jsx)("div",{className:"font-semibold text-orange-800 mb-1",children:"Purpose / Goods"}),(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words",children:w(t)}),(0,a.jsx)("div",{children:t.goods||"—"})]})]})}),(0,a.jsx)("div",{className:"px-4 py-2 border-t bg-orange-50 flex justify-end",children:(0,a.jsx)("button",{className:"px-4 py-2 rounded border",onClick:r,children:"Close"})})]})})}},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,I:()=>o});var a=r(95125),n=r(95704);let s=(n.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),i=Math.min(Number(n.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),l=a.A.create({baseURL:s?"".concat(s,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:i}),c=l;function o(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}l.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let n=localStorage.getItem("role")||void 0;n&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=n)}return e}),l.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,n,s,i;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(s=null==(a=e.response)?void 0:a.status)?s:0,statusText:"Request Timeout",data:null,headers:null!=(i=null==(n=e.response)?void 0:n.headers)?i:{},config:e.config,request:e.request})}return Promise.reject(e)})},83460:(e,t,r)=>{Promise.resolve().then(r.bind(r,76849))},86651:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},93402:(e,t,r)=>{"use strict";r.d(t,{mI:()=>s,ae:()=>i});var a=r(81242);let n=e=>{var t,r,a;return{id:e.id,entityType:"Vehicle"===e.entityType||"Driver"===e.entityType?e.entityType:"Vehicle",entityId:e.entityId,action:"Created"===e.action||"Updated"===e.action||"Deleted"===e.action?e.action:"Updated",previousData:null!=(t=e.previousJson)?t:null,newData:null!=(r=e.newJson)?r:null,performedBy:null!=(a=e.performedBy)?a:null,timestamp:e.timestamp}};async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,{data:t}=await a.A.get("/history/recent",{params:{size:e}});return(0,a.I)(t).map(n)}async function i(e,t){let{data:r}=await a.A.get("/history/".concat(e,"/").concat(t));return(0,a.I)(r).map(n)}},99265:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]])}},e=>{e.O(0,[5125,970,8441,1255,7358],()=>e(e.s=83460)),_N_E=e.O()}]);