(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7474],{7640:(e,t,r)=>{"use strict";r.d(t,{Td:()=>n,Th:()=>s});var a=r(95155);function s(e){let{children:t,className:r="",sortable:s,sortDirection:n,onClick:l,...i}=e;return(0,a.jsx)("th",{...i,"aria-sort":"asc"===n?"ascending":"desc"===n?"descending":"none",onClick:s?l:void 0,onKeyDown:s?e=>{s&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==l||l())}:void 0,tabIndex:s?0:void 0,className:["px-2 py-2 md:px-3 md:py-2.5 text-left font-semibold text-orange-900 whitespace-normal align-middle leading-snug bg-orange-100 border-b-2 border-orange-200",s?"cursor-pointer hover:bg-orange-200 transition-colors":"",n?"bg-orange-200":"",r].join(" "),children:(0,a.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[t,s&&(0,a.jsx)("span",{"aria-hidden":"true",className:"text-orange-600",children:"asc"===n?"↑":"desc"===n?"↓":"↕"})]})})}function n(e){let{children:t,className:r="",highlight:s,...n}=e;return(0,a.jsx)("td",{...n,className:["px-2 py-2 md:px-3 md:py-2.5 align-top border-b border-orange-100 transition-colors duration-150 whitespace-normal break-words leading-snug text-orange-800",s?"bg-orange-50 font-medium":"",r].join(" "),children:t})}r(12115)},11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>h,Lh:()=>c,bB:()=>s,bk:()=>d,cK:()=>l,iq:()=>o,iv:()=>i,kM:()=>x,lm:()=>n,qd:()=>g,rg:()=>m,rr:()=>u,uK:()=>p});var a=r(81242);async function s(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:s}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,a.I)(s)}async function l(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(r){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function i(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function o(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let c=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function p(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:s}=await a.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,a.I)(s)}async function x(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&s.push(...t.exitManifest),s.length&&(r.exitManifest=s);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,a.I)(n)}async function h(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&s.push(...t.entryManifest),s.length&&(r.entryManifest=s);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,a.I)(n)}async function g(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},12998:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(95155),s=r(12115),n=r(7640),l=r(35119),i=r(11924),o=r(24947),c=r(99265);let d=(0,r(71847).A)("clock-3",[["path",{d:"M12 6v6h4",key:"135r8i"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),u=e=>e.gateExitAt||e.scheduledPickupAt||(e.dateOfTravel&&e.timeFrom?"".concat(e.dateOfTravel,"T").concat(e.timeFrom):null);function m(){let[e,t]=(0,s.useState)([]),[r,m]=(0,s.useState)(""),[p,x]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),f=async()=>{x(!0);try{let[e,r]=await Promise.all([(0,i.iv)("DISPATCHED"),(0,i.iv)("SCHEDULED")]),a=[...e||[],...r||[]].filter(e=>(null==e?void 0:e.gateExitAt)&&!(null==e?void 0:e.gateEntryAt)).sort((e,t)=>(Date.parse((null==t?void 0:t.gateExitAt)||"")||0)-(Date.parse((null==e?void 0:e.gateExitAt)||"")||0));t(a)}finally{x(!1)}};(0,s.useEffect)(()=>{f()},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>g(new Date),6e4);return()=>clearInterval(e)},[]);let y=(0,s.useMemo)(()=>r?e.filter(e=>[e.requestCode,e.assignedVehicleNumber,e.assignedDriverName,e.assignedDriverPhone,e.department,e.fromLocation,e.toLocation,e.dateOfTravel,e.timeFrom,e.timeTo,e.gateExitAt].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(r.trim().toLowerCase())):e,[e,r]);return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h1",{className:"text-[14px] md:text-lg font-bold text-orange-900",children:"Active Vehicles (On Trip)"}),(0,a.jsx)(l.A,{value:r,onChange:m,placeholder:"Search code, vehicle, driver, route…",className:"w-full sm:w-72"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-orange-200",children:(0,a.jsx)("div",{className:"overflow-x-auto overflow-y-hidden [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar-thumb]:bg-orange-300 [&::-webkit-scrollbar-track]:bg-transparent [scrollbar-width:thin]",children:(0,a.jsxs)("table",{className:"min-w-full table-fixed text-[10.5px] leading-[1.15]",children:[(0,a.jsxs)("colgroup",{children:[(0,a.jsx)("col",{className:"w-40"}),(0,a.jsx)("col",{className:"w-40"}),(0,a.jsx)("col",{className:"w-48"}),(0,a.jsx)("col",{className:"w-44"}),(0,a.jsx)("col",{className:"w-20"}),(0,a.jsx)("col",{className:"w-[18rem]"})]}),(0,a.jsx)("thead",{className:"bg-orange-50",children:(0,a.jsxs)("tr",{className:"text-[9.5px]",children:[(0,a.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"RQ Code"}),(0,a.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Vehicle"}),(0,a.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Driver"}),(0,a.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Started / Elapsed"}),(0,a.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Exit Odo"}),(0,a.jsx)(n.Th,{className:"px-2 py-1 text-left",children:"Route"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[p&&(0,a.jsx)("tr",{children:(0,a.jsx)(n.Td,{colSpan:6,className:"px-2 py-6 text-center text-gray-500",children:"Loading…"})}),!p&&y.map(e=>{var t;let r;return(0,a.jsxs)("tr",{className:"align-top hover:bg-orange-50/40",children:[(0,a.jsxs)(n.Td,{className:"px-2 py-1",children:[(0,a.jsx)("div",{className:"font-semibold text-orange-900 truncate",children:e.requestCode}),(0,a.jsx)("div",{className:"text-[9px] text-gray-600 truncate",children:e.department||"—"})]}),(0,a.jsx)(n.Td,{className:"px-2 py-1",children:(0,a.jsxs)("div",{className:"inline-flex items-center gap-1 truncate",children:[(0,a.jsx)(o.A,{size:12,className:"text-orange-700"}),(0,a.jsx)("span",{className:"font-medium",children:e.assignedVehicleNumber||"—"})]})}),(0,a.jsxs)(n.Td,{className:"px-2 py-1",children:[(0,a.jsxs)("div",{className:"truncate inline-flex items-center gap-1",children:[(0,a.jsx)(c.A,{size:12,className:"text-orange-700"}),(0,a.jsx)("span",{children:e.assignedDriverName||"—"})]}),(0,a.jsx)("div",{className:"text-[9px] text-gray-600 truncate",children:e.assignedDriverPhone?"(".concat(e.assignedDriverPhone,")"):"—"}),e.assignedDriverName&&h?(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 text-[10px] font-semibold text-emerald-700 bg-emerald-50 px-2 py-[2px] rounded-full mt-1",children:[(0,a.jsx)("span",{className:"h-2 w-2 rounded-full bg-emerald-500 animate-pulse"}),"On trip"]}):null]}),(0,a.jsxs)(n.Td,{className:"px-2 py-1",children:[(0,a.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)(d,{size:12,className:"text-orange-700"}),(0,a.jsx)("span",{children:(r=u(e))?new Date(r).toLocaleString():"—"})]}),(0,a.jsxs)("div",{className:"text-[9px] text-emerald-700 font-semibold",children:["Elapsed: ",((e,t)=>{if(!e||!t)return"—";let r=t.getTime()-new Date(e).getTime();if(Number.isNaN(r)||r<0)return"—";let a=Math.floor(r/6e4),s=Math.floor(a/60),n=a%60;return s?"".concat(s,"h ").concat(n,"m"):"".concat(n,"m")})(u(e),h)]})]}),(0,a.jsx)(n.Td,{className:"px-2 py-1",children:null!=(t=e.exitOdometer)?t:"—"}),(0,a.jsxs)(n.Td,{className:"px-2 py-1",children:[(0,a.jsxs)("div",{className:"truncate",children:[e.fromLocation," → ",e.toLocation]}),(0,a.jsxs)("div",{className:"text-[9px] text-gray-600",children:[(0,a.jsx)("span",{className:"font-mono",children:e.dateOfTravel||"—"})," ",(0,a.jsx)("span",{className:"font-mono",children:e.timeFrom||"—"}),"–",(0,a.jsx)("span",{className:"font-mono",children:e.timeTo||"—"})," ",e.overnight?"(overnight)":""]})]})]},e.id)}),!p&&!y.length&&(0,a.jsx)("tr",{children:(0,a.jsx)(n.Td,{colSpan:6,className:"px-2 py-6 text-center text-gray-500",children:"No active trips"})})]})]})})})]})}},24947:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},35119:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(95155),s=r(12115),n=r(86651),l=r(65229);function i(e){let{value:t,onChange:r,placeholder:i="Search…",className:o="",name:c,disabled:d=!1}=e,u=(0,s.useId)(),m=c||"incharge-search-".concat(u),p="incharge-search-".concat(u);return(0,a.jsxs)("div",{className:"relative w-full ".concat(o),children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-2 flex items-center pointer-events-none text-orange-500",children:(0,a.jsx)(n.A,{size:16})}),(0,a.jsx)("input",{type:"search",value:t,onChange:e=>r(e.target.value),placeholder:i,"aria-label":"Search",name:m,id:p,autoComplete:"new-password","data-lpignore":"true","data-1p-ignore":"true","data-form-type":"other",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,disabled:d,className:"w-full h-9 rounded-lg border border-orange-200 bg-white/90 pl-8 pr-8 text-sm text-orange-900 placeholder-orange-400/70 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-shadow ".concat(d?"opacity-70 cursor-not-allowed":"")}),t&&!d&&(0,a.jsx)("button",{type:"button",onClick:()=>r(""),className:"absolute inset-y-0 right-2 flex items-center text-orange-500 hover:text-orange-700","aria-label":"Clear search",children:(0,a.jsx)(l.A,{size:16})})]})}},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71847:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(12115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...l,width:s,height:s,stroke:r,strokeWidth:o?24*Number(i)/Number(s):i,className:n("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let r=(0,a.forwardRef)((r,l)=>{let{className:o,...c}=r;return(0,a.createElement)(i,{ref:l,iconNode:t,className:n("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...c})});return r.displayName=s(e),r}},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,I:()=>c});var a=r(95125),s=r(95704);let n=(s.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),l=Math.min(Number(s.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),i=a.A.create({baseURL:n?"".concat(n,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:l}),o=i;function c(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}i.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let s=localStorage.getItem("role")||void 0;s&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=s)}return e}),i.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,s,n,l;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(n=null==(a=e.response)?void 0:a.status)?n:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(s=e.response)?void 0:s.headers)?l:{},config:e.config,request:e.request})}return Promise.reject(e)})},86651:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},94265:(e,t,r)=>{Promise.resolve().then(r.bind(r,12998))},99265:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]])}},e=>{e.O(0,[5125,8441,1255,7358],()=>e(e.s=94265)),_N_E=e.O()}]);