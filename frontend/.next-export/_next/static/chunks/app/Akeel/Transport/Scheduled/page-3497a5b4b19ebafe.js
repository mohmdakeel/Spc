(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[841],{4576:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(95155),n=r(12115),a=r(7640),l=r(11924),o=r(63914),i=r(12008);let d=e=>e?new Date(e).toLocaleString():"-";function c(){let[e,t]=(0,n.useState)([]),[r,c]=(0,n.useState)([]),[u,m]=(0,n.useState)(null),[x,h]=(0,n.useState)(null),g=async()=>{try{let[e,r]=await Promise.all([(0,l.iv)("SCHEDULED"),(0,l.iv)("DISPATCHED")]);t(e||[]),c(r||[])}catch(e){i.oR.error((null==e?void 0:e.message)||"Failed to load scheduled vehicles"),t([]),c([])}};return(0,n.useEffect)(()=>{g()},[]),(0,s.jsxs)("div",{className:"space-y-6 min-h-screen bg-orange-50 p-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h1",{className:"text-lg font-bold text-orange-900",children:"Scheduled Vehicles"}),(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-orange-600 text-white text-sm font-semibold",onClick:g,children:"Refresh"})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl border border-orange-200 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-orange-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)(a.Th,{children:"Code"}),(0,s.jsx)(a.Th,{children:"Vehicle"}),(0,s.jsx)(a.Th,{children:"Driver"}),(0,s.jsx)(a.Th,{children:"Pickup"}),(0,s.jsx)(a.Th,{children:"Return"}),(0,s.jsx)(a.Th,{className:"text-center",children:"Action"})]})}),(0,s.jsxs)("tbody",{className:"divide-y",children:[e.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)(a.Td,{children:e.requestCode}),(0,s.jsx)(a.Td,{children:e.assignedVehicleNumber||"-"}),(0,s.jsx)(a.Td,{children:e.assignedDriverName||"-"}),(0,s.jsx)(a.Td,{children:d(e.scheduledPickupAt)}),(0,s.jsx)(a.Td,{children:d(e.scheduledReturnAt)}),(0,s.jsx)(a.Td,{className:"text-center",children:(0,s.jsx)("button",{className:"px-3 py-1 rounded bg-orange-600 text-white text-sm font-semibold",onClick:()=>m(e),children:"Mark Exit"})})]},e.id)),!e.length&&(0,s.jsx)("tr",{children:(0,s.jsx)(a.Td,{colSpan:6,className:"text-center text-gray-500 py-6",children:"No scheduled vehicles"})})]})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-orange-900 mb-2",children:"On Trip (Dispatched)"}),(0,s.jsx)("div",{className:"bg-white rounded-xl border border-orange-200 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-orange-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)(a.Th,{children:"Code"}),(0,s.jsx)(a.Th,{children:"Vehicle"}),(0,s.jsx)(a.Th,{children:"Driver"}),(0,s.jsx)(a.Th,{children:"Exit Time"}),(0,s.jsx)(a.Th,{children:"Exit Odometer"}),(0,s.jsx)(a.Th,{className:"text-center",children:"Action"})]})}),(0,s.jsxs)("tbody",{className:"divide-y",children:[r.map(e=>{var t;return(0,s.jsxs)("tr",{children:[(0,s.jsx)(a.Td,{children:e.requestCode}),(0,s.jsx)(a.Td,{children:e.assignedVehicleNumber||"-"}),(0,s.jsx)(a.Td,{children:e.assignedDriverName||"-"}),(0,s.jsx)(a.Td,{children:d(e.gateExitAt)}),(0,s.jsx)(a.Td,{children:null!=(t=e.exitOdometer)?t:"-"}),(0,s.jsx)(a.Td,{className:"text-center",children:(0,s.jsx)("button",{className:"px-3 py-1 rounded bg-green-600 text-white text-sm font-semibold",onClick:()=>h(e),children:"Mark Entry"})})]},e.id)}),!r.length&&(0,s.jsx)("tr",{children:(0,s.jsx)(a.Td,{colSpan:6,className:"text-center text-gray-500 py-6",children:"None"})})]})]})})]}),u&&(0,s.jsx)(o.A,{mode:"exit",open:!!u,onClose:()=>m(null),onSubmit:async e=>{try{var t,r;await (0,l.kM)(u.id,{odometerStartKm:null!=(t=e.odometer)?t:void 0,remarks:null!=(r=e.remarks)?r:void 0}),i.oR.success("Exit logged"),m(null),g()}catch(e){i.oR.error((null==e?void 0:e.message)||"Failed")}}}),x&&(0,s.jsx)(o.A,{mode:"entry",open:!!x,onClose:()=>h(null),onSubmit:async e=>{try{var t,r;await (0,l.Cd)(x.id,{odometerEndKm:null!=(t=e.odometer)?t:void 0,remarks:null!=(r=e.remarks)?r:void 0}),i.oR.success("Entry logged"),h(null),g()}catch(e){i.oR.error((null==e?void 0:e.message)||"Failed")}}})]})}},7640:(e,t,r)=>{"use strict";r.d(t,{Td:()=>a,Th:()=>n});var s=r(95155);function n(e){let{children:t,className:r="",sortable:n,sortDirection:a,onClick:l,...o}=e;return(0,s.jsx)("th",{...o,"aria-sort":"asc"===a?"ascending":"desc"===a?"descending":"none",onClick:n?l:void 0,onKeyDown:n?e=>{n&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==l||l())}:void 0,tabIndex:n?0:void 0,className:["px-2 py-2 md:px-3 md:py-2.5 text-left font-semibold text-orange-900 whitespace-normal align-middle leading-snug bg-orange-100 border-b-2 border-orange-200",n?"cursor-pointer hover:bg-orange-200 transition-colors":"",a?"bg-orange-200":"",r].join(" "),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[t,n&&(0,s.jsx)("span",{"aria-hidden":"true",className:"text-orange-600",children:"asc"===a?"↑":"desc"===a?"↓":"↕"})]})})}function a(e){let{children:t,className:r="",highlight:n,...a}=e;return(0,s.jsx)("td",{...a,className:["px-2 py-2 md:px-3 md:py-2.5 align-top border-b border-orange-100 transition-colors duration-150 whitespace-normal break-words leading-snug text-orange-800",n?"bg-orange-50 font-medium":"",r].join(" "),children:t})}r(12115)},11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>g,Lh:()=>d,bB:()=>n,bk:()=>c,cK:()=>l,iq:()=>i,iv:()=>o,kM:()=>h,lm:()=>a,qd:()=>p,rg:()=>m,rr:()=>u,uK:()=>x});var s=r(81242);async function n(e){let{data:t}=await s.A.post("/usage-requests",e);return(0,s.I)(t)}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:n}=await s.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,s.I)(n)}async function l(){try{let{data:e}=await s.A.get("/usage-requests/all");return(0,s.I)(e)}catch(r){let{data:e}=await s.A.get("/usage-requests"),t=(0,s.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function o(e){try{let{data:t}=await s.A.get("/usage-requests/status/".concat(e));return(0,s.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function i(e){let{data:t}=await s.A.get("/usage-requests/".concat(e));return(0,s.I)(t)}let d=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),c=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function x(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:n}=await s.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,s.I)(n)}async function h(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let n=[];t.remarks&&n.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&n.push(...t.exitManifest),n.length&&(r.exitManifest=n);let{data:a}=await s.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,s.I)(a)}async function g(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let n=[];t.remarks&&n.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&n.push(...t.entryManifest),n.length&&(r.entryManifest=n);let{data:a}=await s.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,s.I)(a)}async function p(){let{data:e}=await s.A.get("/usage-requests/metrics");return(0,s.I)(e)}},63914:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(95155),n=r(12115),a=r(65229);function l(e){let{mode:t,open:r,onClose:l,onSubmit:o}=e,[i,d]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[h,g]=(0,n.useState)(null);return r?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 grid place-items-center z-50 p-4",onClick:l,children:(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-orange-50",children:[(0,s.jsx)("h3",{className:"font-semibold text-orange-900",children:"exit"===t?"Log Gate EXIT":"Log Gate ENTRY"}),(0,s.jsx)("button",{className:"p-2 rounded hover:bg-orange-100",onClick:l,"aria-label":"Close",children:(0,s.jsx)(a.A,{size:18})})]}),(0,s.jsxs)("div",{className:"p-5 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:["Odometer (km) — ","exit"===t?"Start":"End"]}),(0,s.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:i,onChange:e=>d(""===e.target.value?"":Number(e.target.value)),min:0,placeholder:"exit"===t?"e.g., 125000":"e.g., 125320"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Remarks"}),(0,s.jsx)("textarea",{className:"w-full border rounded px-3 py-2",rows:3,value:c,onChange:e=>u(e.target.value),placeholder:"Optional note"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-orange-800 mb-1",children:"Confirm with password"}),(0,s.jsx)("input",{type:"password",className:"w-full border rounded px-3 py-2",value:m,onChange:e=>x(e.target.value),placeholder:"Enter your password to confirm"})]}),h&&(0,s.jsx)("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded px-3 py-2",children:h})]}),(0,s.jsxs)("div",{className:"px-5 py-3 border-t bg-orange-50 flex justify-end gap-2",children:[(0,s.jsx)("button",{className:"px-4 py-2 rounded border",onClick:l,children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-2 rounded bg-orange-600 text-white",onClick:()=>{if(""===m.trim())return void g("Password required to confirm.");g(null),o({odometer:""===i?null:Number(i),remarks:(null==c?void 0:c.trim())||null,password:m.trim()})},children:"Save"})]})]})}):null}},64980:(e,t,r)=>{Promise.resolve().then(r.bind(r,4576))},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,I:()=>d});var s=r(95125),n=r(95704);let a=(n.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),l=Math.min(Number(n.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),o=s.A.create({baseURL:a?"".concat(a,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:l}),i=o;function d(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}o.interceptors.request.use(e=>{{var t,r;let s=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;s&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=s);let n=localStorage.getItem("role")||void 0;n&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=n)}return e}),o.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var s,n,a,l;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(a=null==(s=e.response)?void 0:s.status)?a:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(n=e.response)?void 0:n.headers)?l:{},config:e.config,request:e.request})}return Promise.reject(e)})}},e=>{e.O(0,[5125,970,8441,1255,7358],()=>e(e.s=64980)),_N_E=e.O()}]);