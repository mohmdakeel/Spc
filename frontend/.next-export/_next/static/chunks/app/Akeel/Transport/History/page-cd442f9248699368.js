(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2118],{2989:(e,t,r)=>{"use strict";r.d(t,{Du:()=>y,Hv:()=>d,JY:()=>g,Q3:()=>m,Tz:()=>p,WR:()=>c,W_:()=>h,ih:()=>u,p0:()=>x,vs:()=>f});var a=r(81242);r(93402);let n="/vehicles",s=e=>""===e||null==e?void 0:Number(e)||void 0,l=(e,t)=>{var r,a;return(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||t};function o(e){let t=(0,a.I)(e);return Array.isArray(t)?t:t&&Array.isArray(t.content)?t.content:[]}function i(e,t){if(Array.isArray(t))t.forEach(t=>e.append("files",t));else for(let r=0;r<t.length;r++){let a=t.item(r);a&&e.append("files",a)}}async function c(e){try{let{data:t}=await a.A.get(n,{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return o(t)}catch(e){throw Error(l(e,"Failed to fetch vehicles"))}}async function d(e){try{let{data:t}=await a.A.get("/vehicles/deleted",{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return o(t)}catch(e){throw Error(l(e,"Failed to fetch deleted vehicles"))}}async function x(e){try{let{data:t}=await a.A.get("".concat(n,"/").concat(e));return(0,a.I)(t)}catch(e){throw Error(l(e,"Vehicle not found"))}}async function h(e){try{let t={...e};delete t.id,"registeredKm"in t&&(t.registeredKm=s(t.registeredKm)),"totalKmDriven"in t&&(t.totalKmDriven=s(t.totalKmDriven)),"fuelEfficiency"in t&&(t.fuelEfficiency=s(t.fuelEfficiency));let{data:r}=await a.A.post(n,t);return(0,a.I)(r)}catch(e){throw Error(l(e,"Failed to add vehicle"))}}async function m(e,t){try{let r={...t};"registeredKm"in r&&(r.registeredKm=s(r.registeredKm)),"totalKmDriven"in r&&(r.totalKmDriven=s(r.totalKmDriven)),"fuelEfficiency"in r&&(r.fuelEfficiency=s(r.fuelEfficiency));let{data:l}=await a.A.put("".concat(n,"/").concat(e),r);return(0,a.I)(l)}catch(e){throw Error(l(e,"Failed to update vehicle"))}}async function u(e){try{await a.A.delete("".concat(n,"/").concat(e))}catch(e){throw Error(l(e,"Failed to delete vehicle"))}}async function g(e,t){let r=new FormData,l={...e};delete l.id,"registeredKm"in l&&(l.registeredKm=s(l.registeredKm)),"totalKmDriven"in l&&(l.totalKmDriven=s(l.totalKmDriven)),"fuelEfficiency"in l&&(l.fuelEfficiency=s(l.fuelEfficiency)),r.append("vehicle",JSON.stringify(l)),i(r,t);let{data:o}=await a.A.post("".concat(n,"/with-images"),r,{headers:{"Content-Type":"multipart/form-data"}});return(0,a.I)(o)}async function p(e){let{data:t}=await a.A.get("".concat(n,"/").concat(e,"/images"));return(0,a.I)(t)}async function y(e,t){let r=new FormData;i(r,t);let{data:s}=await a.A.post("".concat(n,"/").concat(e,"/images"),r,{headers:{"Content-Type":"multipart/form-data"}});return(0,a.I)(s)}async function f(e,t){await a.A.delete("".concat(n,"/").concat(e,"/images/").concat(t))}},6191:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8503:(e,t,r)=>{"use strict";r.d(t,{H5:()=>c,IY:()=>d,UU:()=>o,cI:()=>x,gP:()=>h,z:()=>i});var a=r(81242);r(93402);let n="/drivers",s=(e,t)=>{var r,a;return(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||t};function l(e){let t=(0,a.I)(e);return Array.isArray(t)?t:t&&Array.isArray(t.content)?t.content:[]}async function o(e){try{let{data:t}=await a.A.get(n,{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return l(t)}catch(e){throw Error(s(e,"Failed to fetch drivers"))}}async function i(e){try{let{data:t}=await a.A.get("/drivers/deleted",{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return l(t)}catch(e){throw Error(s(e,"Failed to fetch deleted drivers"))}}async function c(e){try{let{data:t}=await a.A.get("".concat(n,"/").concat(e));return(0,a.I)(t)}catch(e){throw Error(s(e,"Driver not found"))}}async function d(e){try{let{data:t}=await a.A.post(n,e);return(0,a.I)(t)}catch(e){throw Error(s(e,"Failed to add driver"))}}async function x(e,t){try{let{data:r}=await a.A.put("".concat(n,"/").concat(e),t);return(0,a.I)(r)}catch(e){throw Error(s(e,"Failed to update driver"))}}async function h(e){try{await a.A.delete("".concat(n,"/").concat(e))}catch(e){throw Error(s(e,"Failed to delete driver"))}}},20063:(e,t,r)=>{"use strict";var a=r(47260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},23327:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},26983:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},27937:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},35619:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("file-diff",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"M9 17h6",key:"r8uit2"}]])},35626:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},44876:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var a=r(95155),n=r(12115),s=r(20063),l=r(12008),o=r(90368),i=r(27937),c=r(35619),d=r(54485),x=r(35626),h=r(93402),m=r(71360),u=r(89559),g=r(6191),p=r(65229),y=r(26983),f=r(23327);function b(e){let{prevData:t,currentData:r,onClose:n,title:s,action:l,timestamp:o}=e,i=Array.from(new Set([...Object.keys(t||{}),...Object.keys(r||{})]));return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-orange-50 rounded-xl shadow-xl w-full max-w-5xl overflow-hidden border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-orange-200 bg-orange-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.A,{size:22,className:"text-orange-700"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-orange-900",children:s||"Data Comparison"})]}),(0,a.jsx)("button",{onClick:n,className:"p-2 rounded-lg hover:bg-orange-200 text-orange-700 transition-all","aria-label":"Close",children:(0,a.jsx)(p.A,{size:22})})]}),(l||o)&&(0,a.jsx)("div",{className:"px-6 py-4 bg-orange-75 border-b border-orange-200",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 text-sm text-orange-700",children:[l&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-100 rounded-lg",children:[(0,a.jsx)(u.A,{size:16,className:"text-orange-600"}),(0,a.jsx)("span",{className:"font-medium",children:"Action:"}),(0,a.jsx)("span",{className:"font-semibold text-orange-800",children:l})]}),o&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-100 rounded-lg",children:[(0,a.jsx)(y.A,{size:16,className:"text-orange-600"}),(0,a.jsx)("span",{className:"font-medium",children:"When:"}),(0,a.jsx)("span",{className:"font-semibold text-orange-800",children:new Date(o).toLocaleString()})]})]})}),(0,a.jsx)("div",{className:"p-6 bg-white overflow-auto max-h-[65vh]",children:(0,a.jsx)("div",{className:"border border-orange-200 rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-orange-100 text-orange-800",children:[(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Field"}),(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Previous Value"}),(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Current Value"})]})}),(0,a.jsx)("tbody",{children:i.map((e,n)=>{var s,l;let o=null!=(s=null==t?void 0:t[e])?s:"-",i=null!=(l=null==r?void 0:r[e])?l:"-",c=o!==i;return(0,a.jsxs)("tr",{className:"".concat(n%2==0?"bg-orange-50":"bg-orange-100/30"," ").concat(c?"!bg-yellow-50":""),children:[(0,a.jsx)("td",{className:"px-5 py-3 font-semibold text-orange-700 border-b border-orange-200/50",children:e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace(/_/g," ").trim()}),(0,a.jsx)("td",{className:"px-5 py-3 border-b border-orange-200/50 ".concat(c?"text-red-600 line-through font-medium":"text-orange-900"),children:String(o)}),(0,a.jsx)("td",{className:"px-5 py-3 border-b border-orange-200/50 ".concat(c?"text-green-600 font-semibold":"text-orange-900"),children:String(i)})]},e)})})]})})}),(0,a.jsx)("div",{className:"px-6 py-4 flex justify-end border-t border-orange-200 bg-orange-100",children:(0,a.jsx)("button",{onClick:n,className:"px-5 py-2.5 rounded-lg bg-orange-600 text-white hover:bg-orange-700 transition-all font-semibold shadow-md hover:shadow-lg",children:"Close"})})]})})}var v=r(8503),j=r(2989);function w(e){let{item:t,onClose:r}=e,[s,o]=(0,n.useState)(!1),[d,x]=(0,n.useState)(null),[h,w]=(0,n.useState)(!1),N=(0,n.useMemo)(()=>(e=>{if(!e)return{};if("object"==typeof e)return e;try{return JSON.parse(e)}catch(e){return{}}})(t.previousData),[t.previousData]),A="Deleted"===t.action?"bg-red-100 text-red-800 border-red-200":"Updated"===t.action?"bg-yellow-100 text-yellow-800 border-yellow-200":"Created"===t.action?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-800 border-gray-200",k="Deleted"===t.action?(0,a.jsx)(m.A,{size:18}):"Updated"===t.action?(0,a.jsx)(u.A,{size:18}):"Created"===t.action?(0,a.jsx)(g.A,{size:18}):(0,a.jsx)(c.A,{size:18}),C="Updated"===t.action&&Object.keys(N).length>0;(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]);let S=async()=>{if(C)try{w(!0);let e="Driver"===t.entityType?await (0,v.H5)(String(t.entityId)):await (0,j.p0)(String(t.entityId));x(e),o(!0)}catch(e){l.oR.error(e instanceof Error?e.message:"Failed to fetch current entity data")}finally{w(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&r()},role:"dialog","aria-modal":"true","aria-labelledby":"history-modal-title",children:(0,a.jsxs)("div",{className:"bg-orange-50 rounded-xl shadow-xl w-full max-w-4xl overflow-hidden border border-orange-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-orange-200 bg-orange-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.A,{size:22,className:"text-orange-700"}),(0,a.jsxs)("h2",{id:"history-modal-title",className:"text-xl font-bold text-orange-900",children:["Change History • ",t.entityType," #",String(t.entityId)]})]}),(0,a.jsx)("button",{type:"button",onClick:r,className:"p-2 rounded-lg hover:bg-orange-200 text-orange-700 transition-all","aria-label":"Close",title:"Close",children:(0,a.jsx)(p.A,{size:22})})]}),(0,a.jsxs)("div",{className:"p-6 bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg border ".concat(A),children:[k,(0,a.jsxs)("span",{className:"font-semibold",children:[t.action," by ",t.performedBy||"Unknown"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-orange-700",children:[(0,a.jsx)(y.A,{size:18}),(0,a.jsx)("span",{className:"font-medium",children:new Date(t.timestamp).toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"font-semibold text-orange-800 mb-3 flex items-center gap-2 text-lg",children:[(0,a.jsx)(i.A,{size:20,className:"text-orange-600"})," Previous Version Snapshot"]}),(0,a.jsx)("div",{className:"border border-orange-200 rounded-lg overflow-hidden bg-orange-50",children:(0,a.jsx)("div",{className:"overflow-auto max-h-80",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"sticky top-0 z-10",children:(0,a.jsxs)("tr",{className:"bg-orange-100 text-orange-800",children:[(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold w-1/3 min-w-[180px] border-b border-orange-200",children:"Field"}),(0,a.jsx)("th",{className:"px-5 py-3 text-left font-semibold border-b border-orange-200",children:"Value"})]})}),(0,a.jsx)("tbody",{children:0===Object.keys(N).length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:2,className:"text-center p-6 text-orange-600",children:"No previous data available"})}):Object.entries(N).map((e,t)=>{let[r,n]=e;return(0,a.jsxs)("tr",{className:"align-top ".concat(t%2==0?"bg-orange-50":"bg-orange-100/30"),children:[(0,a.jsx)("td",{className:"px-5 py-3 font-semibold text-orange-700 whitespace-nowrap border-b border-orange-200/50",children:r}),(0,a.jsx)("td",{className:"px-5 py-3 text-orange-900 border-b border-orange-200/50",children:(0,a.jsx)("pre",{className:"max-h-24 overflow-auto whitespace-pre-wrap break-words text-sm leading-6 font-medium",children:(e=>{if(null==e)return"—";if("string"==typeof e)return e;try{return JSON.stringify(e,null,2)}catch(t){return String(e)}})(n)})})]},r)})})]})})})]}),C?(0,a.jsx)("button",{type:"button",onClick:S,disabled:h,className:"w-full flex items-center justify-center gap-3 bg-orange-600 hover:bg-orange-700 disabled:opacity-60 disabled:cursor-not-allowed text-white px-5 py-3 rounded-lg font-semibold transition-all shadow-md hover:shadow-lg",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{size:18,className:"animate-spin"})," Loading current version…"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{size:18})," Compare With Current Version"]})}):"Deleted"===t.action?(0,a.jsxs)("div",{className:"w-full flex items-center justify-center gap-2 px-5 py-3 rounded-lg bg-orange-100 text-orange-700 border border-orange-200",children:[(0,a.jsx)(f.A,{size:18})," Deleted — compare unavailable"]}):null]})]})}),s&&d&&(0,a.jsx)(b,{prevData:N,currentData:d,onClose:()=>o(!1),title:"Full Field Comparison",action:t.action,timestamp:t.timestamp})]})}let N="py-[10px]",A="px-3",k="text-[13px]",C="text-[13px]",S="py-[10px]";function D(){let e,t,r=(0,s.useSearchParams)(),[m,u]=(0,n.useState)("all"),[g,p]=(0,n.useState)([]),[y,f]=(0,n.useState)([]),[b,v]=(0,n.useState)(null),[j,D]=(0,n.useState)(""),[E,I]=(0,n.useState)(null),[M,z]=(0,n.useState)(1),[T,L]=(0,n.useState)("ALL"),[F,P]=(0,n.useState)("ALL"),[U,K]=(0,n.useState)(""),R=async()=>{try{let e=await (0,h.mI)(200),t=Array.isArray(e)?e:[];p(t),z(1)}catch(e){l.oR.error(e instanceof Error?e.message:"Failed to load history"),p([]),z(1)}},V="all"===m?g:y,O=(0,n.useMemo)(()=>(V||[]).filter(e=>{if("ALL"!==T&&e.entityType!==T||"ALL"!==F&&e.action!==F)return!1;let t=U.trim().toLowerCase();return!t||[e.entityType,e.entityId,e.action,e.performedBy,e.timestamp].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(t)}),[V,T,F,U]),_=Math.max(1,Math.ceil(O.length/10)),B=(0,n.useMemo)(()=>O.reduce((e,t)=>("Created"===t.action?e.created+=1:"Updated"===t.action?e.updated+=1:"Deleted"===t.action&&(e.deleted+=1),e),{created:0,updated:0,deleted:0}),[O]),q=()=>{let e=(M-1)*10;return O.slice(e,e+10)},H=async(e,t)=>{v(e),D(t),u("entity"),z(1);try{let r=await (0,h.ae)(e,t),a=Array.isArray(r)?r:[];f(a)}catch(r){f((g||[]).filter(r=>r.entityType===e&&String(r.entityId)===t)),l.oR.error(r instanceof Error?r.message:"Failed to load entity history (showing cached data)")}},J=e=>{e>=1&&e<=_&&z(e)};return(0,n.useEffect)(()=>{R()},[]),(0,n.useEffect)(()=>{let e=r.get("type"),t=r.get("id");("Driver"===e||"Vehicle"===e)&&t&&H(e,t)},[r]),(0,a.jsxs)("div",{className:"flex min-h-screen bg-orange-50",children:[(0,a.jsx)("div",{className:"flex-1 p-4 md:p-6 overflow-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 md:p-6 min-h-full flex flex-col space-y-4",children:["all"===m?(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-orange-50 text-orange-700 border border-orange-100",children:(0,a.jsx)(d.A,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-[20px] md:text-[22px] font-bold text-gray-800",children:"Change History"}),(0,a.jsx)("p",{className:"text-[13px] text-orange-600",children:"Recent changes across Drivers & Vehicles (last 200)"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2 text-[11px]",children:[(0,a.jsxs)("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-800",children:["Created: ",B.created]}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded-full bg-yellow-100 text-yellow-800",children:["Updated: ",B.updated]}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded-full bg-red-100 text-red-800",children:["Deleted: ",B.deleted]}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded-full bg-orange-100 text-orange-800",children:["Total: ",O.length]})]})]})]})}):(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-[20px] md:text-[22px] font-bold text-gray-800",children:[b," • ",j]}),(0,a.jsx)("p",{className:"text-[13px] text-orange-600",children:"Timeline (Created / Updated / Deleted)"})]}),(0,a.jsxs)("button",{className:"inline-flex items-center gap-2 px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 text-gray-700 text-[13px]",onClick:()=>{u("all"),f([]),v(null),D(""),z(1)},children:[(0,a.jsx)(x.A,{size:16})," Back"]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-[13px] text-gray-700",children:[(0,a.jsx)("span",{className:"font-semibold text-orange-800",children:"Filters:"}),(0,a.jsxs)("select",{value:T,onChange:e=>{L(e.target.value),z(1)},className:"border border-orange-200 rounded-lg px-2 py-1 text-sm bg-white",children:[(0,a.jsx)("option",{value:"ALL",children:"All types"}),(0,a.jsx)("option",{value:"Driver",children:"Driver"}),(0,a.jsx)("option",{value:"Vehicle",children:"Vehicle"})]}),(0,a.jsxs)("select",{value:F,onChange:e=>{P(e.target.value),z(1)},className:"border border-orange-200 rounded-lg px-2 py-1 text-sm bg-white",children:[(0,a.jsx)("option",{value:"ALL",children:"All actions"}),(0,a.jsx)("option",{value:"Created",children:"Created"}),(0,a.jsx)("option",{value:"Updated",children:"Updated"}),(0,a.jsx)("option",{value:"Deleted",children:"Deleted"})]})]}),(0,a.jsx)("input",{value:U,onChange:e=>{K(e.target.value),z(1)},placeholder:"Search by id, actor, action...",className:"flex-1 min-w-[220px] border border-orange-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 bg-white"}),(0,a.jsx)("button",{type:"button",onClick:R,className:"ml-auto inline-flex items-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg bg-orange-600 text-white hover:bg-orange-700",children:"Refresh"})]}),(0,a.jsx)("div",{className:"rounded-lg border border-orange-100 flex-1",children:(0,a.jsxs)("table",{className:"w-full table-fixed",children:[(0,a.jsx)("thead",{className:"bg-orange-50 sticky top-0 z-10",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left font-semibold text-orange-800 w-10 ".concat(A," ").concat(S," ").concat(C),children:"#"}),(0,a.jsx)("th",{className:"text-left font-semibold text-orange-800 w-28 ".concat(A," ").concat(S," ").concat(C),children:"Entity Type"}),(0,a.jsx)("th",{className:"text-left font-semibold text-orange-800 w-24 ".concat(A," ").concat(S," ").concat(C),children:"Entity ID"}),(0,a.jsx)("th",{className:"text-left font-semibold text-orange-800 w-28 ".concat(A," ").concat(S," ").concat(C),children:"Action"}),(0,a.jsx)("th",{className:"text-left font-semibold text-orange-800 w-44 ".concat(A," ").concat(S," ").concat(C),children:"Performed By"}),(0,a.jsx)("th",{className:"text-left font-semibold text-orange-800 w-48 ".concat(A," ").concat(S," ").concat(C),children:"Timestamp"}),(0,a.jsx)("th",{className:"text-right font-semibold text-orange-800 w-20 ".concat(A," ").concat(S," ").concat(C),children:"Details"})]})}),q().length?(e=q(),t="all"===m,(0,a.jsx)("tbody",{className:"divide-y divide-orange-100",children:e.map((e,r)=>(0,a.jsxs)("tr",{className:"".concat(t?"cursor-pointer hover:bg-orange-50":"hover:bg-orange-50"),onClick:()=>t?void H("Driver"===e.entityType?"Driver":"Vehicle",String(e.entityId)):void 0,children:[(0,a.jsx)("td",{className:"".concat(A," ").concat(N," ").concat(k),children:(M-1)*10+r+1}),(0,a.jsx)("td",{className:"".concat(A," ").concat(N," ").concat(k),children:e.entityType}),(0,a.jsx)("td",{className:"".concat(A," ").concat(N," ").concat(k," w-24 truncate"),children:String(e.entityId)}),(0,a.jsx)("td",{className:"".concat(A," ").concat(N," ").concat(k," w-28"),children:(0,a.jsx)("span",{className:"px-2 py-1 rounded ".concat((e=>{switch(e){case"Deleted":return"bg-red-100 text-red-800";case"Updated":return"bg-yellow-100 text-yellow-800";case"Created":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}})(e.action)),children:e.action})}),(0,a.jsx)("td",{className:"".concat(A," ").concat(N," ").concat(k," w-44 truncate"),children:e.performedBy||"Unknown"}),(0,a.jsx)("td",{className:"".concat(A," ").concat(N," ").concat(k," w-48 truncate"),children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)("td",{className:"".concat(A," ").concat(N," text-right w-20"),children:(0,a.jsxs)("button",{className:"inline-flex items-center gap-1 text-orange-600 hover:bg-orange-100 px-2 py-1 rounded text-[12px]",onClick:t=>{t.stopPropagation(),I(e)},children:[(0,a.jsx)(c.A,{size:14})," View"]})})]},String(e.id)))})):(0,a.jsx)("tbody",{children:(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-4 py-12 text-center text-gray-500",colSpan:7,children:"all"===m?"No history records found.":"No history found for this entity."})})})]})}),(()=>{if(_<=1)return null;let e=[],t=Math.max(1,M-Math.floor(2.5)),r=Math.min(_,t+5-1);for(let a=t;a<=r;a++)e.push(a);return(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 px-4 py-3 bg-orange-50 rounded-lg border border-orange-100",children:[(0,a.jsxs)("div",{className:"text-[13px] text-orange-800",children:["Showing ",(M-1)*10+1,"–",Math.min(10*M,O.length)," of ",O.length," records"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>J(M-1),disabled:1===M,className:"p-2 rounded-md ".concat(1===M?"text-gray-400 cursor-not-allowed":"text-orange-600 hover:bg-orange-100"),children:(0,a.jsx)(o.A,{size:16})}),e.map(e=>(0,a.jsx)("button",{onClick:()=>J(e),className:"px-3 py-1 rounded-md text-[13px] ".concat(M===e?"bg-orange-600 text-white":"text-orange-600 hover:bg-orange-100"),children:e},e)),(0,a.jsx)("button",{onClick:()=>J(M+1),disabled:M===_,className:"p-2 rounded-md ".concat(M===_?"text-gray-400 cursor-not-allowed":"text-orange-600 hover:bg-orange-100"),children:(0,a.jsx)(i.A,{size:16})})]})]})})()]})]})}),E&&(0,a.jsx)(w,{item:E,onClose:()=>I(null)})]})}},54485:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71360:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,I:()=>c});var a=r(95125),n=r(95704);let s=(n.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),l=Math.min(Number(n.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),o=a.A.create({baseURL:s?"".concat(s,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:l}),i=o;function c(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}o.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let n=localStorage.getItem("role")||void 0;n&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=n)}return e}),o.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,n,s,l;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(s=null==(a=e.response)?void 0:a.status)?s:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(n=e.response)?void 0:n.headers)?l:{},config:e.config,request:e.request})}return Promise.reject(e)})},89559:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},90368:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},93402:(e,t,r)=>{"use strict";r.d(t,{mI:()=>s,ae:()=>l});var a=r(81242);let n=e=>{var t,r,a;return{id:e.id,entityType:"Vehicle"===e.entityType||"Driver"===e.entityType?e.entityType:"Vehicle",entityId:e.entityId,action:"Created"===e.action||"Updated"===e.action||"Deleted"===e.action?e.action:"Updated",previousData:null!=(t=e.previousJson)?t:null,newData:null!=(r=e.newJson)?r:null,performedBy:null!=(a=e.performedBy)?a:null,timestamp:e.timestamp}};async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,{data:t}=await a.A.get("/history/recent",{params:{size:e}});return(0,a.I)(t).map(n)}async function l(e,t){let{data:r}=await a.A.get("/history/".concat(e,"/").concat(t));return(0,a.I)(r).map(n)}},99171:(e,t,r)=>{Promise.resolve().then(r.bind(r,44876))}},e=>{e.O(0,[5125,970,8441,1255,7358],()=>e(e.s=99171)),_N_E=e.O()}]);