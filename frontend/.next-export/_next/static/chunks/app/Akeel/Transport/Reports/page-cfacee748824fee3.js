(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9969],{11924:(e,t,s)=>{"use strict";s.d(t,{Cd:()=>p,Lh:()=>d,bB:()=>r,bk:()=>o,cK:()=>n,iq:()=>c,iv:()=>i,kM:()=>u,lm:()=>l,qd:()=>g,rg:()=>h,rr:()=>x,uK:()=>m});var a=s(81242);async function r(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:r}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:s}});return(0,a.I)(r)}async function n(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(s){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function i(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function c(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),o=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),x=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),h=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function m(e,t){let s={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:r}=await a.A.post("/usage-requests/".concat(e,"/assign"),s);return(0,a.I)(r)}async function u(e,t){let s={};"number"==typeof t.exitOdometer&&(s.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==s.exitOdometer&&(s.exitOdometer=t.odometerStartKm);let r=[];t.remarks&&r.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&r.push(...t.exitManifest),r.length&&(s.exitManifest=r);let{data:l}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),s);return(0,a.I)(l)}async function p(e,t){let s={};"number"==typeof t.entryOdometer&&(s.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==s.entryOdometer&&(s.entryOdometer=t.odometerEndKm);let r=[];t.remarks&&r.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&r.push(...t.entryManifest),r.length&&(s.entryManifest=r);let{data:l}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),s);return(0,a.I)(l)}async function g(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},20308:(e,t,s)=>{Promise.resolve().then(s.bind(s,56450))},56450:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var a=s(95155),r=s(12115),l=s(46398),n=s(91811),i=s(87066),c=s(80534),d=s(71847);let o=(0,d.A)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),x=(0,d.A)("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);var h=s(89559),m=s(4259),u=s(2989),p=s(11924),g=s(30409);let y=["PENDING_HOD","PENDING_MANAGEMENT","APPROVED","SCHEDULED","DISPATCHED","RETURNED","REJECTED"],j=e=>e?new Date(e).toLocaleDateString():"—",N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||Number.isNaN(e)?"—":Number(e).toLocaleString(void 0,{maximumFractionDigits:t,minimumFractionDigits:t})},f=e=>null==e||Number.isNaN(e)?"—":e.toLocaleString(void 0,{style:"currency",currency:"LKR",maximumFractionDigits:0}),b=e=>{let{active:t,label:s,icon:r,onClick:l}=e;return(0,a.jsxs)("button",{type:"button",onClick:l,className:"flex items-center gap-2 px-4 py-2 rounded-full border transition-colors ".concat(t?"bg-orange-600 text-white border-orange-600 shadow-sm":"bg-white text-orange-800 border-orange-200 hover:bg-orange-50"),children:[r,(0,a.jsx)("span",{className:"text-sm font-semibold",children:s})]})};function v(){let{user:e}=(0,m.A)(),[t,s]=r.useState("vehicles"),[d,v]=r.useState("summary"),[k,M]=r.useState(!1),[S,D]=r.useState([]),[C,q]=r.useState([]),[E,I]=r.useState([]),[O,T]=r.useState(null),R=r.useCallback(async()=>{M(!0),T(null);try{if("vehicles"===t){let e=await (0,u.WR)();D(Array.isArray(e)?e:[])}else if("usage"===t){let e=await (0,p.cK)();q(Array.isArray(e)?e:[])}else if("fuel"===t){let e=await (0,g.c)({});I(Array.isArray(e)?e:[])}}catch(e){T(e instanceof Error?e.message:"Failed to load data")}finally{M(!1)}},[t]);r.useEffect(()=>{R()},[R]);let K=r.useMemo(()=>{let e=S.reduce((e,t)=>{let s=(t.fuelType||"UNKNOWN").toUpperCase();return e[s]=(e[s]||0)+1,e},{}),t=S.reduce((e,t)=>{let s=(t.status||"AVAILABLE").toUpperCase();return e[s]=(e[s]||0)+1,e},{});return{total:S.length,byFuel:e,byStatus:t}},[S]),L=r.useMemo(()=>{let e=C.reduce((e,t)=>{let s=(t.status||"PENDING_HOD").toUpperCase();return e[s]=(e[s]||0)+1,e},{}),t=C.filter(e=>e.assignedVehicleNumber).length;return{total:C.length,byStatus:e,assigned:t}},[C]),F=r.useMemo(()=>E.reduce((e,t)=>(e.km+=t.deltaKm||0,e.litres+=t.litres||0,e.cost+=t.cost||0,e),{km:0,litres:0,cost:0}),[E]);return(0,a.jsx)("div",{className:"min-h-screen bg-orange-50",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-4 sm:p-6 space-y-4",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-orange-700",children:"Transport"}),(0,a.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"text-orange-600"})," Reports"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Choose a report, then switch between summary and raw table views."}),e&&(0,a.jsxs)("p",{className:"text-[11px] text-gray-500 mt-1",children:["Signed in as ",e.username||e.id]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(b,{active:"vehicles"===t,label:"Vehicles",icon:(0,a.jsx)(l.A,{size:16}),onClick:()=>s("vehicles")}),(0,a.jsx)(b,{active:"usage"===t,label:"Usage Requests",icon:(0,a.jsx)(i.A,{size:16}),onClick:()=>s("usage")}),(0,a.jsx)(b,{active:"fuel"===t,label:"Fuel",icon:(0,a.jsx)(n.A,{size:16}),onClick:()=>s("fuel")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>v("summary"),className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold border ".concat("summary"===d?"bg-orange-600 text-white border-orange-600":"bg-white text-orange-800 border-orange-200"),children:[(0,a.jsx)(o,{size:16})," Summary"]}),(0,a.jsxs)("button",{type:"button",onClick:()=>v("table"),className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold border ".concat("table"===d?"bg-orange-600 text-white border-orange-600":"bg-white text-orange-800 border-orange-200"),children:[(0,a.jsx)(x,{size:16})," Raw Table"]}),(0,a.jsxs)("button",{type:"button",onClick:R,className:"ml-auto inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold border border-orange-300 text-orange-800 bg-white hover:bg-orange-50",children:[(0,a.jsx)(h.A,{size:16,className:k?"animate-spin":""})," ",k?"Refreshing":"Refresh"]})]}),O&&(0,a.jsx)("div",{className:"px-4 py-3 rounded-lg border border-red-200 bg-red-50 text-red-700 text-sm",children:O}),"summary"===d?"vehicles"===t?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(A,{title:"Total Vehicles",value:K.total,icon:(0,a.jsx)(l.A,{className:"text-orange-600"})}),(0,a.jsx)(A,{title:"By Fuel",value:Object.entries(K.byFuel).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s)}).join(" • ")||"—",icon:(0,a.jsx)(n.A,{className:"text-orange-600"})}),(0,a.jsx)(A,{title:"By Status",value:Object.entries(K.byStatus).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s)}).join(" • ")||"—",icon:(0,a.jsx)(i.A,{className:"text-orange-600"})})]}):"usage"===t?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(A,{title:"Requests",value:L.total,icon:(0,a.jsx)(c.A,{className:"text-orange-600"})}),(0,a.jsx)(A,{title:"Assigned",value:L.assigned,icon:(0,a.jsx)(l.A,{className:"text-orange-600"})}),(0,a.jsx)(A,{title:"By Status",value:y.map(e=>"".concat(e,": ").concat(L.byStatus[e]||0)).join(" • "),icon:(0,a.jsx)(i.A,{className:"text-orange-600"})})]}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(A,{title:"Distance (km)",value:N(F.km,0),icon:(0,a.jsx)(w,{})}),(0,a.jsx)(A,{title:"Litres",value:N(F.litres,1),icon:(0,a.jsx)(n.A,{className:"text-orange-600"})}),(0,a.jsx)(A,{title:"Cost",value:f(F.cost),icon:(0,a.jsx)(i.A,{className:"text-orange-600"})})]}):"vehicles"===t?(0,a.jsx)("div",{className:"overflow-x-auto rounded-xl border border-orange-100",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-orange-50 text-orange-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Number"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Type"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Fuel"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Status"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Odometer"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[S.map(e=>{var t,s;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-3 py-2 font-semibold text-orange-900",children:e.vehicleNumber}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.vehicleType||"—"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.fuelType||"—"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.status||"—"}),(0,a.jsx)("td",{className:"px-3 py-2",children:N(null!=(s=null!=(t=e.totalKmDriven)?t:e.registeredKm)?s:null,0)})]},e.id)}),!S.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-3 py-4 text-center text-gray-500",colSpan:5,children:"No vehicles found."})})]})]})}):"usage"===t?(0,a.jsx)("div",{className:"overflow-x-auto rounded-xl border border-orange-100",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-orange-50 text-orange-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Code"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Applicant"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Department"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Travel"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Status"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Assigned Vehicle"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[C.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-3 py-2 font-semibold text-orange-900",children:e.requestCode}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[(0,a.jsx)("div",{className:"font-semibold",children:e.applicantName}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.employeeId})]}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.department}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[(0,a.jsx)("div",{children:j(e.dateOfTravel)}),e.timeFrom&&e.timeTo&&(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[e.timeFrom," → ",e.timeTo]})]}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.status}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.assignedVehicleNumber||"—"})]},e.id)),!C.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-3 py-4 text-center text-gray-500",colSpan:6,children:"No requests found."})})]})]})}):(0,a.jsx)("div",{className:"overflow-x-auto rounded-xl border border-orange-100",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-orange-50 text-orange-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Vehicle"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Date"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Km"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Litres"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Cost"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Fuel"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[E.map(e=>{var t,s;return(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-3 py-2 font-semibold text-orange-900",children:[e.vehicleNumber||(null==(t=e.vehicle)?void 0:t.vehicleNumber)||"—",(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.vehicleType||(null==(s=e.vehicle)?void 0:s.vehicleType)||"—"})]}),(0,a.jsx)("td",{className:"px-3 py-2",children:j(e.logDate||e.createdAt||null)}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[N(e.deltaKm,0)," km"]}),(0,a.jsxs)("td",{className:"px-3 py-2",children:[N(e.litres,2)," L"]}),(0,a.jsx)("td",{className:"px-3 py-2",children:f(e.cost)}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.fuelType||"—"})]},e.id)}),!E.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-3 py-4 text-center text-gray-500",colSpan:6,children:"No fuel logs found."})})]})]})})]})})}function A(e){let{title:t,value:s,icon:r}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-orange-200 p-5 shadow-sm flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-orange-50 text-orange-700",children:r}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:t}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:s})]})]})}let w=()=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-orange-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M12 12l3-9"}),(0,a.jsx)("path",{d:"M21 12.8A9 9 0 0 0 3 12.8"}),(0,a.jsx)("path",{d:"M5 12h2"}),(0,a.jsx)("path",{d:"M17 12h2"}),(0,a.jsx)("path",{d:"M10 12h4"})]})},80534:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},87066:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]])},89559:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[5125,6356,8441,1255,7358],()=>e(e.s=20308)),_N_E=e.O()}]);