(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3448],{11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>x,Lh:()=>l,bB:()=>a,bk:()=>d,cK:()=>i,iq:()=>c,iv:()=>o,kM:()=>g,lm:()=>n,qd:()=>p,rg:()=>h,rr:()=>u,uK:()=>m});var s=r(81242);async function a(e){let{data:t}=await s.A.post("/usage-requests",e);return(0,s.I)(t)}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:a}=await s.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,s.I)(a)}async function i(){try{let{data:e}=await s.A.get("/usage-requests/all");return(0,s.I)(e)}catch(r){let{data:e}=await s.A.get("/usage-requests"),t=(0,s.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function o(e){try{let{data:t}=await s.A.get("/usage-requests/status/".concat(e));return(0,s.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function c(e){let{data:t}=await s.A.get("/usage-requests/".concat(e));return(0,s.I)(t)}let l=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),d=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),h=async(e,t)=>(0,s.I)((await s.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function m(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:a}=await s.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,s.I)(a)}async function g(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let a=[];t.remarks&&a.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&a.push(...t.exitManifest),a.length&&(r.exitManifest=a);let{data:n}=await s.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,s.I)(n)}async function x(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let a=[];t.remarks&&a.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&a.push(...t.entryManifest),a.length&&(r.entryManifest=a);let{data:n}=await s.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,s.I)(n)}async function p(){let{data:e}=await s.A.get("/usage-requests/metrics");return(0,s.I)(e)}},50628:(e,t,r)=>{Promise.resolve().then(r.bind(r,73951))},73951:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(95155),a=r(12115),n=r(12008),i=r(78827),o=r(7640),c=r(11924),l=r(6257);let d=e=>e?new Date(e).toLocaleString():"-";function u(){let[e,t]=(0,a.useState)([]),[r,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(!0),g=async()=>{m(!0);try{let e=await (0,c.iv)("SCHEDULED");t(e||[])}catch(e){n.oR.error(e instanceof Error?e.message:"Failed to load scheduled for dispatch"),t([])}finally{m(!1)}};(0,a.useEffect)(()=>{g()},[]);let x=(0,a.useMemo)(()=>{let t=r.trim().toLowerCase();return t?e.filter(e=>[e.requestCode,e.assignedVehicleNumber,e.assignedDriverName,e.fromLocation,e.toLocation].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(t)):e},[e,r]);return(0,s.jsx)("div",{className:"min-h-screen bg-orange-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-orange-200 p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Dispatch (Hand-over to Gate)"}),(0,s.jsx)("p",{className:"text-sm text-orange-700",children:"Trips scheduled and ready for Gate to mark EXIT."})]}),(0,s.jsx)("button",{className:"px-3 py-2 rounded bg-orange-600 text-white",onClick:g,children:h?"Loading…":"Refresh"})]}),(0,s.jsx)(i.A,{value:r,onChange:u,placeholder:"Search code, vehicle, driver, route…"}),(0,s.jsx)("div",{className:"mt-3 overflow-x-auto rounded-lg border border-orange-100",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-orange-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)(o.Th,{children:"Code"}),(0,s.jsx)(o.Th,{children:"Vehicle"}),(0,s.jsx)(o.Th,{children:"Driver"}),(0,s.jsx)(o.Th,{children:"Pickup"}),(0,s.jsx)(o.Th,{children:"Return"}),(0,s.jsx)(o.Th,{className:"text-center",children:"Action"})]})}),(0,s.jsxs)("tbody",{className:"divide-y",children:[x.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)(o.Td,{className:"font-semibold",children:e.requestCode}),(0,s.jsx)(o.Td,{children:e.assignedVehicleNumber||"-"}),(0,s.jsx)(o.Td,{children:e.assignedDriverName||"-"}),(0,s.jsx)(o.Td,{children:d(e.scheduledPickupAt)}),(0,s.jsx)(o.Td,{children:d(e.scheduledReturnAt)}),(0,s.jsx)(o.Td,{className:"text-center",children:(0,s.jsx)("button",{className:"px-3 py-1 rounded bg-green-600 text-white",onClick:()=>(0,l.du)(e),children:"Print Slip"})})]},e.id)),!x.length&&(0,s.jsx)("tr",{children:(0,s.jsx)(o.Td,{colSpan:6,className:"text-center text-gray-500 py-6",children:h?"Loading…":"Nothing pending dispatch"})})]})]})})]})})}},78827:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(95155);r(12115);var a=r(86651),n=r(65229);function i(e){let{value:t,onChange:r,placeholder:i="Search…",className:o=""}=e;return(0,s.jsxs)("div",{className:"relative ".concat(o),children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(a.A,{size:18,className:"text-orange-500"})}),(0,s.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:i,autoComplete:"off",className:"w-full border border-orange-200 rounded-xl px-10 py-3 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 text-sm bg-white placeholder-orange-400/70 text-orange-900 font-medium transition-all duration-200 shadow-sm hover:shadow-md"}),t&&(0,s.jsx)("button",{onClick:()=>r(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:bg-orange-100 rounded-r-xl transition-colors","aria-label":"Clear search",children:(0,s.jsx)(n.A,{size:18,className:"text-orange-500 hover:text-orange-700"})})]})}}},e=>{e.O(0,[5125,970,6737,8441,1255,7358],()=>e(e.s=50628)),_N_E=e.O()}]);