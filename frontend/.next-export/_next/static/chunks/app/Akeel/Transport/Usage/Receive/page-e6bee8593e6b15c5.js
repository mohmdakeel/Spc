(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6563],{7640:(e,t,r)=>{"use strict";r.d(t,{Td:()=>n,Th:()=>s});var a=r(95155);function s(e){let{children:t,className:r="",sortable:s,sortDirection:n,onClick:o,...i}=e;return(0,a.jsx)("th",{...i,"aria-sort":"asc"===n?"ascending":"desc"===n?"descending":"none",onClick:s?o:void 0,onKeyDown:s?e=>{s&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==o||o())}:void 0,tabIndex:s?0:void 0,className:["px-2 py-2 md:px-3 md:py-2.5 text-left font-semibold text-orange-900 whitespace-normal align-middle leading-snug bg-orange-100 border-b-2 border-orange-200",s?"cursor-pointer hover:bg-orange-200 transition-colors":"",n?"bg-orange-200":"",r].join(" "),children:(0,a.jsxs)("div",{className:"flex items-center gap-2 select-none",children:[t,s&&(0,a.jsx)("span",{"aria-hidden":"true",className:"text-orange-600",children:"asc"===n?"↑":"desc"===n?"↓":"↕"})]})})}function n(e){let{children:t,className:r="",highlight:s,...n}=e;return(0,a.jsx)("td",{...n,className:["px-2 py-2 md:px-3 md:py-2.5 align-top border-b border-orange-100 transition-colors duration-150 whitespace-normal break-words leading-snug text-orange-800",s?"bg-orange-50 font-medium":"",r].join(" "),children:t})}r(12115)},11924:(e,t,r)=>{"use strict";r.d(t,{Cd:()=>p,Lh:()=>c,bB:()=>s,bk:()=>d,cK:()=>o,iq:()=>l,iv:()=>i,kM:()=>h,lm:()=>n,qd:()=>x,rg:()=>m,rr:()=>u,uK:()=>g});var a=r(81242);async function s(e){let{data:t}=await a.A.post("/usage-requests",e);return(0,a.I)(t)}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,{data:s}=await a.A.get("/usage-requests/my",{params:{employeeId:e,page:t,size:r}});return(0,a.I)(s)}async function o(){try{let{data:e}=await a.A.get("/usage-requests/all");return(0,a.I)(e)}catch(r){let{data:e}=await a.A.get("/usage-requests"),t=(0,a.I)(e);if(Array.isArray(t))return t;if((null==t?void 0:t.content)&&Array.isArray(t.content))return t.content;return t}}async function i(e){try{let{data:t}=await a.A.get("/usage-requests/status/".concat(e));return(0,a.I)(t)}catch(t){return console.warn("Failed to load usage requests by status",e,t),[]}}async function l(e){let{data:t}=await a.A.get("/usage-requests/".concat(e));return(0,a.I)(t)}let c=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/approve"),{remarks:t})).data),d=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/hod/reject"),{remarks:t})).data),u=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/approve"),{remarks:t})).data),m=async(e,t)=>(0,a.I)((await a.A.post("/usage-requests/".concat(e,"/mgmt/reject"),{remarks:t})).data);async function g(e,t){let r={...t,pickupAt:t.pickupAt instanceof Date?t.pickupAt.toISOString():t.pickupAt,expectedReturnAt:t.expectedReturnAt instanceof Date?t.expectedReturnAt.toISOString():t.expectedReturnAt},{data:s}=await a.A.post("/usage-requests/".concat(e,"/assign"),r);return(0,a.I)(s)}async function h(e,t){let r={};"number"==typeof t.exitOdometer&&(r.exitOdometer=t.exitOdometer),"number"==typeof t.odometerStartKm&&null==r.exitOdometer&&(r.exitOdometer=t.odometerStartKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.exitManifest)&&t.exitManifest.length&&s.push(...t.exitManifest),s.length&&(r.exitManifest=s);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/exit"),r);return(0,a.I)(n)}async function p(e,t){let r={};"number"==typeof t.entryOdometer&&(r.entryOdometer=t.entryOdometer),"number"==typeof t.odometerEndKm&&null==r.entryOdometer&&(r.entryOdometer=t.odometerEndKm);let s=[];t.remarks&&s.push({type:"note",value:String(t.remarks)}),Array.isArray(t.entryManifest)&&t.entryManifest.length&&s.push(...t.entryManifest),s.length&&(r.entryManifest=s);let{data:n}=await a.A.post("/usage-requests/".concat(e,"/gate/entry"),r);return(0,a.I)(n)}async function x(){let{data:e}=await a.A.get("/usage-requests/metrics");return(0,a.I)(e)}},17738:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(95155),s=r(12115),n=r(12008),o=r(78827),i=r(7640),l=r(11924);function c(){let[e,t]=(0,s.useState)([]),[r,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(!0),m=async()=>{u(!0);try{let e=await (0,l.iv)("DISPATCHED");t(e||[])}catch(e){n.oR.error(e instanceof Error?e.message:"Failed to load dispatched trips"),t([])}finally{u(!1)}};(0,s.useEffect)(()=>{m()},[]);let g=(0,s.useMemo)(()=>{let t=r.trim().toLowerCase();return t?e.filter(e=>[e.requestCode,e.assignedVehicleNumber,e.assignedDriverName,e.fromLocation,e.toLocation].map(e=>(null!=e?e:"").toString().toLowerCase()).join(" ").includes(t)):e},[e,r]);return(0,a.jsx)("div",{className:"min-h-screen bg-orange-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-orange-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Receive (On Trip)"}),(0,a.jsx)("p",{className:"text-sm text-orange-700",children:"Trips currently dispatched. Gate will mark Entry on return."})]}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-orange-600 text-white",onClick:m,children:d?"Loading…":"Refresh"})]}),(0,a.jsx)(o.A,{value:r,onChange:c,placeholder:"Search code, vehicle, driver, route…"}),(0,a.jsx)("div",{className:"mt-3 overflow-x-auto rounded-lg border border-orange-100",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-orange-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)(i.Th,{children:"Code"}),(0,a.jsx)(i.Th,{children:"Vehicle"}),(0,a.jsx)(i.Th,{children:"Driver"}),(0,a.jsx)(i.Th,{children:"Exit Time"}),(0,a.jsx)(i.Th,{children:"Exit Odometer"})]})}),(0,a.jsxs)("tbody",{className:"divide-y",children:[g.map(e=>{var t;let r;return(0,a.jsxs)("tr",{children:[(0,a.jsx)(i.Td,{className:"font-semibold",children:e.requestCode}),(0,a.jsx)(i.Td,{children:e.assignedVehicleNumber||"-"}),(0,a.jsx)(i.Td,{children:e.assignedDriverName||"-"}),(0,a.jsx)(i.Td,{children:(r=e.gateExitAt)?new Date(r).toLocaleString():"-"}),(0,a.jsx)(i.Td,{children:null!=(t=e.exitOdometer)?t:"-"})]},e.id)}),!g.length&&(0,a.jsx)("tr",{children:(0,a.jsx)(i.Td,{colSpan:5,className:"text-center text-gray-500 py-6",children:d?"Loading…":"No vehicles currently on trip"})})]})]})})]})})}},65229:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},78827:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(95155);r(12115);var s=r(86651),n=r(65229);function o(e){let{value:t,onChange:r,placeholder:o="Search…",className:i=""}=e;return(0,a.jsxs)("div",{className:"relative ".concat(i),children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(s.A,{size:18,className:"text-orange-500"})}),(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:o,autoComplete:"off",className:"w-full border border-orange-200 rounded-xl px-10 py-3 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 text-sm bg-white placeholder-orange-400/70 text-orange-900 font-medium transition-all duration-200 shadow-sm hover:shadow-md"}),t&&(0,a.jsx)("button",{onClick:()=>r(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:bg-orange-100 rounded-r-xl transition-colors","aria-label":"Clear search",children:(0,a.jsx)(n.A,{size:18,className:"text-orange-500 hover:text-orange-700"})})]})}},80001:(e,t,r)=>{Promise.resolve().then(r.bind(r,17738))},81242:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,I:()=>c});var a=r(95125),s=r(95704);let n=(s.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),o=Math.min(Number(s.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),i=a.A.create({baseURL:n?"".concat(n,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:o}),l=i;function c(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}i.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let s=localStorage.getItem("role")||void 0;s&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=s)}return e}),i.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,s,n,o;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(n=null==(a=e.response)?void 0:a.status)?n:0,statusText:"Request Timeout",data:null,headers:null!=(o=null==(s=e.response)?void 0:s.headers)?o:{},config:e.config,request:e.request})}return Promise.reject(e)})},86651:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(71847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])}},e=>{e.O(0,[5125,970,8441,1255,7358],()=>e(e.s=80001)),_N_E=e.O()}]);