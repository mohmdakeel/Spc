"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3566],{4259:(e,t,r)=>{r.d(t,{A:()=>c});var s=r(12115),l=r(68209),n=r(20063);let a=["/login","/_error","/403"],i="auth:user-cache",o=()=>{try{let e=window.sessionStorage.getItem(i);if(!e)return null;let t=JSON.parse(e);if(!(null==t?void 0:t.user)||!(null==t?void 0:t.ts)||Date.now()-t.ts>3e5)return null;return t.user}catch(e){return null}},u=e=>{try{e?window.sessionStorage.setItem(i,JSON.stringify({user:e,ts:Date.now()})):window.sessionStorage.removeItem(i)}catch(e){}},c=()=>{let e=o(),[t,r]=(0,s.useState)(e),[i,c]=(0,s.useState)(!e),[d,h]=(0,s.useState)(null),m=(0,n.useRouter)(),f=(0,n.usePathname)(),g=(0,s.useRef)(!1),p=e=>{g.current&&(r(e),u(e))};(0,s.useEffect)(()=>{g.current=!0;let e=!1,t=a.some(e=>null==f?void 0:f.startsWith(e)),r=()=>{null!=f&&f.startsWith("/login")||m.replace("/login")};return t?(c(!1),h(null),()=>{g.current=!1,e=!0}):((async()=>{h(null);let t=o();t&&p(t);let s=!t;s&&c(!0);try{let t=await (0,l.me)();if(e||!g.current)return;if(!t){p(null),h(null),u(null),(0,l.bC)(),r();return}p(t),h(null),(0,l.bC)()}catch(t){var n,a;if(console.error("Auth check failed:",t),e||!g.current)return;h((null==t||null==(a=t.response)||null==(n=a.data)?void 0:n.message)||(null==t?void 0:t.message)||"Authentication failed"),p(null),u(null),(0,l.bC)(),r()}finally{!e&&g.current&&s&&c(!1)}})(),()=>{e=!0,g.current=!1})},[f,m]);let v=async()=>{if(!g.current)return null;c(!0),h(null);try{let e=await (0,l.me)();if(!g.current)return null;if(!e)return p(null),h("Session expired. Please sign in again."),(0,l.bC)(),(null==f?void 0:f.startsWith("/login"))||m.replace("/login"),null;return(0,l.bC)(),p(e),h(null),e}catch(r){var e,t;throw h((null==(t=r.response)||null==(e=t.data)?void 0:e.message)||"Failed to refresh user data"),r}finally{c(!1)}};return(0,s.useEffect)(()=>{(null==t?void 0:t.username)?window.localStorage.setItem("username",t.username):window.localStorage.removeItem("username")},[null==t?void 0:t.username]),{user:t,setUser:p,loading:i,error:d,refresh:v,hasRole:e=>{if(!(null==t?void 0:t.roles))return!1;let r=Array.isArray(e)?e:[e],s=t.roles.map(e=>e.toUpperCase());return r.some(e=>s.includes(e.toUpperCase()))},can:e=>{if(!(null==t?void 0:t.permissions))return!1;let r=Array.isArray(e)?e:[e];return t.permissions.some(e=>r.includes(e))},hasAnyRole:()=>!!((null==t?void 0:t.roles)&&t.roles.length>0)}}},16174:(e,t,r)=>{r.d(t,{D:()=>o,ThemeProvider:()=>i});var s=r(95155),l=r(12115);let n=(0,l.createContext)(void 0),a="workspace-theme";function i(e){let{children:t}=e,[r,i]=(0,l.useState)(()=>localStorage.getItem(a)||"light");(0,l.useEffect)(()=>{i(localStorage.getItem(a)||"light")},[]),(0,l.useEffect)(()=>{"undefined"!=typeof document&&document.documentElement.classList.toggle("hod-dark","dark"===r)},[r]);let o=e=>{i(e),localStorage.setItem(a,e)},u=(0,l.useMemo)(()=>({theme:r,setTheme:o,toggleTheme:()=>o("dark"===r?"light":"dark")}),[r]);return(0,s.jsx)(n.Provider,{value:u,children:t})}function o(){let e=(0,l.useContext)(n);if(!e)throw Error("useTheme must be used within ThemeProvider");return e}},37621:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(95125),l=r(95704);let n=(l.env.NEXT_PUBLIC_AUTH_BASE||"").replace(/\/$/,""),a=Math.min(Number(l.env.NEXT_PUBLIC_API_TIMEOUT)||1e4,15e3),i=s.A.create({baseURL:n?"".concat(n,"/api"):"/aapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:a});i.interceptors.request.use(e=>e,e=>Promise.reject(e)),i.interceptors.response.use(e=>{let t=e.data;if((e=>!!(e&&"object"==typeof e&&"ok"in e))(t)){if(t.ok){var r;return e.data=Object.prototype.hasOwnProperty.call(t,"data")&&null!=(r=t.data)?r:null,e}let s=Error(t.message||"Request failed");return s.response={status:e.status,data:t},Promise.reject(s)}return e},e=>{var t,r,s,l,n;let a=null==(t=e.response)?void 0:t.status,i=e.code,o=((null==e?void 0:e.message)||"").toLowerCase();return 401===a?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.resolve({status:null!=a?a:0,statusText:"Unauthorized",data:null,headers:null!=(s=null==(r=e.response)?void 0:r.headers)?s:{},config:e.config,request:e.request})):403===a?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(e)):"ECONNABORTED"===i||o.includes("timeout")?(console.warn("API timeout – returning empty response to keep UI responsive"),Promise.resolve({status:null!=a?a:0,statusText:"Request Timeout",data:null,headers:null!=(n=null==(l=e.response)?void 0:l.headers)?n:{},config:e.config,request:e.request})):Promise.reject(e)});let o=i},43566:(e,t,r)=>{r.d(t,{A:()=>g});var s=r(95155);r(12115);var l=r(52619),n=r.n(l),a=r(19408),i=r(59427),o=r(37494),u=r(85998),c=r(15870),d=r(40448),h=r(20063),m=r(4259),f=r(16174);function g(e){var t,r,l,g;let{user:p,appName:v="SPC Authservice",workspace:w="Administration Workspace",profileTag:x="Auth Admin",profileHref:y="/profile",settingsHref:b="/settings",notificationHref:A,notificationCount:N,notificationLoading:j,actions:S}=e,k=(0,h.useRouter)(),{theme:C,toggleTheme:I}=(0,f.D)(),{user:E}=(0,m.A)(),P=null!=(g=null!=p?p:E)?g:null,T=(null==P||null==(t=P.fullName)?void 0:t.trim())||(null==P||null==(r=P.name)?void 0:r.trim())||(null==P||null==(l=P.username)?void 0:l.trim())||"User",U=(null==P?void 0:P.username)?"@".concat(P.username):"";return(0,s.jsx)("header",{className:"hod-app-bar bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-md border-b border-orange-400",children:(0,s.jsxs)("div",{className:"mx-auto w-full px-4 sm:px-6 lg:px-8 py-3 flex items-center gap-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-3 flex-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,s.jsx)(a.A,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-orange-100 font-semibold",children:v}),(0,s.jsx)("h1",{className:"text-lg md:text-xl font-bold leading-tight",children:w})]})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{type:"button","aria-label":"dark"===C?"Switch to light mode":"Switch to dark mode",onClick:I,className:"p-2 rounded-full hover:bg-white/20 transition",children:"dark"===C?(0,s.jsx)(i.A,{size:18}):(0,s.jsx)(o.A,{size:18})}),(0,s.jsxs)("button",{type:"button","aria-label":"Notifications",className:"p-2 rounded-full hover:bg-white/20 transition relative",onClick:()=>A&&k.push(A),children:[(0,s.jsx)(u.A,{size:18}),"number"==typeof N?(0,s.jsx)("span",{className:"absolute -top-1 -right-1 bg-white text-orange-600 text-[10px] font-semibold rounded-full px-1.5 py-0.5 border border-orange-200",children:j?"…":N}):null]}),b?(0,s.jsx)("button",{onClick:()=>k.push(b),className:"p-2 rounded-full hover:bg-white/20 transition","aria-label":"Settings",children:(0,s.jsx)(c.A,{size:18})}):null,S?(0,s.jsx)("div",{className:"hidden sm:flex items-center gap-2",children:S}):null,(0,s.jsxs)(n(),{href:y,className:"flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-full border border-white/20 hover:bg-white/20 transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white",children:[(0,s.jsx)("span",{className:"relative inline-flex items-center justify-center w-10 h-10 rounded-full border border-white/40 bg-white/10 overflow-hidden",children:(null==P?void 0:P.imageUrl)?(0,s.jsx)("img",{src:P.imageUrl,alt:T,className:"w-full h-full object-cover"}):(0,s.jsx)(d.A,{size:26,className:"text-white"})}),(0,s.jsxs)("div",{className:"hidden sm:block text-xs leading-tight",children:[(0,s.jsx)("p",{className:"font-semibold",children:T}),U?(0,s.jsx)("p",{className:"text-orange-100",children:U}):null,(0,s.jsx)("p",{className:"text-orange-100/80 text-[10px] tracking-wide",children:x})]})]})]})]})})}},68209:(e,t,r)=>{r.d(t,{bC:()=>a,iD:()=>i,me:()=>u,mt:()=>o,ri:()=>c});var s=r(37621),l=r(99947);let n=["auth:user-cache","cache:auth:roles","cache:auth:perms","cache:auth:users"];function a(){try{n.forEach(e=>window.sessionStorage.removeItem(e))}catch(e){}}async function i(e){a(),await s.A.post("/auth/login",e)}async function o(){let e=[s.A.get("/registrations",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,l.a)("cache:auth:employees",t),(0,l.a)("cache:auth:employees:list",t),(0,l.a)("cache:auth:reports:employees",t)}).catch(()=>{}),s.A.get("/users",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,l.a)("cache:auth:users",t.map(e=>({id:e.id,username:e.username,fullName:e.fullName,roles:Array.isArray(e.roles)?e.roles:[],permissions:Array.isArray(e.permissions)?e.permissions:[]}))),(0,l.a)("cache:auth:users:list",t)}).catch(()=>{}),s.A.get("/roles",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,l.a)("cache:auth:roles",t),(0,l.a)("cache:auth:roles:list",t)}).catch(()=>{}),s.A.get("/roles/permissions",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,l.a)("cache:auth:perms",t)}).catch(()=>{})];await Promise.allSettled(e)}async function u(){try{let{data:e}=await s.A.get("/auth/me");return e}catch(l){var e;let t=null==l?void 0:l.code,r=((null==l?void 0:l.message)||"").toLowerCase(),s=null==l||null==(e=l.response)?void 0:e.status;if("ECONNABORTED"===t||r.includes("timeout")||r.includes("network error")||401===s||403===s)return null;throw l}}async function c(){try{await s.A.post("/auth/logout")}catch(r){var e;let t=null==r||null==(e=r.response)?void 0:e.status;if(401===t||403===t)return;throw r}finally{a()}}},99947:(e,t,r)=>{function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5;try{let r=window.sessionStorage.getItem(e);if(!r)return null;let s=JSON.parse(r);if(!(null==s?void 0:s.data)||!(null==s?void 0:s.ts))return null;if(Date.now()-s.ts>t)return window.sessionStorage.removeItem(e),null;return s.data}catch(e){return null}}function l(e,t){try{if(null===t)return void window.sessionStorage.removeItem(e);let r={data:t,ts:Date.now()};window.sessionStorage.setItem(e,JSON.stringify(r))}catch(e){}}r.d(t,{a:()=>l,x:()=>s})}}]);