"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6356],{2989:(e,t,r)=>{r.d(t,{Du:()=>v,Hv:()=>c,JY:()=>p,Q3:()=>h,Tz:()=>y,WR:()=>u,W_:()=>m,ih:()=>f,p0:()=>d,vs:()=>g});var a=r(81242);r(93402);let n="/vehicles",l=e=>""===e||null==e?void 0:Number(e)||void 0,i=(e,t)=>{var r,a;return(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||t};function s(e){let t=(0,a.I)(e);return Array.isArray(t)?t:t&&Array.isArray(t.content)?t.content:[]}function o(e,t){if(Array.isArray(t))t.forEach(t=>e.append("files",t));else for(let r=0;r<t.length;r++){let a=t.item(r);a&&e.append("files",a)}}async function u(e){try{let{data:t}=await a.A.get(n,{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return s(t)}catch(e){throw Error(i(e,"Failed to fetch vehicles"))}}async function c(e){try{let{data:t}=await a.A.get("/vehicles/deleted",{params:{page:0,size:1e3,...(null==e?void 0:e.trim())?{search:e.trim()}:{}}});return s(t)}catch(e){throw Error(i(e,"Failed to fetch deleted vehicles"))}}async function d(e){try{let{data:t}=await a.A.get("".concat(n,"/").concat(e));return(0,a.I)(t)}catch(e){throw Error(i(e,"Vehicle not found"))}}async function m(e){try{let t={...e};delete t.id,"registeredKm"in t&&(t.registeredKm=l(t.registeredKm)),"totalKmDriven"in t&&(t.totalKmDriven=l(t.totalKmDriven)),"fuelEfficiency"in t&&(t.fuelEfficiency=l(t.fuelEfficiency));let{data:r}=await a.A.post(n,t);return(0,a.I)(r)}catch(e){throw Error(i(e,"Failed to add vehicle"))}}async function h(e,t){try{let r={...t};"registeredKm"in r&&(r.registeredKm=l(r.registeredKm)),"totalKmDriven"in r&&(r.totalKmDriven=l(r.totalKmDriven)),"fuelEfficiency"in r&&(r.fuelEfficiency=l(r.fuelEfficiency));let{data:i}=await a.A.put("".concat(n,"/").concat(e),r);return(0,a.I)(i)}catch(e){throw Error(i(e,"Failed to update vehicle"))}}async function f(e){try{await a.A.delete("".concat(n,"/").concat(e))}catch(e){throw Error(i(e,"Failed to delete vehicle"))}}async function p(e,t){let r=new FormData,i={...e};delete i.id,"registeredKm"in i&&(i.registeredKm=l(i.registeredKm)),"totalKmDriven"in i&&(i.totalKmDriven=l(i.totalKmDriven)),"fuelEfficiency"in i&&(i.fuelEfficiency=l(i.fuelEfficiency)),r.append("vehicle",JSON.stringify(i)),o(r,t);let{data:s}=await a.A.post("".concat(n,"/with-images"),r,{headers:{"Content-Type":"multipart/form-data"}});return(0,a.I)(s)}async function y(e){let{data:t}=await a.A.get("".concat(n,"/").concat(e,"/images"));return(0,a.I)(t)}async function v(e,t){let r=new FormData;o(r,t);let{data:l}=await a.A.post("".concat(n,"/").concat(e,"/images"),r,{headers:{"Content-Type":"multipart/form-data"}});return(0,a.I)(l)}async function g(e,t){await a.A.delete("".concat(n,"/").concat(e,"/images/").concat(t))}},4259:(e,t,r)=>{r.d(t,{A:()=>c});var a=r(12115),n=r(68209),l=r(20063);let i=["/login","/_error","/403"],s="auth:user-cache",o=()=>{try{let e=window.sessionStorage.getItem(s);if(!e)return null;let t=JSON.parse(e);if(!(null==t?void 0:t.user)||!(null==t?void 0:t.ts)||Date.now()-t.ts>3e5)return null;return t.user}catch(e){return null}},u=e=>{try{e?window.sessionStorage.setItem(s,JSON.stringify({user:e,ts:Date.now()})):window.sessionStorage.removeItem(s)}catch(e){}},c=()=>{let e=o(),[t,r]=(0,a.useState)(e),[s,c]=(0,a.useState)(!e),[d,m]=(0,a.useState)(null),h=(0,l.useRouter)(),f=(0,l.usePathname)(),p=(0,a.useRef)(!1),y=e=>{p.current&&(r(e),u(e))};(0,a.useEffect)(()=>{p.current=!0;let e=!1,t=i.some(e=>null==f?void 0:f.startsWith(e)),r=()=>{null!=f&&f.startsWith("/login")||h.replace("/login")};return t?(c(!1),m(null),()=>{p.current=!1,e=!0}):((async()=>{m(null);let t=o();t&&y(t);let a=!t;a&&c(!0);try{let t=await (0,n.me)();if(e||!p.current)return;if(!t){y(null),m(null),u(null),(0,n.bC)(),r();return}y(t),m(null),(0,n.bC)()}catch(t){var l,i;if(console.error("Auth check failed:",t),e||!p.current)return;m((null==t||null==(i=t.response)||null==(l=i.data)?void 0:l.message)||(null==t?void 0:t.message)||"Authentication failed"),y(null),u(null),(0,n.bC)(),r()}finally{!e&&p.current&&a&&c(!1)}})(),()=>{e=!0,p.current=!1})},[f,h]);let v=async()=>{if(!p.current)return null;c(!0),m(null);try{let e=await (0,n.me)();if(!p.current)return null;if(!e)return y(null),m("Session expired. Please sign in again."),(0,n.bC)(),(null==f?void 0:f.startsWith("/login"))||h.replace("/login"),null;return(0,n.bC)(),y(e),m(null),e}catch(r){var e,t;throw m((null==(t=r.response)||null==(e=t.data)?void 0:e.message)||"Failed to refresh user data"),r}finally{c(!1)}};return(0,a.useEffect)(()=>{(null==t?void 0:t.username)?window.localStorage.setItem("username",t.username):window.localStorage.removeItem("username")},[null==t?void 0:t.username]),{user:t,setUser:y,loading:s,error:d,refresh:v,hasRole:e=>{if(!(null==t?void 0:t.roles))return!1;let r=Array.isArray(e)?e:[e],a=t.roles.map(e=>e.toUpperCase());return r.some(e=>a.includes(e.toUpperCase()))},can:e=>{if(!(null==t?void 0:t.permissions))return!1;let r=Array.isArray(e)?e:[e];return t.permissions.some(e=>r.includes(e))},hasAnyRole:()=>!!((null==t?void 0:t.roles)&&t.roles.length>0)}}},20063:(e,t,r)=>{var a=r(47260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},30409:(e,t,r)=>{r.d(t,{D:()=>l,c:()=>n});var a=r(81242);async function n(e){let{data:t}=await a.A.get("/fuel-logs",{params:e});return(0,a.I)(t)}async function l(e){let{data:t}=await a.A.post("/fuel-logs",e);return(0,a.I)(t)}},37621:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(95125),n=r(95704);let l=(n.env.NEXT_PUBLIC_AUTH_BASE||"").replace(/\/$/,""),i=Math.min(Number(n.env.NEXT_PUBLIC_API_TIMEOUT)||1e4,15e3),s=a.A.create({baseURL:l?"".concat(l,"/api"):"/aapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:i});s.interceptors.request.use(e=>e,e=>Promise.reject(e)),s.interceptors.response.use(e=>{let t=e.data;if((e=>!!(e&&"object"==typeof e&&"ok"in e))(t)){if(t.ok){var r;return e.data=Object.prototype.hasOwnProperty.call(t,"data")&&null!=(r=t.data)?r:null,e}let a=Error(t.message||"Request failed");return a.response={status:e.status,data:t},Promise.reject(a)}return e},e=>{var t,r,a,n,l;let i=null==(t=e.response)?void 0:t.status,s=e.code,o=((null==e?void 0:e.message)||"").toLowerCase();return 401===i?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.resolve({status:null!=i?i:0,statusText:"Unauthorized",data:null,headers:null!=(a=null==(r=e.response)?void 0:r.headers)?a:{},config:e.config,request:e.request})):403===i?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(e)):"ECONNABORTED"===s||o.includes("timeout")?(console.warn("API timeout – returning empty response to keep UI responsive"),Promise.resolve({status:null!=i?i:0,statusText:"Request Timeout",data:null,headers:null!=(l=null==(n=e.response)?void 0:n.headers)?l:{},config:e.config,request:e.request})):Promise.reject(e)});let o=s},46398:(e,t,r)=>{r.d(t,{A:()=>a});let a=(0,r(71847).A)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])},68209:(e,t,r)=>{r.d(t,{bC:()=>i,iD:()=>s,me:()=>u,mt:()=>o,ri:()=>c});var a=r(37621),n=r(99947);let l=["auth:user-cache","cache:auth:roles","cache:auth:perms","cache:auth:users"];function i(){try{l.forEach(e=>window.sessionStorage.removeItem(e))}catch(e){}}async function s(e){i(),await a.A.post("/auth/login",e)}async function o(){let e=[a.A.get("/registrations",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,n.a)("cache:auth:employees",t),(0,n.a)("cache:auth:employees:list",t),(0,n.a)("cache:auth:reports:employees",t)}).catch(()=>{}),a.A.get("/users",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,n.a)("cache:auth:users",t.map(e=>({id:e.id,username:e.username,fullName:e.fullName,roles:Array.isArray(e.roles)?e.roles:[],permissions:Array.isArray(e.permissions)?e.permissions:[]}))),(0,n.a)("cache:auth:users:list",t)}).catch(()=>{}),a.A.get("/roles",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,n.a)("cache:auth:roles",t),(0,n.a)("cache:auth:roles:list",t)}).catch(()=>{}),a.A.get("/roles/permissions",{timeout:8e3}).then(e=>{let t=Array.isArray(e.data)?e.data:[];(0,n.a)("cache:auth:perms",t)}).catch(()=>{})];await Promise.allSettled(e)}async function u(){try{let{data:e}=await a.A.get("/auth/me");return e}catch(n){var e;let t=null==n?void 0:n.code,r=((null==n?void 0:n.message)||"").toLowerCase(),a=null==n||null==(e=n.response)?void 0:e.status;if("ECONNABORTED"===t||r.includes("timeout")||r.includes("network error")||401===a||403===a)return null;throw n}}async function c(){try{await a.A.post("/auth/logout")}catch(r){var e;let t=null==r||null==(e=r.response)?void 0:e.status;if(401===t||403===t)return;throw r}finally{i()}}},71847:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(12115);let n=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:u="",children:c,iconNode:d,...m}=e;return(0,a.createElement)("svg",{ref:t,...i,width:n,height:n,stroke:r,strokeWidth:o?24*Number(s)/Number(n):s,className:l("lucide",u),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...d.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let r=(0,a.forwardRef)((r,i)=>{let{className:o,...u}=r;return(0,a.createElement)(s,{ref:i,iconNode:t,className:l("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...u})});return r.displayName=n(e),r}},81242:(e,t,r)=>{r.d(t,{A:()=>o,I:()=>u});var a=r(95125),n=r(95704);let l=(n.env.NEXT_PUBLIC_TRANSPORT_BASE||"").replace(/\/$/,""),i=Math.min(Number(n.env.NEXT_PUBLIC_TRANSPORT_TIMEOUT)||1e4,15e3),s=a.A.create({baseURL:l?"".concat(l,"/api"):"/tapi",withCredentials:!0,headers:{"Content-Type":"application/json"},timeout:i}),o=s;function u(e){if(e&&"object"==typeof e&&"ok"in e){if(!1===e.ok)throw Error(e.message||"Request failed");return e.data}return e}s.interceptors.request.use(e=>{{var t,r;let a=localStorage.getItem("username")||localStorage.getItem("actor")||localStorage.getItem("employeeId")||void 0;a&&(e.headers=null!=(t=e.headers)?t:{},e.headers["X-Actor"]=a);let n=localStorage.getItem("role")||void 0;n&&(e.headers=null!=(r=e.headers)?r:{},e.headers["X-Role"]=n)}return e}),s.interceptors.response.use(e=>e,e=>{let t=null==e?void 0:e.code,r=((null==e?void 0:e.message)||"").toLowerCase();if("ECONNABORTED"===t||r.includes("timeout")){var a,n,l,i;return console.warn("Transport API timeout – returning empty response"),Promise.resolve({status:null!=(l=null==(a=e.response)?void 0:a.status)?l:0,statusText:"Request Timeout",data:null,headers:null!=(i=null==(n=e.response)?void 0:n.headers)?i:{},config:e.config,request:e.request})}return Promise.reject(e)})},91811:(e,t,r)=>{r.d(t,{A:()=>a});let a=(0,r(71847).A)("droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]])},93402:(e,t,r)=>{r.d(t,{mI:()=>l,ae:()=>i});var a=r(81242);let n=e=>{var t,r,a;return{id:e.id,entityType:"Vehicle"===e.entityType||"Driver"===e.entityType?e.entityType:"Vehicle",entityId:e.entityId,action:"Created"===e.action||"Updated"===e.action||"Deleted"===e.action?e.action:"Updated",previousData:null!=(t=e.previousJson)?t:null,newData:null!=(r=e.newJson)?r:null,performedBy:null!=(a=e.performedBy)?a:null,timestamp:e.timestamp}};async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,{data:t}=await a.A.get("/history/recent",{params:{size:e}});return(0,a.I)(t).map(n)}async function i(e,t){let{data:r}=await a.A.get("/history/".concat(e,"/").concat(t));return(0,a.I)(r).map(n)}},99947:(e,t,r)=>{function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5;try{let r=window.sessionStorage.getItem(e);if(!r)return null;let a=JSON.parse(r);if(!(null==a?void 0:a.data)||!(null==a?void 0:a.ts))return null;if(Date.now()-a.ts>t)return window.sessionStorage.removeItem(e),null;return a.data}catch(e){return null}}function n(e,t){try{if(null===t)return void window.sessionStorage.removeItem(e);let r={data:t,ts:Date.now()};window.sessionStorage.setItem(e,JSON.stringify(r))}catch(e){}}r.d(t,{a:()=>n,x:()=>a})}}]);